/*! For license information please see npm-async-24d874ad.87014c3c.js.LICENSE */
(window["__LOADABLE_LOADED_CHUNKS__"]=window["__LOADABLE_LOADED_CHUNKS__"]||[]).push([[60],{lBSS:function(i,e,t){typeof window!=="undefined"&&function e(t,r){if(true)i.exports=r();else{}}(this,function(){return function(r){var i={};function a(e){if(i[e]){return i[e].exports}var t=i[e]={i:e,l:false,exports:{}};r[e].call(t.exports,t,t.exports,a);t.l=true;return t.exports}a.m=r;a.c=i;a.d=function(e,t,r){if(!a.o(e,t)){Object.defineProperty(e,t,{enumerable:true,get:r})}};a.r=function(e){if(typeof Symbol!=="undefined"&&Symbol.toStringTag){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}Object.defineProperty(e,"__esModule",{value:true})};a.t=function(t,e){if(e&1)t=a(t);if(e&8)return t;if(e&4&&typeof t==="object"&&t&&t.__esModule)return t;var r=Object.create(null);a.r(r);Object.defineProperty(r,"default",{enumerable:true,value:t});if(e&2&&typeof t!="string")for(var i in t)a.d(r,i,function(e){return t[e]}.bind(null,i));return r};a.n=function(t){var e=t&&t.__esModule?function e(){return t["default"]}:function e(){return t};a.d(e,"a",e);return e};a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)};a.p="/dist/";return a(a.s="./src/hls.js")}({"./node_modules/eventemitter3/index.js":function(e,t,r){"use strict";var a=Object.prototype.hasOwnProperty,p="~";function i(){}if(Object.create){i.prototype=Object.create(null);if(!(new i).__proto__)p=false}function o(e,t,r){this.fn=e;this.context=t;this.once=r||false}function n(e,t,r,i,a){if(typeof r!=="function"){throw new TypeError("The listener must be a function")}var n=new o(r,i||e,a),s=p?p+t:t;if(!e._events[s])e._events[s]=n,e._eventsCount++;else if(!e._events[s].fn)e._events[s].push(n);else e._events[s]=[e._events[s],n];return e}function f(e,t){if(--e._eventsCount===0)e._events=new i;else delete e._events[t]}function s(){this._events=new i;this._eventsCount=0}s.prototype.eventNames=function e(){var t=[],r,i;if(this._eventsCount===0)return t;for(i in r=this._events){if(a.call(r,i))t.push(p?i.slice(1):i)}if(Object.getOwnPropertySymbols){return t.concat(Object.getOwnPropertySymbols(r))}return t};s.prototype.listeners=function e(t){var r=p?p+t:t,i=this._events[r];if(!i)return[];if(i.fn)return[i.fn];for(var a=0,n=i.length,s=new Array(n);a<n;a++){s[a]=i[a].fn}return s};s.prototype.listenerCount=function e(t){var r=p?p+t:t,i=this._events[r];if(!i)return 0;if(i.fn)return 1;return i.length};s.prototype.emit=function e(t,r,i,a,n,s){var o=p?p+t:t;if(!this._events[o])return false;var l=this._events[o],u=arguments.length,f,d;if(l.fn){if(l.once)this.removeListener(t,l.fn,undefined,true);switch(u){case 1:return l.fn.call(l.context),true;case 2:return l.fn.call(l.context,r),true;case 3:return l.fn.call(l.context,r,i),true;case 4:return l.fn.call(l.context,r,i,a),true;case 5:return l.fn.call(l.context,r,i,a,n),true;case 6:return l.fn.call(l.context,r,i,a,n,s),true}for(d=1,f=new Array(u-1);d<u;d++){f[d-1]=arguments[d]}l.fn.apply(l.context,f)}else{var c=l.length,h;for(d=0;d<c;d++){if(l[d].once)this.removeListener(t,l[d].fn,undefined,true);switch(u){case 1:l[d].fn.call(l[d].context);break;case 2:l[d].fn.call(l[d].context,r);break;case 3:l[d].fn.call(l[d].context,r,i);break;case 4:l[d].fn.call(l[d].context,r,i,a);break;default:if(!f)for(h=1,f=new Array(u-1);h<u;h++){f[h-1]=arguments[h]}l[d].fn.apply(l[d].context,f)}}}return true};s.prototype.on=function e(t,r,i){return n(this,t,r,i,false)};s.prototype.once=function e(t,r,i){return n(this,t,r,i,true)};s.prototype.removeListener=function e(t,r,i,a){var n=p?p+t:t;if(!this._events[n])return this;if(!r){f(this,n);return this}var s=this._events[n];if(s.fn){if(s.fn===r&&(!a||s.once)&&(!i||s.context===i)){f(this,n)}}else{for(var o=0,l=[],u=s.length;o<u;o++){if(s[o].fn!==r||a&&!s[o].once||i&&s[o].context!==i){l.push(s[o])}}if(l.length)this._events[n]=l.length===1?l[0]:l;else f(this,n)}return this};s.prototype.removeAllListeners=function e(t){var r;if(t){r=p?p+t:t;if(this._events[r])f(this,r)}else{this._events=new i;this._eventsCount=0}return this};s.prototype.off=s.prototype.removeListener;s.prototype.addListener=s.prototype.on;s.prefixed=p;s.EventEmitter=s;if(true){e.exports=s}},"./node_modules/node-libs-browser/node_modules/events/events.js":function(e,t){function i(){this._events=this._events||{};this._maxListeners=this._maxListeners||undefined}e.exports=i;i.EventEmitter=i;i.prototype._events=undefined;i.prototype._maxListeners=undefined;i.defaultMaxListeners=10;i.prototype.setMaxListeners=function(e){if(!r(e)||e<0||isNaN(e))throw TypeError("n must be a positive number");this._maxListeners=e;return this};i.prototype.emit=function(e){var t,r,i,a,n,s;if(!this._events)this._events={};if(e==="error"){if(!this._events.error||u(this._events.error)&&!this._events.error.length){t=arguments[1];if(t instanceof Error){throw t}else{var o=new Error('Uncaught, unspecified "error" event. ('+t+")");o.context=t;throw o}}}r=this._events[e];if(f(r))return false;if(l(r)){switch(arguments.length){case 1:r.call(this);break;case 2:r.call(this,arguments[1]);break;case 3:r.call(this,arguments[1],arguments[2]);break;default:a=Array.prototype.slice.call(arguments,1);r.apply(this,a)}}else if(u(r)){a=Array.prototype.slice.call(arguments,1);s=r.slice();i=s.length;for(n=0;n<i;n++)s[n].apply(this,a)}return true};i.prototype.addListener=function(e,t){var r;if(!l(t))throw TypeError("listener must be a function");if(!this._events)this._events={};if(this._events.newListener)this.emit("newListener",e,l(t.listener)?t.listener:t);if(!this._events[e])this._events[e]=t;else if(u(this._events[e]))this._events[e].push(t);else this._events[e]=[this._events[e],t];if(u(this._events[e])&&!this._events[e].warned){if(!f(this._maxListeners)){r=this._maxListeners}else{r=i.defaultMaxListeners}if(r&&r>0&&this._events[e].length>r){this._events[e].warned=true;console.error("(node) warning: possible EventEmitter memory "+"leak detected. %d listeners added. "+"Use emitter.setMaxListeners() to increase limit.",this._events[e].length);if(typeof console.trace==="function"){console.trace()}}}return this};i.prototype.on=i.prototype.addListener;i.prototype.once=function(e,t){if(!l(t))throw TypeError("listener must be a function");var r=false;function i(){this.removeListener(e,i);if(!r){r=true;t.apply(this,arguments)}}i.listener=t;this.on(e,i);return this};i.prototype.removeListener=function(e,t){var r,i,a,n;if(!l(t))throw TypeError("listener must be a function");if(!this._events||!this._events[e])return this;r=this._events[e];a=r.length;i=-1;if(r===t||l(r.listener)&&r.listener===t){delete this._events[e];if(this._events.removeListener)this.emit("removeListener",e,t)}else if(u(r)){for(n=a;n-- >0;){if(r[n]===t||r[n].listener&&r[n].listener===t){i=n;break}}if(i<0)return this;if(r.length===1){r.length=0;delete this._events[e]}else{r.splice(i,1)}if(this._events.removeListener)this.emit("removeListener",e,t)}return this};i.prototype.removeAllListeners=function(e){var t,r;if(!this._events)return this;if(!this._events.removeListener){if(arguments.length===0)this._events={};else if(this._events[e])delete this._events[e];return this}if(arguments.length===0){for(t in this._events){if(t==="removeListener")continue;this.removeAllListeners(t)}this.removeAllListeners("removeListener");this._events={};return this}r=this._events[e];if(l(r)){this.removeListener(e,r)}else if(r){while(r.length)this.removeListener(e,r[r.length-1])}delete this._events[e];return this};i.prototype.listeners=function(e){var t;if(!this._events||!this._events[e])t=[];else if(l(this._events[e]))t=[this._events[e]];else t=this._events[e].slice();return t};i.prototype.listenerCount=function(e){if(this._events){var t=this._events[e];if(l(t))return 1;else if(t)return t.length}return 0};i.listenerCount=function(e,t){return e.listenerCount(t)};function l(e){return typeof e==="function"}function r(e){return typeof e==="number"}function u(e){return typeof e==="object"&&e!==null}function f(e){return e===void 0}},"./node_modules/url-toolkit/src/url-toolkit.js":function(a,e,t){(function(e){var r=/^((?:[a-zA-Z0-9+\-.]+:)?)(\/\/[^\/?#]*)?((?:[^\/\?#]*\/)*.*?)??(;.*?)?(\?.*?)?(#.*?)?$/;var f=/^([^\/?#]*)(.*)$/;var t=/(?:\/|^)\.(?=\/)/g;var i=/(?:\/|^)\.\.\/(?!\.\.\/).*?(?=\/)/g;var d={buildAbsoluteURL:function(e,t,r){r=r||{};e=e.trim();t=t.trim();if(!t){if(!r.alwaysNormalize){return e}var i=d.parseURL(e);if(!i){throw new Error("Error trying to parse base URL.")}i.path=d.normalizePath(i.path);return d.buildURLFromParts(i)}var a=d.parseURL(t);if(!a){throw new Error("Error trying to parse relative URL.")}if(a.scheme){if(!r.alwaysNormalize){return t}a.path=d.normalizePath(a.path);return d.buildURLFromParts(a)}var n=d.parseURL(e);if(!n){throw new Error("Error trying to parse base URL.")}if(!n.netLoc&&n.path&&n.path[0]!=="/"){var s=f.exec(n.path);n.netLoc=s[1];n.path=s[2]}if(n.netLoc&&!n.path){n.path="/"}var o={scheme:n.scheme,netLoc:a.netLoc,path:null,params:a.params,query:a.query,fragment:a.fragment};if(!a.netLoc){o.netLoc=n.netLoc;if(a.path[0]!=="/"){if(!a.path){o.path=n.path;if(!a.params){o.params=n.params;if(!a.query){o.query=n.query}}}else{var l=n.path;var u=l.substring(0,l.lastIndexOf("/")+1)+a.path;o.path=d.normalizePath(u)}}}if(o.path===null){o.path=r.alwaysNormalize?d.normalizePath(a.path):a.path}return d.buildURLFromParts(o)},parseURL:function(e){var t=r.exec(e);if(!t){return null}return{scheme:t[1]||"",netLoc:t[2]||"",path:t[3]||"",params:t[4]||"",query:t[5]||"",fragment:t[6]||""}},normalizePath:function(e){e=e.split("").reverse().join("").replace(t,"");while(e.length!==(e=e.replace(i,"")).length){}return e.split("").reverse().join("")},buildURLFromParts:function(e){return e.scheme+e.netLoc+e.path+e.params+e.query+e.fragment}};if(true)a.exports=d;else{}})(this)},"./node_modules/webworkify-webpack/index.js":function(e,t,c){function u(r){var i={};function a(e){if(i[e])return i[e].exports;var t=i[e]={i:e,l:false,exports:{}};r[e].call(t.exports,t,t.exports,a);t.l=true;return t.exports}a.m=r;a.c=i;a.i=function(e){return e};a.d=function(e,t,r){if(!a.o(e,t)){Object.defineProperty(e,t,{configurable:false,enumerable:true,get:r})}};a.r=function(e){Object.defineProperty(e,"__esModule",{value:true})};a.n=function(t){var e=t&&t.__esModule?function e(){return t["default"]}:function e(){return t};a.d(e,"a",e);return e};a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)};a.p="/";a.oe=function(e){console.error(e);throw e};var e=a(a.s=ENTRY_MODULE);return e.default||e}var h="[\\.|\\-|\\+|\\w|/|@]+";var p="\\((/\\*.*?\\*/)?s?.*?("+h+").*?\\)";function g(e){return(e+"").replace(/[.?*+^$[\]\\(){}|-]/g,"\\$&")}function v(e){return!isNaN(1*e)}function m(e,t,r){var i={};i[r]=[];var a=t.toString();var n=a.match(/^function\s?\(\w+,\s*\w+,\s*(\w+)\)/);if(!n)return i;var s=n[1];var o=new RegExp("(\\\\n|\\W)"+g(s)+p,"g");var l;while(l=o.exec(a)){if(l[3]==="dll-reference")continue;i[r].push(l[3])}o=new RegExp("\\("+g(s)+'\\("(dll-reference\\s('+h+'))"\\)\\)'+p,"g");while(l=o.exec(a)){if(!e[l[2]]){i[r].push(l[1]);e[l[2]]=c(l[1]).m}i[l[2]]=i[l[2]]||[];i[l[2]].push(l[4])}var u=Object.keys(i);for(var f=0;f<u.length;f++){for(var d=0;d<i[u[f]].length;d++){if(v(i[u[f]][d])){i[u[f]][d]=1*i[u[f]][d]}}}return i}function y(r){var e=Object.keys(r);return e.reduce(function(e,t){return e||r[t].length>0},false)}function f(e,t){var r={main:[t]};var i={main:[]};var a={main:{}};while(y(r)){var n=Object.keys(r);for(var s=0;s<n.length;s++){var o=n[s];var l=r[o];var u=l.pop();a[o]=a[o]||{};if(a[o][u]||!e[o][u])continue;a[o][u]=true;i[o]=i[o]||[];i[o].push(u);var f=m(e,e[o][u],o);var d=Object.keys(f);for(var c=0;c<d.length;c++){r[d[c]]=r[d[c]]||[];r[d[c]]=r[d[c]].concat(f[d[c]])}}}return i}e.exports=function(e,t){t=t||{};var r={main:c.m};var i=t.all?{main:Object.keys(r.main)}:f(r,e);var a="";Object.keys(i).filter(function(e){return e!=="main"}).forEach(function(t){var e=0;while(i[t][e]){e++}i[t].push(e);r[t][e]="(function(module, exports, __webpack_require__) { module.exports = __webpack_require__; })";a=a+"var "+t+" = ("+u.toString().replace("ENTRY_MODULE",JSON.stringify(e))+")({"+i[t].map(function(e){return""+JSON.stringify(e)+": "+r[t][e].toString()}).join(",")+"});\n"});a=a+"new (("+u.toString().replace("ENTRY_MODULE",JSON.stringify(e))+")({"+i.main.map(function(e){return""+JSON.stringify(e)+": "+r.main[e].toString()}).join(",")+"}))(self);";var n=new window.Blob([a],{type:"text/javascript"});if(t.bare){return n}var s=window.URL||window.webkitURL||window.mozURL||window.msURL;var o=s.createObjectURL(n);var l=new window.Worker(o);l.objectURL=o;return l}},"./src/config.js":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});var i=r("./src/controller/abr-controller.js");var a=r("./src/controller/buffer-controller.js");var n=r("./src/controller/cap-level-controller.js");var s=r("./src/controller/fps-controller.js");var o=r("./src/utils/xhr-loader.js");var l=r("./src/controller/audio-track-controller.js");var u=r("./src/controller/audio-stream-controller.js");var f=r("./src/utils/cues.js");var d=r("./src/controller/timeline-controller.js");var c=r("./src/controller/subtitle-track-controller.js");var h=r("./src/controller/subtitle-stream-controller.js");var p=r("./src/controller/eme-controller.js");var g=r("./src/utils/mediakeys-helper.js");t.hlsDefaultConfig={autoStartLoad:true,startPosition:-1,defaultAudioCodec:undefined,debug:false,capLevelOnFPSDrop:false,capLevelToPlayerSize:false,initialLiveManifestSize:1,maxBufferLength:30,maxBufferSize:60*1e3*1e3,maxBufferHole:.5,lowBufferWatchdogPeriod:.5,highBufferWatchdogPeriod:3,nudgeOffset:.1,nudgeMaxRetry:3,maxFragLookUpTolerance:.25,liveSyncDurationCount:3,liveMaxLatencyDurationCount:Infinity,liveSyncDuration:undefined,liveMaxLatencyDuration:undefined,liveDurationInfinity:false,liveBackBufferLength:Infinity,maxMaxBufferLength:600,enableWorker:true,enableSoftwareAES:true,manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,startLevel:undefined,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3,startFragPrefetch:false,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,loader:o.default,fLoader:undefined,pLoader:undefined,xhrSetup:undefined,licenseXhrSetup:undefined,abrController:i.default,bufferController:a.default,capLevelController:n.default,fpsController:s.default,stretchShortVideoTrack:false,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:true,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:false,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:false,widevineLicenseUrl:undefined,requestMediaKeySystemAccessFunc:g.requestMediaKeySystemAccess};if(true){t.hlsDefaultConfig.subtitleStreamController=h.SubtitleStreamController;t.hlsDefaultConfig.subtitleTrackController=c.default;t.hlsDefaultConfig.timelineController=d.default;t.hlsDefaultConfig.cueHandler=f;t.hlsDefaultConfig.enableCEA708Captions=true;t.hlsDefaultConfig.enableWebVTT=true;t.hlsDefaultConfig.captionsTextTrack1Label="English";t.hlsDefaultConfig.captionsTextTrack1LanguageCode="en";t.hlsDefaultConfig.captionsTextTrack2Label="Spanish";t.hlsDefaultConfig.captionsTextTrack2LanguageCode="es"}if(true){t.hlsDefaultConfig.audioStreamController=u.default;t.hlsDefaultConfig.audioTrackController=l.default}if(true){t.hlsDefaultConfig.emeController=p.default}},"./src/controller/abr-controller.js":function(e,r,n){"use strict";(function(s){var t=this&&this.__extends||function(){var i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r]};return function(e,t){i(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}();Object.defineProperty(r,"__esModule",{value:true});var E=n("./src/events.js");var i=n("./src/event-handler.js");var _=n("./src/utils/buffer-helper.js");var a=n("./src/errors.js");var T=n("./src/utils/logger.js");var l=n("./src/utils/ewma-bandwidth-estimator.js");var S=window.performance;var e=function(r){t(e,r);function e(e){var t=r.call(this,e,E.default.FRAG_LOADING,E.default.FRAG_LOADED,E.default.FRAG_BUFFERED,E.default.ERROR)||this;t.lastLoadedFragLevel=0;t._nextAutoLevel=-1;t.hls=e;t.timer=null;t._bwEstimator=null;t.onCheck=t._abandonRulesCheck.bind(t);return t}e.prototype.destroy=function(){this.clearTimer();i.default.prototype.destroy.call(this)};e.prototype.onFragLoading=function(e){var t=e.frag;if(t.type==="main"){if(!this.timer){this.fragCurrent=t;this.timer=setInterval(this.onCheck,100)}if(!this._bwEstimator){var r=this.hls;var i=r.config;var a=t.level;var n=r.levels[a].details.live;var s=void 0,o=void 0;if(n){s=i.abrEwmaFastLive;o=i.abrEwmaSlowLive}else{s=i.abrEwmaFastVoD;o=i.abrEwmaSlowVoD}this._bwEstimator=new l.default(r,o,s,i.abrEwmaDefaultEstimate)}}};e.prototype._abandonRulesCheck=function(){var e=this.hls;var t=e.media;var r=this.fragCurrent;if(!r){return}var i=r.loader;var a=e.minAutoLevel;if(!i||i.stats&&i.stats.aborted){T.logger.warn("frag loader destroy or aborted, disarm abandonRules");this.clearTimer();this._nextAutoLevel=-1;return}var n=i.stats;if(t&&n&&(!t.paused&&t.playbackRate!==0||!t.readyState)&&r.autoLevel&&r.level){var s=S.now()-n.trequest,o=Math.abs(t.playbackRate);if(s>500*r.duration/o){var l=e.levels,u=Math.max(1,n.bw?n.bw/8:n.loaded*1e3/s),f=l[r.level],d=f.realBitrate?Math.max(f.realBitrate,f.bitrate):f.bitrate,c=n.total?n.total:Math.max(n.loaded,Math.round(r.duration*d/8)),h=t.currentTime,p=(c-n.loaded)/u,g=(_.BufferHelper.bufferInfo(t,h,e.config.maxBufferHole).end-h)/o;if(g<2*r.duration/o&&p>g){var v=void 0,m=void 0;for(m=r.level-1;m>a;m--){var y=l[m].realBitrate?Math.max(l[m].realBitrate,l[m].bitrate):l[m].bitrate;v=r.duration*y/(8*.8*u);if(v<g){break}}if(v<p){T.logger.warn("loading too slow, abort fragment loading and switch to level "+m+":fragLoadedDelay["+m+"]<fragLoadedDelay["+(r.level-1)+"];bufferStarvationDelay:"+v.toFixed(1)+"<"+p.toFixed(1)+":"+g.toFixed(1));e.nextLoadLevel=m;this._bwEstimator.sample(s,n.loaded);i.abort();this.clearTimer();e.trigger(E.default.FRAG_LOAD_EMERGENCY_ABORTED,{frag:r,stats:n})}}}}};e.prototype.onFragLoaded=function(e){var t=e.frag;if(t.type==="main"&&s.isFinite(t.sn)){this.clearTimer();this.lastLoadedFragLevel=t.level;this._nextAutoLevel=-1;if(this.hls.config.abrMaxWithRealBitrate){var r=this.hls.levels[t.level];var i=(r.loaded?r.loaded.bytes:0)+e.stats.loaded;var a=(r.loaded?r.loaded.duration:0)+e.frag.duration;r.loaded={bytes:i,duration:a};r.realBitrate=Math.round(8*i/a)}if(e.frag.bitrateTest){var n=e.stats;n.tparsed=n.tbuffered=n.tload;this.onFragBuffered(e)}}};e.prototype.onFragBuffered=function(e){var t=e.stats;var r=e.frag;if(t.aborted!==true&&r.type==="main"&&s.isFinite(r.sn)&&(!r.bitrateTest||t.tload===t.tbuffered)){var i=t.tparsed-t.trequest;T.logger.log("latency/loading/parsing/append/kbps:"+Math.round(t.tfirst-t.trequest)+"/"+Math.round(t.tload-t.tfirst)+"/"+Math.round(t.tparsed-t.tload)+"/"+Math.round(t.tbuffered-t.tparsed)+"/"+Math.round(8*t.loaded/(t.tbuffered-t.trequest)));this._bwEstimator.sample(i,t.loaded);t.bwEstimate=this._bwEstimator.getEstimate();if(r.bitrateTest){this.bitrateTestDelay=i/1e3}else{this.bitrateTestDelay=0}}};e.prototype.onError=function(e){switch(e.details){case a.ErrorDetails.FRAG_LOAD_ERROR:case a.ErrorDetails.FRAG_LOAD_TIMEOUT:this.clearTimer();break;default:break}};e.prototype.clearTimer=function(){clearInterval(this.timer);this.timer=null};Object.defineProperty(e.prototype,"nextAutoLevel",{get:function(){var e=this._nextAutoLevel;var t=this._bwEstimator;if(e!==-1&&(!t||!t.canEstimate())){return e}var r=this._nextABRAutoLevel;if(e!==-1){r=Math.min(e,r)}return r},set:function(e){this._nextAutoLevel=e},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"_nextABRAutoLevel",{get:function(){var e=this.hls,t=e.maxAutoLevel,r=e.levels,i=e.config,a=e.minAutoLevel;var n=e.media,s=this.lastLoadedFragLevel,o=this.fragCurrent?this.fragCurrent.duration:0,l=n?n.currentTime:0,u=n&&n.playbackRate!==0?Math.abs(n.playbackRate):1,f=this._bwEstimator?this._bwEstimator.getEstimate():i.abrEwmaDefaultEstimate,d=(_.BufferHelper.bufferInfo(n,l,i.maxBufferHole).end-l)/u;var c=this._findBestLevel(s,o,f,a,t,d,i.abrBandWidthFactor,i.abrBandWidthUpFactor,r);if(c>=0){return c}else{T.logger.trace("rebuffering expected to happen, lets try to find a quality level minimizing the rebuffering");var h=o?Math.min(o,i.maxStarvationDelay):i.maxStarvationDelay,p=i.abrBandWidthFactor,g=i.abrBandWidthUpFactor;if(d===0){var v=this.bitrateTestDelay;if(v){var m=o?Math.min(o,i.maxLoadingDelay):i.maxLoadingDelay;h=m-v;T.logger.trace("bitrate test took "+Math.round(1e3*v)+"ms, set first fragment max fetchDuration to "+Math.round(1e3*h)+" ms");p=g=1}}c=this._findBestLevel(s,o,f,a,t,d+h,p,g,r);return Math.max(c,0)}},enumerable:true,configurable:true});e.prototype._findBestLevel=function(e,t,r,i,a,n,s,o,l){for(var u=a;u>=i;u--){var f=l[u];if(!f){continue}var d=f.details,c=d?d.totalduration/d.fragments.length:t,h=d?d.live:false,p=void 0;if(u<=e){p=s*r}else{p=o*r}var g=l[u].realBitrate?Math.max(l[u].realBitrate,l[u].bitrate):l[u].bitrate,v=g*c/p;T.logger.trace("level/adjustedbw/bitrate/avgDuration/maxFetchDuration/fetchDuration: "+u+"/"+Math.round(p)+"/"+g+"/"+c+"/"+n+"/"+v);if(p>g&&(!v||h&&!this.bitrateTestDelay||v<n)){return u}}return-1};return e}(i.default);r.default=e}).call(this,n("./src/polyfills/number.js")["Number"])},"./src/controller/audio-stream-controller.js":function(e,i,n){"use strict";(function(C){var t=this&&this.__extends||function(){var i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r]};return function(e,t){i(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}();Object.defineProperty(i,"__esModule",{value:true});var x=n("./src/utils/binary-search.js");var F=n("./src/utils/buffer-helper.js");var p=n("./src/demux/demuxer.js");var M=n("./src/events.js");var c=n("./src/controller/level-helper.js");var a=n("./src/utils/time-ranges.js");var h=n("./src/errors.js");var N=n("./src/utils/logger.js");var j=n("./src/utils/discontinuities.js");var U=n("./src/controller/fragment-tracker.js");var g=n("./src/loader/fragment.js");var B=n("./src/controller/base-stream-controller.js");var G=window.performance;var r=100;var e=function(i){t(e,i);function e(e,t){var r=i.call(this,e,M.default.MEDIA_ATTACHED,M.default.MEDIA_DETACHING,M.default.AUDIO_TRACKS_UPDATED,M.default.AUDIO_TRACK_SWITCHING,M.default.AUDIO_TRACK_LOADED,M.default.KEY_LOADED,M.default.FRAG_LOADED,M.default.FRAG_PARSING_INIT_SEGMENT,M.default.FRAG_PARSING_DATA,M.default.FRAG_PARSED,M.default.ERROR,M.default.BUFFER_RESET,M.default.BUFFER_CREATED,M.default.BUFFER_APPENDED,M.default.BUFFER_FLUSHED,M.default.INIT_PTS_FOUND)||this;r.fragmentTracker=t;r.config=e.config;r.audioCodecSwap=false;r._state=B.State.STOPPED;r.initPTS=[];r.waitingFragment=null;r.videoTrackCC=null;return r}e.prototype.onInitPtsFound=function(e){var t=e.id,r=e.frag.cc,i=e.initPTS;if(t==="main"){this.initPTS[r]=i;this.videoTrackCC=r;N.logger.log("InitPTS for cc: "+r+" found from video track: "+i);if(this.state===B.State.WAITING_INIT_PTS){this.tick()}}};e.prototype.startLoad=function(e){if(this.tracks){var t=this.lastCurrentTime;this.stopLoad();this.setInterval(r);this.fragLoadError=0;if(t>0&&e===-1){N.logger.log("audio:override startPosition with lastCurrentTime @"+t.toFixed(3));this.state=B.State.IDLE}else{this.lastCurrentTime=this.startPosition?this.startPosition:e;this.state=B.State.STARTING}this.nextLoadPosition=this.startPosition=this.lastCurrentTime;this.tick()}else{this.startPosition=e;this.state=B.State.STOPPED}};Object.defineProperty(e.prototype,"state",{get:function(){return this._state},set:function(e){if(this.state!==e){var t=this.state;this._state=e;N.logger.log("audio stream:"+t+"->"+e)}},enumerable:true,configurable:true});e.prototype.doTick=function(){var e,t,r,i=this.hls,a=i.config;switch(this.state){case B.State.ERROR:case B.State.PAUSED:case B.State.BUFFER_FLUSHING:break;case B.State.STARTING:this.state=B.State.WAITING_TRACK;this.loadedmetadata=false;break;case B.State.IDLE:var n=this.tracks;if(!n){break}if(!this.media&&(this.startFragRequested||!a.startFragPrefetch)){break}if(this.loadedmetadata){e=this.media.currentTime}else{e=this.nextLoadPosition;if(e===undefined){break}}var s=this.mediaBuffer?this.mediaBuffer:this.media,o=this.videoBuffer?this.videoBuffer:this.media,l=F.BufferHelper.bufferInfo(s,e,a.maxBufferHole),u=F.BufferHelper.bufferInfo(o,e,a.maxBufferHole),f=l.len,d=l.end,c=this.fragPrevious,h=Math.min(a.maxBufferLength,a.maxMaxBufferLength),p=Math.max(h,u.len),g=this.audioSwitch,v=this.trackId;if((f<p||g)&&v<n.length){r=n[v].details;if(typeof r==="undefined"){this.state=B.State.WAITING_TRACK;break}if(!g&&this._streamEnded(l,r)){this.hls.trigger(M.default.BUFFER_EOS,{type:"audio"});this.state=B.State.ENDED;return}var m=r.fragments,y=m.length,E=m[0].start,_=m[y-1].start+m[y-1].duration,T=void 0;if(g){if(r.live&&!r.PTSKnown){N.logger.log("switching audiotrack, live stream, unknown PTS,load first fragment");d=0}else{d=e;if(r.PTSKnown&&e<E){if(l.end>E||l.nextStart){N.logger.log("alt audio track ahead of main track, seek to start of alt audio track");this.media.currentTime=E+.05}else{return}}}}if(r.initSegment&&!r.initSegment.data){T=r.initSegment}else if(d<=E){T=m[0];if(this.videoTrackCC!==null&&T.cc!==this.videoTrackCC){T=j.findFragWithCC(m,this.videoTrackCC)}if(r.live&&T.loadIdx&&T.loadIdx===this.fragLoadIdx){var S=l.nextStart?l.nextStart:E;N.logger.log("no alt audio available @currentTime:"+this.media.currentTime+", seeking @"+(S+.05));this.media.currentTime=S+.05;return}}else{var b=void 0;var A=a.maxFragLookUpTolerance;var R=c?m[c.sn-m[0].sn+1]:undefined;var D=function(e){var t=Math.min(A,e.duration);if(e.start+e.duration-t<=d){return 1}else if(e.start-t>d&&e.start){return-1}return 0};if(d<_){if(d>_-A){A=0}if(R&&!D(R)){b=R}else{b=x.default.search(m,D)}}else{b=m[y-1]}if(b){T=b;E=b.start;if(c&&T.level===c.level&&T.sn===c.sn){if(T.sn<r.endSN){T=m[T.sn+1-r.startSN];N.logger.log("SN just loaded, load next one: "+T.sn)}else{T=null}}}}if(T){if(T.encrypted){N.logger.log("Loading key for "+T.sn+" of ["+r.startSN+" ,"+r.endSN+"],track "+v);this.state=B.State.KEY_LOADING;i.trigger(M.default.KEY_LOADING,{frag:T})}else{N.logger.log("Loading "+T.sn+", cc: "+T.cc+" of ["+r.startSN+" ,"+r.endSN+"],track "+v+", currentTime:"+e+",bufferEnd:"+d.toFixed(3));this.fragCurrent=T;if(g||this.fragmentTracker.getState(T)===U.FragmentState.NOT_LOADED){this.startFragRequested=true;if(C.isFinite(T.sn)){this.nextLoadPosition=T.start+T.duration}i.trigger(M.default.FRAG_LOADING,{frag:T});this.state=B.State.FRAG_LOADING}}}}break;case B.State.WAITING_TRACK:t=this.tracks[this.trackId];if(t&&t.details){this.state=B.State.IDLE}break;case B.State.FRAG_LOADING_WAITING_RETRY:var L=G.now();var w=this.retryDate;s=this.media;var O=s&&s.seeking;if(!w||L>=w||O){N.logger.log("audioStreamController: retryDate reached, switch back to IDLE state");this.state=B.State.IDLE}break;case B.State.WAITING_INIT_PTS:var k=this.videoTrackCC;if(this.initPTS[k]===undefined){break}var I=this.waitingFragment;if(I){var P=I.frag.cc;if(k!==P){t=this.tracks[this.trackId];if(t.details&&t.details.live){N.logger.warn("Waiting fragment CC ("+P+") does not match video track CC ("+k+")");this.waitingFragment=null;this.state=B.State.IDLE}}else{this.state=B.State.FRAG_LOADING;this.onFragLoaded(this.waitingFragment);this.waitingFragment=null}}else{this.state=B.State.IDLE}break;case B.State.STOPPED:case B.State.FRAG_LOADING:case B.State.PARSING:case B.State.PARSED:case B.State.ENDED:break;default:break}};e.prototype.onMediaAttached=function(e){var t=this.media=this.mediaBuffer=e.media;this.onvseeking=this.onMediaSeeking.bind(this);this.onvended=this.onMediaEnded.bind(this);t.addEventListener("seeking",this.onvseeking);t.addEventListener("ended",this.onvended);var r=this.config;if(this.tracks&&r.autoStartLoad){this.startLoad(r.startPosition)}};e.prototype.onMediaDetaching=function(){var e=this.media;if(e&&e.ended){N.logger.log("MSE detaching and video ended, reset startPosition");this.startPosition=this.lastCurrentTime=0}if(e){e.removeEventListener("seeking",this.onvseeking);e.removeEventListener("ended",this.onvended);this.onvseeking=this.onvseeked=this.onvended=null}this.media=this.mediaBuffer=this.videoBuffer=null;this.loadedmetadata=false;this.stopLoad()};e.prototype.onAudioTracksUpdated=function(e){N.logger.log("audio tracks updated");this.tracks=e.audioTracks};e.prototype.onAudioTrackSwitching=function(e){var t=!!e.url;this.trackId=e.id;this.fragCurrent=null;this.state=B.State.PAUSED;this.waitingFragment=null;if(!t){if(this.demuxer){this.demuxer.destroy();this.demuxer=null}}else{this.setInterval(r)}if(t){this.audioSwitch=true;this.state=B.State.IDLE}this.tick()};e.prototype.onAudioTrackLoaded=function(e){var t=e.details,r=e.id,i=this.tracks[r],a=t.totalduration,n=0;N.logger.log("track "+r+" loaded ["+t.startSN+","+t.endSN+"],duration:"+a);if(t.live){var s=i.details;if(s&&t.fragments.length>0){c.mergeDetails(s,t);n=t.fragments[0].start;if(t.PTSKnown){N.logger.log("live audio playlist sliding:"+n.toFixed(3))}else{N.logger.log("live audio playlist - outdated PTS, unknown sliding")}}else{t.PTSKnown=false;N.logger.log("live audio playlist - first load, unknown sliding")}}else{t.PTSKnown=false}i.details=t;if(!this.startFragRequested){if(this.startPosition===-1){var o=t.startTimeOffset;if(C.isFinite(o)){N.logger.log("start time offset found in playlist, adjust startPosition to "+o);this.startPosition=o}else{this.startPosition=0}}this.nextLoadPosition=this.startPosition}if(this.state===B.State.WAITING_TRACK){this.state=B.State.IDLE}this.tick()};e.prototype.onKeyLoaded=function(){if(this.state===B.State.KEY_LOADING){this.state=B.State.IDLE;this.tick()}};e.prototype.onFragLoaded=function(e){var t=this.fragCurrent,r=e.frag;if(this.state===B.State.FRAG_LOADING&&t&&r.type==="audio"&&r.level===t.level&&r.sn===t.sn){var i=this.tracks[this.trackId],a=i.details,n=a.totalduration,s=t.level,o=t.sn,l=t.cc,u=this.config.defaultAudioCodec||i.audioCodec||"mp4a.40.2",f=this.stats=e.stats;if(o==="initSegment"){this.state=B.State.IDLE;f.tparsed=f.tbuffered=G.now();a.initSegment.data=e.payload;this.hls.trigger(M.default.FRAG_BUFFERED,{stats:f,frag:t,id:"audio"});this.tick()}else{this.state=B.State.PARSING;this.appended=false;if(!this.demuxer){this.demuxer=new p.default(this.hls,"audio")}var d=this.initPTS[l];var c=a.initSegment?a.initSegment.data:[];if(a.initSegment||d!==undefined){this.pendingBuffering=true;N.logger.log("Demuxing "+o+" of ["+a.startSN+" ,"+a.endSN+"],track "+s);var h=false;this.demuxer.push(e.payload,c,u,null,t,n,h,d)}else{N.logger.log("unknown video PTS for continuity counter "+l+", waiting for video PTS before demuxing audio frag "+o+" of ["+a.startSN+" ,"+a.endSN+"],track "+s);this.waitingFragment=e;this.state=B.State.WAITING_INIT_PTS}}}this.fragLoadError=0};e.prototype.onFragParsingInitSegment=function(e){var t=this.fragCurrent;var r=e.frag;if(t&&e.id==="audio"&&r.sn===t.sn&&r.level===t.level&&this.state===B.State.PARSING){var i=e.tracks,a=void 0;if(i.video){delete i.video}a=i.audio;if(a){a.levelCodec=a.codec;a.id=e.id;this.hls.trigger(M.default.BUFFER_CODECS,i);N.logger.log("audio track:audio,container:"+a.container+",codecs[level/parsed]=["+a.levelCodec+"/"+a.codec+"]");var n=a.initSegment;if(n){var s={type:"audio",data:n,parent:"audio",content:"initSegment"};if(this.audioSwitch){this.pendingData=[s]}else{this.appended=true;this.pendingBuffering=true;this.hls.trigger(M.default.BUFFER_APPENDING,s)}}this.tick()}}};e.prototype.onFragParsingData=function(t){var r=this;var e=this.fragCurrent;var i=t.frag;if(e&&t.id==="audio"&&t.type==="audio"&&i.sn===e.sn&&i.level===e.level&&this.state===B.State.PARSING){var a=this.trackId,n=this.tracks[a],s=this.hls;if(!C.isFinite(t.endPTS)){t.endPTS=t.startPTS+e.duration;t.endDTS=t.startDTS+e.duration}e.addElementaryStream(g.default.ElementaryStreamTypes.AUDIO);N.logger.log("parsed "+t.type+",PTS:["+t.startPTS.toFixed(3)+","+t.endPTS.toFixed(3)+"],DTS:["+t.startDTS.toFixed(3)+"/"+t.endDTS.toFixed(3)+"],nb:"+t.nb);c.updateFragPTSDTS(n.details,e,t.startPTS,t.endPTS);var o=this.audioSwitch,l=this.media,u=false;if(o&&l){if(l.readyState){var f=l.currentTime;N.logger.log("switching audio track : currentTime:"+f);if(f>=t.startPTS){N.logger.log("switching audio track : flushing all audio");this.state=B.State.BUFFER_FLUSHING;s.trigger(M.default.BUFFER_FLUSHING,{startOffset:0,endOffset:C.POSITIVE_INFINITY,type:"audio"});u=true;this.audioSwitch=false;s.trigger(M.default.AUDIO_TRACK_SWITCHED,{id:a})}}else{this.audioSwitch=false;s.trigger(M.default.AUDIO_TRACK_SWITCHED,{id:a})}}var d=this.pendingData;if(!d){N.logger.warn("Apparently attempt to enqueue media payload without codec initialization data upfront");s.trigger(M.default.ERROR,{type:h.ErrorTypes.MEDIA_ERROR,details:null,fatal:true});return}if(!this.audioSwitch){[t.data1,t.data2].forEach(function(e){if(e&&e.length){d.push({type:t.type,data:e,parent:"audio",content:"data"})}});if(!u&&d.length){d.forEach(function(e){if(r.state===B.State.PARSING){r.pendingBuffering=true;r.hls.trigger(M.default.BUFFER_APPENDING,e)}});this.pendingData=[];this.appended=true}}this.tick()}};e.prototype.onFragParsed=function(e){var t=this.fragCurrent;var r=e.frag;if(t&&e.id==="audio"&&r.sn===t.sn&&r.level===t.level&&this.state===B.State.PARSING){this.stats.tparsed=G.now();this.state=B.State.PARSED;this._checkAppendedParsed()}};e.prototype.onBufferReset=function(){this.mediaBuffer=this.videoBuffer=null;this.loadedmetadata=false};e.prototype.onBufferCreated=function(e){var t=e.tracks.audio;if(t){this.mediaBuffer=t.buffer;this.loadedmetadata=true}if(e.tracks.video){this.videoBuffer=e.tracks.video.buffer}};e.prototype.onBufferAppended=function(e){if(e.parent==="audio"){var t=this.state;if(t===B.State.PARSING||t===B.State.PARSED){this.pendingBuffering=e.pending>0;this._checkAppendedParsed()}}};e.prototype._checkAppendedParsed=function(){if(this.state===B.State.PARSED&&(!this.appended||!this.pendingBuffering)){var e=this.fragCurrent,t=this.stats,r=this.hls;if(e){this.fragPrevious=e;t.tbuffered=G.now();r.trigger(M.default.FRAG_BUFFERED,{stats:t,frag:e,id:"audio"});var i=this.mediaBuffer?this.mediaBuffer:this.media;N.logger.log("audio buffered : "+a.default.toString(i.buffered));if(this.audioSwitch&&this.appended){this.audioSwitch=false;r.trigger(M.default.AUDIO_TRACK_SWITCHED,{id:this.trackId})}this.state=B.State.IDLE}this.tick()}};e.prototype.onError=function(e){var t=e.frag;if(t&&t.type!=="audio"){return}switch(e.details){case h.ErrorDetails.FRAG_LOAD_ERROR:case h.ErrorDetails.FRAG_LOAD_TIMEOUT:var r=e.frag;if(r&&r.type!=="audio"){break}if(!e.fatal){var i=this.fragLoadError;if(i){i++}else{i=1}var a=this.config;if(i<=a.fragLoadingMaxRetry){this.fragLoadError=i;var n=Math.min(Math.pow(2,i-1)*a.fragLoadingRetryDelay,a.fragLoadingMaxRetryTimeout);N.logger.warn("AudioStreamController: frag loading failed, retry in "+n+" ms");this.retryDate=G.now()+n;this.state=B.State.FRAG_LOADING_WAITING_RETRY}else{N.logger.error("AudioStreamController: "+e.details+" reaches max retry, redispatch as fatal ...");e.fatal=true;this.state=B.State.ERROR}}break;case h.ErrorDetails.AUDIO_TRACK_LOAD_ERROR:case h.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:case h.ErrorDetails.KEY_LOAD_ERROR:case h.ErrorDetails.KEY_LOAD_TIMEOUT:if(this.state!==B.State.ERROR){this.state=e.fatal?B.State.ERROR:B.State.IDLE;N.logger.warn("AudioStreamController: "+e.details+" while loading frag, now switching to "+this.state+" state ...")}break;case h.ErrorDetails.BUFFER_FULL_ERROR:if(e.parent==="audio"&&(this.state===B.State.PARSING||this.state===B.State.PARSED)){var s=this.mediaBuffer,o=this.media.currentTime,l=s&&F.BufferHelper.isBuffered(s,o)&&F.BufferHelper.isBuffered(s,o+.5);if(l){var a=this.config;if(a.maxMaxBufferLength>=a.maxBufferLength){a.maxMaxBufferLength/=2;N.logger.warn("AudioStreamController: reduce max buffer length to "+a.maxMaxBufferLength+"s")}this.state=B.State.IDLE}else{N.logger.warn("AudioStreamController: buffer full error also media.currentTime is not buffered, flush audio buffer");this.fragCurrent=null;this.state=B.State.BUFFER_FLUSHING;this.hls.trigger(M.default.BUFFER_FLUSHING,{startOffset:0,endOffset:C.POSITIVE_INFINITY,type:"audio"})}}break;default:break}};e.prototype.onBufferFlushed=function(){var t=this;var e=this.pendingData;if(e&&e.length){N.logger.log("AudioStreamController: appending pending audio data after buffer flushed");e.forEach(function(e){t.hls.trigger(M.default.BUFFER_APPENDING,e)});this.appended=true;this.pendingData=[];this.state=B.State.PARSED}else{this.state=B.State.IDLE;this.fragPrevious=null;this.tick()}};return e}(B.default);i.default=e}).call(this,n("./src/polyfills/number.js")["Number"])},"./src/controller/audio-track-controller.js":function(e,t,r){"use strict";var i=this&&this.__extends||function(){var i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r]};return function(e,t){i(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:true});var o=r("./src/events.js");var a=r("./src/task-loop.js");var l=r("./src/utils/logger.js");var u=r("./src/errors.js");var n=function(r){i(e,r);function e(e){var t=r.call(this,e,o.default.MANIFEST_LOADING,o.default.MANIFEST_PARSED,o.default.AUDIO_TRACK_LOADED,o.default.AUDIO_TRACK_SWITCHED,o.default.LEVEL_LOADED,o.default.ERROR)||this;t._trackId=-1;t._selectDefaultTrack=true;t.tracks=[];t.trackIdBlacklist=Object.create(null);t.audioGroupId=null;return t}e.prototype.onManifestLoading=function(){this.tracks=[];this._trackId=-1;this._selectDefaultTrack=true};e.prototype.onManifestParsed=function(e){var t=this.tracks=e.audioTracks||[];this.hls.trigger(o.default.AUDIO_TRACKS_UPDATED,{audioTracks:t})};e.prototype.onAudioTrackLoaded=function(e){if(e.id>=this.tracks.length){l.logger.warn("Invalid audio track id:",e.id);return}l.logger.log("audioTrack "+e.id+" loaded");this.tracks[e.id].details=e.details;if(e.details.live&&!this.hasInterval()){var t=e.details.targetduration*1e3;this.setInterval(t)}if(!e.details.live&&this.hasInterval()){this.clearInterval()}};e.prototype.onAudioTrackSwitched=function(e){var t=this.tracks[e.id].groupId;if(t&&this.audioGroupId!==t){this.audioGroupId=t}};e.prototype.onLevelLoaded=function(e){var t=this.hls.levels[e.level];if(!t.audioGroupIds){return}var r=t.audioGroupIds[t.urlId];if(this.audioGroupId!==r){this.audioGroupId=r;this._selectInitialAudioTrack()}};e.prototype.onError=function(e){if(e.type!==u.ErrorTypes.NETWORK_ERROR){return}if(e.fatal){this.clearInterval()}if(e.details!==u.ErrorDetails.AUDIO_TRACK_LOAD_ERROR){return}l.logger.warn("Network failure on audio-track id:",e.context.id);this._handleLoadError()};Object.defineProperty(e.prototype,"audioTracks",{get:function(){return this.tracks},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"audioTrack",{get:function(){return this._trackId},set:function(e){this._setAudioTrack(e);this._selectDefaultTrack=false},enumerable:true,configurable:true});e.prototype._setAudioTrack=function(e){if(this._trackId===e&&this.tracks[this._trackId].details){l.logger.debug("Same id as current audio-track passed, and track details available -> no-op");return}if(e<0||e>=this.tracks.length){l.logger.warn("Invalid id passed to audio-track controller");return}var t=this.tracks[e];l.logger.log("Now switching to audio-track index "+e);this.clearInterval();this._trackId=e;var r=t.url,i=t.type,a=t.id;this.hls.trigger(o.default.AUDIO_TRACK_SWITCHING,{id:a,type:i,url:r});this._loadTrackDetailsIfNeeded(t)};e.prototype.doTick=function(){this._updateTrack(this._trackId)};e.prototype._selectInitialAudioTrack=function(){var t=this;var e=this.tracks;if(!e.length){return}var r=this.tracks[this._trackId];var i=null;if(r){i=r.name}if(this._selectDefaultTrack){var a=e.filter(function(e){return e.default});if(a.length){e=a}else{l.logger.warn("No default audio tracks defined")}}var n=false;var s=function(){e.forEach(function(e){if(n){return}if((!t.audioGroupId||e.groupId===t.audioGroupId)&&(!i||i===e.name)){t._setAudioTrack(e.id);n=true}})};s();if(!n){i=null;s()}if(!n){l.logger.error("No track found for running audio group-ID: "+this.audioGroupId);this.hls.trigger(o.default.ERROR,{type:u.ErrorTypes.MEDIA_ERROR,details:u.ErrorDetails.AUDIO_TRACK_LOAD_ERROR,fatal:true})}};e.prototype._needsTrackLoading=function(e){var t=e.details,r=e.url;if(!t||t.live){return!!r}return false};e.prototype._loadTrackDetailsIfNeeded=function(e){if(this._needsTrackLoading(e)){var t=e.url,r=e.id;l.logger.log("loading audio-track playlist for id: "+r);this.hls.trigger(o.default.AUDIO_TRACK_LOADING,{url:t,id:r})}};e.prototype._updateTrack=function(e){if(e<0||e>=this.tracks.length){return}this.clearInterval();this._trackId=e;l.logger.log("trying to update audio-track "+e);var t=this.tracks[e];this._loadTrackDetailsIfNeeded(t)};e.prototype._handleLoadError=function(){this.trackIdBlacklist[this._trackId]=true;var e=this._trackId;var t=this.tracks[e],r=t.name,i=t.language,a=t.groupId;l.logger.warn("Loading failed on audio track id: "+e+", group-id: "+a+', name/language: "'+r+'" / "'+i+'"');var n=e;for(var s=0;s<this.tracks.length;s++){if(this.trackIdBlacklist[s]){continue}var o=this.tracks[s];if(o.name===r){n=s;break}}if(n===e){l.logger.warn('No fallback audio-track found for name/language: "'+r+'" / "'+i+'"');return}l.logger.log("Attempting audio-track fallback id:",n,"group-id:",this.tracks[n].groupId);this._setAudioTrack(n)};return e}(a.default);t.default=n},"./src/controller/base-stream-controller.js":function(e,p,i){"use strict";(function(d){var r=this&&this.__extends||function(){var i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r]};return function(e,t){i(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}();Object.defineProperty(p,"__esModule",{value:true});var e=i("./src/task-loop.js");var s=i("./src/controller/fragment-tracker.js");var c=i("./src/utils/buffer-helper.js");var h=i("./src/utils/logger.js");p.State={STOPPED:"STOPPED",STARTING:"STARTING",IDLE:"IDLE",PAUSED:"PAUSED",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",BUFFER_FLUSHING:"BUFFER_FLUSHING",ENDED:"ENDED",ERROR:"ERROR",WAITING_INIT_PTS:"WAITING_INIT_PTS",WAITING_LEVEL:"WAITING_LEVEL"};var t=function(e){r(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}t.prototype.doTick=function(){};t.prototype.startLoad=function(){};t.prototype.stopLoad=function(){var e=this.fragCurrent;if(e){if(e.loader){e.loader.abort()}this.fragmentTracker.removeFragment(e)}if(this.demuxer){this.demuxer.destroy();this.demuxer=null}this.fragCurrent=null;this.fragPrevious=null;this.clearInterval();this.clearNextTick();this.state=p.State.STOPPED};t.prototype._streamEnded=function(e,t){var r=this,i=r.fragCurrent,a=r.fragmentTracker;if(!t.live&&i&&!i.backtracked&&i.sn===t.endSN&&!e.nextStart){var n=a.getState(i);return n===s.FragmentState.PARTIAL||n===s.FragmentState.OK}return false};t.prototype.onMediaSeeking=function(){var e=this,t=e.config,r=e.media,i=e.mediaBuffer,a=e.state;var n=r?r.currentTime:null;var s=c.BufferHelper.bufferInfo(i||r,n,this.config.maxBufferHole);if(d.isFinite(n)){h.logger.log("media seeking to "+n.toFixed(3))}if(a===p.State.FRAG_LOADING){var o=this.fragCurrent;if(s.len===0&&o){var l=t.maxFragLookUpTolerance;var u=o.start-l;var f=o.start+o.duration+l;if(n<u||n>f){if(o.loader){h.logger.log("seeking outside of buffer while fragment load in progress, cancel fragment load");o.loader.abort()}this.fragCurrent=null;this.fragPrevious=null;this.state=p.State.IDLE}else{h.logger.log("seeking outside of buffer but within currently loaded fragment range")}}}else if(a===p.State.ENDED){if(s.len===0){this.fragPrevious=null;this.fragCurrent=null}this.state=p.State.IDLE}if(r){this.lastCurrentTime=n}if(!this.loadedmetadata){this.nextLoadPosition=this.startPosition=n}this.tick()};t.prototype.onMediaEnded=function(){this.startPosition=this.lastCurrentTime=0};t.prototype.onHandlerDestroying=function(){this.stopLoad();e.prototype.onHandlerDestroying.call(this)};t.prototype.onHandlerDestroyed=function(){this.state=p.State.STOPPED;this.fragmentTracker=null};return t}(e.default);p.default=t}).call(this,i("./src/polyfills/number.js")["Number"])},"./src/controller/buffer-controller.js":function(e,s,o){"use strict";(function(i){var t=this&&this.__extends||function(){var i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r]};return function(e,t){i(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}();Object.defineProperty(s,"__esModule",{value:true});var l=o("./src/events.js");var a=o("./src/event-handler.js");var u=o("./src/utils/logger.js");var f=o("./src/errors.js");var e=o("./src/utils/mediasource-helper.js");var n=e.getMediaSource();var r=function(r){t(e,r);function e(e){var t=r.call(this,e,l.default.MEDIA_ATTACHING,l.default.MEDIA_DETACHING,l.default.MANIFEST_PARSED,l.default.BUFFER_RESET,l.default.BUFFER_APPENDING,l.default.BUFFER_CODECS,l.default.BUFFER_EOS,l.default.BUFFER_FLUSHING,l.default.LEVEL_PTS_UPDATED,l.default.LEVEL_UPDATED)||this;t._msDuration=null;t._levelDuration=null;t._levelTargetDuration=10;t._live=null;t._objectUrl=null;t.bufferCodecEventsExpected=0;t.onsbue=t.onSBUpdateEnd.bind(t);t.onsbe=t.onSBUpdateError.bind(t);t.pendingTracks={};t.tracks={};return t}e.prototype.destroy=function(){a.default.prototype.destroy.call(this)};e.prototype.onLevelPtsUpdated=function(e){var t=e.type;var r=this.tracks.audio;if(t==="audio"&&r&&r.container==="audio/mpeg"){var i=this.sourceBuffer.audio;var a=Math.abs(i.timestampOffset-e.start);if(a>.1){var n=i.updating;try{i.abort()}catch(e){u.logger.warn("can not abort audio buffer: "+e)}if(!n){u.logger.warn("change mpeg audio timestamp offset from "+i.timestampOffset+" to "+e.start);i.timestampOffset=e.start}else{this.audioTimestampOffset=e.start}}}};e.prototype.onManifestParsed=function(e){this.bufferCodecEventsExpected=e.altAudio?2:1;u.logger.log(this.bufferCodecEventsExpected+" bufferCodec event(s) expected")};e.prototype.onMediaAttaching=function(e){var t=this.media=e.media;if(t){var r=this.mediaSource=new n;this.onmso=this.onMediaSourceOpen.bind(this);this.onmse=this.onMediaSourceEnded.bind(this);this.onmsc=this.onMediaSourceClose.bind(this);r.addEventListener("sourceopen",this.onmso);r.addEventListener("sourceended",this.onmse);r.addEventListener("sourceclose",this.onmsc);t.src=window.URL.createObjectURL(r);this._objectUrl=t.src}};e.prototype.onMediaDetaching=function(){u.logger.log("media source detaching");var e=this.mediaSource;if(e){if(e.readyState==="open"){try{e.endOfStream()}catch(e){u.logger.warn("onMediaDetaching:"+e.message+" while calling endOfStream")}}e.removeEventListener("sourceopen",this.onmso);e.removeEventListener("sourceended",this.onmse);e.removeEventListener("sourceclose",this.onmsc);if(this.media){window.URL.revokeObjectURL(this._objectUrl);if(this.media.src===this._objectUrl){this.media.removeAttribute("src");this.media.load()}else{u.logger.warn("media.src was changed by a third party - skip cleanup")}}this.mediaSource=null;this.media=null;this._objectUrl=null;this.pendingTracks={};this.tracks={};this.sourceBuffer={};this.flushRange=[];this.segments=[];this.appended=0}this.onmso=this.onmse=this.onmsc=null;this.hls.trigger(l.default.MEDIA_DETACHED)};e.prototype.onMediaSourceOpen=function(){u.logger.log("media source opened");this.hls.trigger(l.default.MEDIA_ATTACHED,{media:this.media});var e=this.mediaSource;if(e){e.removeEventListener("sourceopen",this.onmso)}this.checkPendingTracks()};e.prototype.checkPendingTracks=function(){var e=this,t=e.bufferCodecEventsExpected,r=e.pendingTracks;var i=Object.keys(r).length;if(i&&!t||i===2){this.createSourceBuffers(r);this.pendingTracks={};this.doAppending()}};e.prototype.onMediaSourceClose=function(){u.logger.log("media source closed")};e.prototype.onMediaSourceEnded=function(){u.logger.log("media source ended")};e.prototype.onSBUpdateEnd=function(){if(this.audioTimestampOffset){var e=this.sourceBuffer.audio;u.logger.warn("change mpeg audio timestamp offset from "+e.timestampOffset+" to "+this.audioTimestampOffset);e.timestampOffset=this.audioTimestampOffset;delete this.audioTimestampOffset}if(this._needsFlush){this.doFlush()}if(this._needsEos){this.checkEos()}this.appending=false;var r=this.parent;var t=this.segments.reduce(function(e,t){return t.parent===r?e+1:e},0);var i={};var a=this.sourceBuffer;for(var n in a){i[n]=a[n].buffered}this.hls.trigger(l.default.BUFFER_APPENDED,{parent:r,pending:t,timeRanges:i});if(!this._needsFlush){this.doAppending()}this.updateMediaElementDuration();if(t===0){this.flushLiveBackBuffer()}};e.prototype.onSBUpdateError=function(e){u.logger.error("sourceBuffer error:",e);this.hls.trigger(l.default.ERROR,{type:f.ErrorTypes.MEDIA_ERROR,details:f.ErrorDetails.BUFFER_APPENDING_ERROR,fatal:false})};e.prototype.onBufferReset=function(){var e=this.sourceBuffer;for(var t in e){var r=e[t];try{this.mediaSource.removeSourceBuffer(r);r.removeEventListener("updateend",this.onsbue);r.removeEventListener("error",this.onsbe)}catch(e){}}this.sourceBuffer={};this.flushRange=[];this.segments=[];this.appended=0};e.prototype.onBufferCodecs=function(t){var r=this;if(Object.keys(this.sourceBuffer).length){return}Object.keys(t).forEach(function(e){r.pendingTracks[e]=t[e]});var e=this.mediaSource;this.bufferCodecEventsExpected=Math.max(this.bufferCodecEventsExpected-1,0);if(e&&e.readyState==="open"){this.checkPendingTracks()}};e.prototype.createSourceBuffers=function(e){var t=this.sourceBuffer,r=this.mediaSource;for(var i in e){if(!t[i]){var a=e[i];var n=a.levelCodec||a.codec;var s=a.container+";codecs="+n;u.logger.log("creating sourceBuffer("+s+")");try{var o=t[i]=r.addSourceBuffer(s);o.addEventListener("updateend",this.onsbue);o.addEventListener("error",this.onsbe);this.tracks[i]={codec:n,container:a.container};a.buffer=o}catch(e){u.logger.error("error while trying to add sourceBuffer:"+e.message);this.hls.trigger(l.default.ERROR,{type:f.ErrorTypes.MEDIA_ERROR,details:f.ErrorDetails.BUFFER_ADD_CODEC_ERROR,fatal:false,err:e,mimeType:s})}}}this.hls.trigger(l.default.BUFFER_CREATED,{tracks:e})};e.prototype.onBufferAppending=function(e){if(!this._needsFlush){if(!this.segments){this.segments=[e]}else{this.segments.push(e)}this.doAppending()}};e.prototype.onBufferAppendFail=function(e){u.logger.error("sourceBuffer error:",e.event);this.hls.trigger(l.default.ERROR,{type:f.ErrorTypes.MEDIA_ERROR,details:f.ErrorDetails.BUFFER_APPENDING_ERROR,fatal:false})};e.prototype.onBufferEos=function(e){var t=this.sourceBuffer;var r=e.type;for(var i in t){if(!r||i===r){if(!t[i].ended){t[i].ended=true;u.logger.log(i+" sourceBuffer now EOS")}}}this.checkEos()};e.prototype.checkEos=function(){var e=this.sourceBuffer,t=this.mediaSource;if(!t||t.readyState!=="open"){this._needsEos=false;return}for(var r in e){var i=e[r];if(!i.ended){return}if(i.updating){this._needsEos=true;return}}u.logger.log("all media data are available, signal endOfStream() to MediaSource and stop loading fragment");try{t.endOfStream()}catch(e){u.logger.warn("exception while calling mediaSource.endOfStream()")}this._needsEos=false};e.prototype.onBufferFlushing=function(e){this.flushRange.push({start:e.startOffset,end:e.endOffset,type:e.type});this.flushBufferCounter=0;this.doFlush()};e.prototype.flushLiveBackBuffer=function(){if(!this._live){return}var e=this.hls.config.liveBackBufferLength;if(!isFinite(e)||e<0){return}var t=this.media.currentTime;var r=this.sourceBuffer;var i=Object.keys(r);var a=t-Math.max(e,this._levelTargetDuration);for(var n=i.length-1;n>=0;n--){var s=i[n],o=r[s].buffered;if(o.length>0&&a>o.start(0)){this.removeBufferRange(s,r[s],0,a)}}};e.prototype.onLevelUpdated=function(e){var t=e.details;if(t.fragments.length>0){this._levelDuration=t.totalduration+t.fragments[0].start;this._levelTargetDuration=t.averagetargetduration||t.targetduration||10;this._live=t.live;this.updateMediaElementDuration()}};e.prototype.updateMediaElementDuration=function(){var e=this.hls.config;var t;if(this._levelDuration===null||!this.media||!this.mediaSource||!this.sourceBuffer||this.media.readyState===0||this.mediaSource.readyState!=="open"){return}for(var r in this.sourceBuffer){if(this.sourceBuffer[r].updating===true){return}}t=this.media.duration;if(this._msDuration===null){this._msDuration=this.mediaSource.duration}if(this._live===true&&e.liveDurationInfinity===true){u.logger.log("Media Source duration is set to Infinity");this._msDuration=this.mediaSource.duration=Infinity}else if(this._levelDuration>this._msDuration&&this._levelDuration>t||!i.isFinite(t)){u.logger.log("Updating Media Source duration to "+this._levelDuration.toFixed(3));this._msDuration=this.mediaSource.duration=this._levelDuration}};e.prototype.doFlush=function(){while(this.flushRange.length){var e=this.flushRange[0];if(this.flushBuffer(e.start,e.end,e.type)){this.flushRange.shift();this.flushBufferCounter=0}else{this._needsFlush=true;return}}if(this.flushRange.length===0){this._needsFlush=false;var t=0;var r=this.sourceBuffer;try{for(var i in r){t+=r[i].buffered.length}}catch(e){u.logger.error("error while accessing sourceBuffer.buffered")}this.appended=t;this.hls.trigger(l.default.BUFFER_FLUSHED)}};e.prototype.doAppending=function(){var e=this,t=e.hls,r=e.segments,i=e.sourceBuffer;if(Object.keys(i).length){if(this.media.error){this.segments=[];u.logger.error("trying to append although a media error occured, flush segment and abort");return}if(this.appending){return}if(r&&r.length){var a=r.shift();try{var n=a.type,s=i[n];if(s){if(!s.updating){s.ended=false;this.parent=a.parent;s.appendBuffer(a.data);this.appendError=0;this.appended++;this.appending=true}else{r.unshift(a)}}else{this.onSBUpdateEnd()}}catch(e){u.logger.error("error while trying to append buffer:"+e.message);r.unshift(a);var o={type:f.ErrorTypes.MEDIA_ERROR,parent:a.parent};if(e.code!==22){if(this.appendError){this.appendError++}else{this.appendError=1}o.details=f.ErrorDetails.BUFFER_APPEND_ERROR;if(this.appendError>t.config.appendErrorMaxRetry){u.logger.log("fail "+t.config.appendErrorMaxRetry+" times to append segment in sourceBuffer");this.segments=[];o.fatal=true;t.trigger(l.default.ERROR,o)}else{o.fatal=false;t.trigger(l.default.ERROR,o)}}else{this.segments=[];o.details=f.ErrorDetails.BUFFER_FULL_ERROR;o.fatal=false;t.trigger(l.default.ERROR,o)}}}}};e.prototype.flushBuffer=function(e,t,r){var i;var a=this.sourceBuffer;if(Object.keys(a).length){u.logger.log("flushBuffer,pos/start/end: "+this.media.currentTime.toFixed(3)+"/"+e+"/"+t);if(this.flushBufferCounter<this.appended){for(var n in a){if(r&&n!==r){continue}i=a[n];i.ended=false;if(!i.updating){if(this.removeBufferRange(n,i,e,t)){this.flushBufferCounter++;return false}}else{u.logger.warn("cannot flush, sb updating in progress");return false}}}else{u.logger.warn("abort flushing too many retries")}u.logger.log("buffer flushed")}return true};e.prototype.removeBufferRange=function(e,t,r,i){try{for(var a=0;a<t.buffered.length;a++){var n=t.buffered.start(a);var s=t.buffered.end(a);var o=Math.max(n,r);var l=Math.min(s,i);if(Math.min(l,s)-o>.5){u.logger.log("sb remove "+e+" ["+o+","+l+"], of ["+n+","+s+"], pos:"+this.media.currentTime);t.remove(o,l);return true}}}catch(e){u.logger.warn("removeBufferRange failed",e)}return false};return e}(a.default);s.default=r}).call(this,o("./src/polyfills/number.js")["Number"])},"./src/controller/cap-level-controller.js":function(e,a,s){"use strict";(function(i){var e=this&&this.__extends||function(){var i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r]};return function(e,t){i(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}();Object.defineProperty(a,"__esModule",{value:true});var n=s("./src/events.js");var t=s("./src/event-handler.js");var r=function(r){e(a,r);function a(e){var t=r.call(this,e,n.default.FPS_DROP_LEVEL_CAPPING,n.default.MEDIA_ATTACHING,n.default.MANIFEST_PARSED,n.default.BUFFER_CODECS,n.default.MEDIA_DETACHING)||this;t.autoLevelCapping=i.POSITIVE_INFINITY;t.firstLevel=null;t.levels=[];t.media=null;t.restrictedLevels=[];t.timer=null;return t}a.prototype.destroy=function(){if(this.hls.config.capLevelToPlayerSize){this.media=null;this._stopCapping()}};a.prototype.onFpsDropLevelCapping=function(e){if(a.isLevelAllowed(e.droppedLevel,this.restrictedLevels)){this.restrictedLevels.push(e.droppedLevel)}};a.prototype.onMediaAttaching=function(e){this.media=e.media instanceof window.HTMLVideoElement?e.media:null};a.prototype.onManifestParsed=function(e){var t=this.hls;this.restrictedLevels=[];this.levels=e.levels;this.firstLevel=e.firstLevel;if(t.config.capLevelToPlayerSize&&e.video){this._startCapping()}};a.prototype.onBufferCodecs=function(e){var t=this.hls;if(t.config.capLevelToPlayerSize&&e.video){this._startCapping()}};a.prototype.onLevelsUpdated=function(e){this.levels=e.levels};a.prototype.onMediaDetaching=function(){this._stopCapping()};a.prototype.detectPlayerSize=function(){if(this.media){var e=this.levels?this.levels.length:0;if(e){var t=this.hls;t.autoLevelCapping=this.getMaxLevel(e-1);if(t.autoLevelCapping>this.autoLevelCapping){t.streamController.nextLevelSwitch()}this.autoLevelCapping=t.autoLevelCapping}}};a.prototype.getMaxLevel=function(r){var i=this;if(!this.levels){return-1}var e=this.levels.filter(function(e,t){return a.isLevelAllowed(t,i.restrictedLevels)&&t<=r});return a.getMaxLevelByMediaSize(e,this.mediaWidth,this.mediaHeight)};a.prototype._startCapping=function(){if(this.timer){return}this.autoLevelCapping=i.POSITIVE_INFINITY;this.hls.firstLevel=this.getMaxLevel(this.firstLevel);clearInterval(this.timer);this.timer=setInterval(this.detectPlayerSize.bind(this),1e3);this.detectPlayerSize()};a.prototype._stopCapping=function(){this.restrictedLevels=[];this.firstLevel=null;this.autoLevelCapping=i.POSITIVE_INFINITY;if(this.timer){this.timer=clearInterval(this.timer);this.timer=null}};Object.defineProperty(a.prototype,"mediaWidth",{get:function(){var e;var t=this.media;if(t){e=t.width||t.clientWidth||t.offsetWidth;e*=a.contentScaleFactor}return e},enumerable:true,configurable:true});Object.defineProperty(a.prototype,"mediaHeight",{get:function(){var e;var t=this.media;if(t){e=t.height||t.clientHeight||t.offsetHeight;e*=a.contentScaleFactor}return e},enumerable:true,configurable:true});Object.defineProperty(a,"contentScaleFactor",{get:function(){var e=1;try{e=window.devicePixelRatio}catch(e){}return e},enumerable:true,configurable:true});a.isLevelAllowed=function(e,t){if(t===void 0){t=[]}return t.indexOf(e)===-1};a.getMaxLevelByMediaSize=function(e,t,r){if(!e||e&&!e.length){return-1}var i=function(e,t){if(!t){return true}return e.width!==t.width||e.height!==t.height};var a=e.length-1;for(var n=0;n<e.length;n+=1){var s=e[n];if((s.width>=t||s.height>=r)&&i(s,e[n+1])){a=n;break}}return a};return a}(t.default);a.default=r}).call(this,s("./src/polyfills/number.js")["Number"])},"./src/controller/eme-controller.js":function(e,t,r){"use strict";var i=this&&this.__extends||function(){var i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r]};return function(e,t){i(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:true});var a=r("./src/event-handler.js");var n=r("./src/events.js");var s=r("./src/errors.js");var o=r("./src/utils/logger.js");var l=window.XMLHttpRequest;var u=3;var f={WIDEVINE:"com.widevine.alpha",PLAYREADY:"com.microsoft.playready"};var d=function(e,t,r){var i={videoCapabilities:[]};t.forEach(function(e){i.videoCapabilities.push({contentType:'video/mp4; codecs="'+e+'"'})});return[i]};var c=function(e,t,r){switch(e){case f.WIDEVINE:return d(t,r);default:throw Error("Unknown key-system: "+e)}};var h=function(r){i(e,r);function e(e){var t=r.call(this,e,n.default.MEDIA_ATTACHED,n.default.MANIFEST_PARSED)||this;t._widevineLicenseUrl=e.config.widevineLicenseUrl;t._licenseXhrSetup=e.config.licenseXhrSetup;t._emeEnabled=e.config.emeEnabled;t._requestMediaKeySystemAccess=e.config.requestMediaKeySystemAccessFunc;t._mediaKeysList=[];t._media=null;t._hasSetMediaKeys=false;t._isMediaEncrypted=false;t._requestLicenseFailureCount=0;return t}e.prototype.getLicenseServerUrl=function(e){var t;switch(e){case f.WIDEVINE:t=this._widevineLicenseUrl;break;default:t=null;break}if(!t){o.logger.error('No license server URL configured for key-system "'+e+'"');this.hls.trigger(n.default.ERROR,{type:s.ErrorTypes.KEY_SYSTEM_ERROR,details:s.ErrorDetails.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:true})}return t};e.prototype._attemptKeySystemAccess=function(t,e,r){var i=this;var a=c(t,e,r);if(!a){o.logger.warn("Can not create config for key-system (maybe because platform is not supported):",t);return}o.logger.log("Requesting encrypted media key-system access");this.requestMediaKeySystemAccess(t,a).then(function(e){i._onMediaKeySystemAccessObtained(t,e)}).catch(function(e){o.logger.error('Failed to obtain key-system "'+t+'" access:',e)})};Object.defineProperty(e.prototype,"requestMediaKeySystemAccess",{get:function(){if(!this._requestMediaKeySystemAccess){throw new Error("No requestMediaKeySystemAccess function configured")}return this._requestMediaKeySystemAccess},enumerable:true,configurable:true});e.prototype._onMediaKeySystemAccessObtained=function(t,e){var r=this;o.logger.log('Access for key-system "'+t+'" obtained');var i={mediaKeys:null,mediaKeysSession:null,mediaKeysSessionInitialized:false,mediaKeySystemAccess:e,mediaKeySystemDomain:t};this._mediaKeysList.push(i);e.createMediaKeys().then(function(e){i.mediaKeys=e;o.logger.log('Media-keys created for key-system "'+t+'"');r._onMediaKeysCreated()}).catch(function(e){o.logger.error("Failed to create media-keys:",e)})};e.prototype._onMediaKeysCreated=function(){var t=this;this._mediaKeysList.forEach(function(e){if(!e.mediaKeysSession){e.mediaKeysSession=e.mediaKeys.createSession();t._onNewMediaKeySession(e.mediaKeysSession)}})};e.prototype._onNewMediaKeySession=function(t){var r=this;o.logger.log("New key-system session "+t.sessionId);t.addEventListener("message",function(e){r._onKeySessionMessage(t,e.message)},false)};e.prototype._onKeySessionMessage=function(t,e){o.logger.log("Got EME message event, creating license request");this._requestLicense(e,function(e){o.logger.log("Received license data, updating key-session");t.update(e)})};e.prototype._onMediaEncrypted=function(e,t){o.logger.log('Media is encrypted using "'+e+'" init data type');this._isMediaEncrypted=true;this._mediaEncryptionInitDataType=e;this._mediaEncryptionInitData=t;this._attemptSetMediaKeys();this._generateRequestWithPreferredKeySession()};e.prototype._attemptSetMediaKeys=function(){if(!this._hasSetMediaKeys){var e=this._mediaKeysList[0];if(!e||!e.mediaKeys){o.logger.error("Fatal: Media is encrypted but no CDM access or no keys have been obtained yet");this.hls.trigger(n.default.ERROR,{type:s.ErrorTypes.KEY_SYSTEM_ERROR,details:s.ErrorDetails.KEY_SYSTEM_NO_KEYS,fatal:true});return}o.logger.log("Setting keys for encrypted media");this._media.setMediaKeys(e.mediaKeys);this._hasSetMediaKeys=true}};e.prototype._generateRequestWithPreferredKeySession=function(){var t=this;var e=this._mediaKeysList[0];if(!e){o.logger.error("Fatal: Media is encrypted but not any key-system access has been obtained yet");this.hls.trigger(n.default.ERROR,{type:s.ErrorTypes.KEY_SYSTEM_ERROR,details:s.ErrorDetails.KEY_SYSTEM_NO_ACCESS,fatal:true});return}if(e.mediaKeysSessionInitialized){o.logger.warn("Key-Session already initialized but requested again");return}var r=e.mediaKeysSession;if(!r){o.logger.error("Fatal: Media is encrypted but no key-session existing");this.hls.trigger(n.default.ERROR,{type:s.ErrorTypes.KEY_SYSTEM_ERROR,details:s.ErrorDetails.KEY_SYSTEM_NO_SESSION,fatal:true})}var i=this._mediaEncryptionInitDataType;var a=this._mediaEncryptionInitData;o.logger.log('Generating key-session request for "'+i+'" init data type');e.mediaKeysSessionInitialized=true;r.generateRequest(i,a).then(function(){o.logger.debug("Key-session generation succeeded")}).catch(function(e){o.logger.error("Error generating key-session request:",e);t.hls.trigger(n.default.ERROR,{type:s.ErrorTypes.KEY_SYSTEM_ERROR,details:s.ErrorDetails.KEY_SYSTEM_NO_SESSION,fatal:false})})};e.prototype._createLicenseXhr=function(t,e,r){var i=new l;var a=this._licenseXhrSetup;try{if(a){try{a(i,t)}catch(e){i.open("POST",t,true);a(i,t)}}if(!i.readyState){i.open("POST",t,true)}}catch(e){o.logger.error("Error setting up key-system license XHR",e);this.hls.trigger(n.default.ERROR,{type:s.ErrorTypes.KEY_SYSTEM_ERROR,details:s.ErrorDetails.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:true});return}i.responseType="arraybuffer";i.onreadystatechange=this._onLicenseRequestReadyStageChange.bind(this,i,t,e,r);return i};e.prototype._onLicenseRequestReadyStageChange=function(e,t,r,i){switch(e.readyState){case 4:if(e.status===200){this._requestLicenseFailureCount=0;o.logger.log("License request succeeded");i(e.response)}else{o.logger.error("License Request XHR failed ("+t+"). Status: "+e.status+" ("+e.statusText+")");this._requestLicenseFailureCount++;if(this._requestLicenseFailureCount<=u){var a=u-this._requestLicenseFailureCount+1;o.logger.warn("Retrying license request, "+a+" attempts left");this._requestLicense(r,i);return}this.hls.trigger(n.default.ERROR,{type:s.ErrorTypes.KEY_SYSTEM_ERROR,details:s.ErrorDetails.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:true})}break}};e.prototype._generateLicenseRequestChallenge=function(e,t){var r;if(e.mediaKeySystemDomain===f.PLAYREADY){o.logger.error("PlayReady is not supported (yet)")}else if(e.mediaKeySystemDomain===f.WIDEVINE){r=t}else{o.logger.error("Unsupported key-system:",e.mediaKeySystemDomain)}return r};e.prototype._requestLicense=function(e,t){o.logger.log("Requesting content license for key-system");var r=this._mediaKeysList[0];if(!r){o.logger.error("Fatal error: Media is encrypted but no key-system access has been obtained yet");this.hls.trigger(n.default.ERROR,{type:s.ErrorTypes.KEY_SYSTEM_ERROR,details:s.ErrorDetails.KEY_SYSTEM_NO_ACCESS,fatal:true});return}var i=this.getLicenseServerUrl(r.mediaKeySystemDomain);var a=this._createLicenseXhr(i,e,t);o.logger.log("Sending license request to URL: "+i);a.send(this._generateLicenseRequestChallenge(r,e))};e.prototype.onMediaAttached=function(e){var t=this;if(!this._emeEnabled){return}var r=e.media;this._media=r;r.addEventListener("encrypted",function(e){t._onMediaEncrypted(e.initDataType,e.initData)})};e.prototype.onManifestParsed=function(e){if(!this._emeEnabled){return}var t=e.levels.map(function(e){return e.audioCodec});var r=e.levels.map(function(e){return e.videoCodec});this._attemptKeySystemAccess(f.WIDEVINE,t,r)};return e}(a.default);t.default=h},"./src/controller/fps-controller.js":function(e,t,r){"use strict";var i=this&&this.__extends||function(){var i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r]};return function(e,t){i(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:true});var f=r("./src/events.js");var a=r("./src/event-handler.js");var d=r("./src/utils/logger.js");var c=window.performance;var n=function(t){i(e,t);function e(e){return t.call(this,e,f.default.MEDIA_ATTACHING)||this}e.prototype.destroy=function(){if(this.timer){clearInterval(this.timer)}this.isVideoPlaybackQualityAvailable=false};e.prototype.onMediaAttaching=function(e){var t=this.hls.config;if(t.capLevelOnFPSDrop){var r=this.video=e.media instanceof window.HTMLVideoElement?e.media:null;if(typeof r.getVideoPlaybackQuality==="function"){this.isVideoPlaybackQualityAvailable=true}clearInterval(this.timer);this.timer=setInterval(this.checkFPSInterval.bind(this),t.fpsDroppedMonitoringPeriod)}};e.prototype.checkFPS=function(e,t,r){var i=c.now();if(t){if(this.lastTime){var a=i-this.lastTime,n=r-this.lastDroppedFrames,s=t-this.lastDecodedFrames,o=1e3*n/a,l=this.hls;l.trigger(f.default.FPS_DROP,{currentDropped:n,currentDecoded:s,totalDroppedFrames:r});if(o>0){if(n>l.config.fpsDroppedMonitoringThreshold*s){var u=l.currentLevel;d.logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+u);if(u>0&&(l.autoLevelCapping===-1||l.autoLevelCapping>=u)){u=u-1;l.trigger(f.default.FPS_DROP_LEVEL_CAPPING,{level:u,droppedLevel:l.currentLevel});l.autoLevelCapping=u;l.streamController.nextLevelSwitch()}}}}this.lastTime=i;this.lastDroppedFrames=r;this.lastDecodedFrames=t}};e.prototype.checkFPSInterval=function(){var e=this.video;if(e){if(this.isVideoPlaybackQualityAvailable){var t=e.getVideoPlaybackQuality();this.checkFPS(e,t.totalVideoFrames,t.droppedVideoFrames)}else{this.checkFPS(e,e.webkitDecodedFrameCount,e.webkitDroppedFrameCount)}}};return e}(a.default);t.default=n},"./src/controller/fragment-finders.js":function(e,r,i){"use strict";(function(n){Object.defineProperty(r,"__esModule",{value:true});var s=i("./src/utils/binary-search.js");function e(e,t,r){if(!Array.isArray(e)||!e.length||!n.isFinite(t)){return null}if(t<e[0].programDateTime){return null}if(t>=e[e.length-1].endProgramDateTime){return null}r=r||0;for(var i=0;i<e.length;++i){var a=e[i];if(l(t,r,a)){return a}}return null}r.findFragmentByPDT=e;function t(e,t,r,i){if(r===void 0){r=0}if(i===void 0){i=0}var a=e?t[e.sn-t[0].sn+1]:null;if(a&&!o(r,i,a)){return a}return s.default.search(t,o.bind(null,r,i))}r.findFragmentByPTS=t;function o(e,t,r){if(e===void 0){e=0}if(t===void 0){t=0}var i=Math.min(t,r.duration+(r.deltaPTS?r.deltaPTS:0));if(r.start+r.duration-i<=e){return 1}else if(r.start-i>e&&r.start){return-1}return 0}r.fragmentWithinToleranceTest=o;function l(e,t,r){var i=Math.min(t,r.duration+(r.deltaPTS?r.deltaPTS:0))*1e3;return r.endProgramDateTime-i>e}r.pdtWithinToleranceTest=l}).call(this,i("./src/polyfills/number.js")["Number"])},"./src/controller/fragment-tracker.js":function(e,s,r){"use strict";(function(i){var t=this&&this.__extends||function(){var i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r]};return function(e,t){i(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}();Object.defineProperty(s,"__esModule",{value:true});var a=r("./src/event-handler.js");var n=r("./src/events.js");s.FragmentState={NOT_LOADED:"NOT_LOADED",APPENDING:"APPENDING",PARTIAL:"PARTIAL",OK:"OK"};var e=function(r){t(e,r);function e(e){var t=r.call(this,e,n.default.BUFFER_APPENDED,n.default.FRAG_BUFFERED,n.default.FRAG_LOADED)||this;t.bufferPadding=.2;t.fragments=Object.create(null);t.timeRanges=Object.create(null);t.config=e.config;return t}e.prototype.destroy=function(){this.fragments=Object.create(null);this.timeRanges=Object.create(null);this.config=null;a.default.prototype.destroy.call(this);r.prototype.destroy.call(this)};e.prototype.getBufferedFrag=function(i,a){var n=this.fragments;var e=Object.keys(n).filter(function(e){var t=n[e];if(t.body.type!==a){return false}if(!t.buffered){return false}var r=t.body;return r.startPTS<=i&&i<=r.endPTS});if(e.length===0){return null}else{var t=e.pop();return n[t].body}};e.prototype.detectEvictedFragments=function(a,n){var s=this;var o,l;Object.keys(this.fragments).forEach(function(e){var t=s.fragments[e];if(t.buffered===true){var r=t.range[a];if(r){o=r.time;for(var i=0;i<o.length;i++){l=o[i];if(s.isTimeBuffered(l.startPTS,l.endPTS,n)===false){s.removeFragment(t.body);break}}}}})};e.prototype.detectPartialFragments=function(r){var i=this;var e=this.getFragmentKey(r);var a=this.fragments[e];if(a){a.buffered=true;Object.keys(this.timeRanges).forEach(function(e){if(r.hasElementaryStream(e)){var t=i.timeRanges[e];a.range[e]=i.getBufferedTimes(r.startPTS,r.endPTS,t)}})}};e.prototype.getBufferedTimes=function(e,t,r){var i=[];var a,n;var s=false;for(var o=0;o<r.length;o++){a=r.start(o)-this.bufferPadding;n=r.end(o)+this.bufferPadding;if(e>=a&&t<=n){i.push({startPTS:Math.max(e,r.start(o)),endPTS:Math.min(t,r.end(o))});break}else if(e<n&&t>a){i.push({startPTS:Math.max(e,r.start(o)),endPTS:Math.min(t,r.end(o))});s=true}else if(t<=a){break}}return{time:i,partial:s}};e.prototype.getFragmentKey=function(e){return e.type+"_"+e.level+"_"+e.urlId+"_"+e.sn};e.prototype.getPartialFragment=function(r){var i=this;var a,n,s;var o=null;var l=0;Object.keys(this.fragments).forEach(function(e){var t=i.fragments[e];if(i.isPartial(t)){n=t.body.startPTS-i.bufferPadding;s=t.body.endPTS+i.bufferPadding;if(r>=n&&r<=s){a=Math.min(r-n,s-r);if(l<=a){o=t.body;l=a}}}});return o};e.prototype.getState=function(e){var t=this.getFragmentKey(e);var r=this.fragments[t];var i=s.FragmentState.NOT_LOADED;if(r!==undefined){if(!r.buffered){i=s.FragmentState.APPENDING}else if(this.isPartial(r)===true){i=s.FragmentState.PARTIAL}else{i=s.FragmentState.OK}}return i};e.prototype.isPartial=function(e){return e.buffered===true&&(e.range.video!==undefined&&e.range.video.partial===true||e.range.audio!==undefined&&e.range.audio.partial===true)};e.prototype.isTimeBuffered=function(e,t,r){var i,a;for(var n=0;n<r.length;n++){i=r.start(n)-this.bufferPadding;a=r.end(n)+this.bufferPadding;if(e>=i&&t<=a){return true}if(t<=i){return false}}return false};e.prototype.onFragLoaded=function(e){var t=e.frag;if(!i.isFinite(t.sn)||t.bitrateTest){return}this.fragments[this.getFragmentKey(t)]={body:t,range:Object.create(null),buffered:false}};e.prototype.onBufferAppended=function(e){var r=this;this.timeRanges=e.timeRanges;Object.keys(this.timeRanges).forEach(function(e){var t=r.timeRanges[e];r.detectEvictedFragments(e,t)})};e.prototype.onFragBuffered=function(e){this.detectPartialFragments(e.frag)};e.prototype.hasFragment=function(e){var t=this.getFragmentKey(e);return this.fragments[t]!==undefined};e.prototype.removeFragment=function(e){var t=this.getFragmentKey(e);delete this.fragments[t]};e.prototype.removeAllFragments=function(){this.fragments=Object.create(null)};return e}(a.default);s.FragmentTracker=e}).call(this,r("./src/polyfills/number.js")["Number"])},"./src/controller/gap-controller.js":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});var u=r("./src/utils/buffer-helper.js");var l=r("./src/errors.js");var f=r("./src/events.js");var d=r("./src/utils/logger.js");var c=1e3;var h=.5;var i=function(){function e(e,t,r,i){this.config=e;this.media=t;this.fragmentTracker=r;this.hls=i;this.stallReported=false}e.prototype.poll=function(e,t){var r=this,i=r.config,a=r.media;var n=a.currentTime;var s=window.performance.now();if(n!==e){if(this.stallReported){d.logger.warn("playback not stuck anymore @"+n+", after "+Math.round(s-this.stalled)+"ms");this.stallReported=false}this.stalled=null;this.nudgeRetry=0;return}if(a.ended||!a.buffered.length||a.readyState>2){return}if(a.seeking&&u.BufferHelper.isBuffered(a,n)){return}var o=s-this.stalled;var l=u.BufferHelper.bufferInfo(a,n,i.maxBufferHole);if(!this.stalled){this.stalled=s;return}else if(o>=c){this._reportStall(l.len)}this._tryFixBufferStall(l,o)};e.prototype._tryFixBufferStall=function(e,t){var r=this,i=r.config,a=r.fragmentTracker,n=r.media;var s=n.currentTime;var o=a.getPartialFragment(s);if(o){this._trySkipBufferHole(o)}if(e.len>h&&t>i.highBufferWatchdogPeriod*1e3){this.stalled=null;this._tryNudgeBuffer()}};e.prototype._reportStall=function(e){var t=this,r=t.hls,i=t.media,a=t.stallReported;if(!a){this.stallReported=true;d.logger.warn("Playback stalling at @"+i.currentTime+" due to low buffer");r.trigger(f.default.ERROR,{type:l.ErrorTypes.MEDIA_ERROR,details:l.ErrorDetails.BUFFER_STALLED_ERROR,fatal:false,buffer:e})}};e.prototype._trySkipBufferHole=function(e){var t=this,r=t.hls,i=t.media;var a=i.currentTime;var n=0;for(var s=0;s<i.buffered.length;s++){var o=i.buffered.start(s);if(a>=n&&a<o){i.currentTime=Math.max(o,i.currentTime+.1);d.logger.warn("skipping hole, adjusting currentTime from "+a+" to "+i.currentTime);this.stalled=null;r.trigger(f.default.ERROR,{type:l.ErrorTypes.MEDIA_ERROR,details:l.ErrorDetails.BUFFER_SEEK_OVER_HOLE,fatal:false,reason:"fragment loaded with buffer holes, seeking from "+a+" to "+i.currentTime,frag:e});return}n=i.buffered.end(s)}};e.prototype._tryNudgeBuffer=function(){var e=this,t=e.config,r=e.hls,i=e.media;var a=i.currentTime;var n=(this.nudgeRetry||0)+1;this.nudgeRetry=n;if(n<t.nudgeMaxRetry){var s=a+n*t.nudgeOffset;d.logger.log("adjust currentTime from "+a+" to "+s);i.currentTime=s;r.trigger(f.default.ERROR,{type:l.ErrorTypes.MEDIA_ERROR,details:l.ErrorDetails.BUFFER_NUDGE_ON_STALL,fatal:false})}else{d.logger.error("still stuck in high buffer @"+a+" after "+t.nudgeMaxRetry+", raise fatal error");r.trigger(f.default.ERROR,{type:l.ErrorTypes.MEDIA_ERROR,details:l.ErrorDetails.BUFFER_STALLED_ERROR,fatal:true})}};return e}();t.default=i},"./src/controller/id3-track-controller.js":function(e,t,r){"use strict";var i=this&&this.__extends||function(){var i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r]};return function(e,t){i(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:true});var a=r("./src/events.js");var n=r("./src/event-handler.js");var d=r("./src/demux/id3.js");var s=r("./src/utils/texttrack-utils.js");var o=function(r){i(e,r);function e(e){var t=r.call(this,e,a.default.MEDIA_ATTACHED,a.default.MEDIA_DETACHING,a.default.FRAG_PARSING_METADATA)||this;t.id3Track=undefined;t.media=undefined;return t}e.prototype.destroy=function(){n.default.prototype.destroy.call(this)};e.prototype.onMediaAttached=function(e){this.media=e.media;if(!this.media){}};e.prototype.onMediaDetaching=function(){s.clearCurrentCues(this.id3Track);this.id3Track=undefined;this.media=undefined};e.prototype.getID3Track=function(e){for(var t=0;t<e.length;t++){var r=e[t];if(r.kind==="metadata"&&r.label==="id3"){s.sendAddTrackEvent(r,this.media);return r}}return this.media.addTextTrack("metadata","id3")};e.prototype.onFragParsingMetadata=function(e){var t=e.frag;var r=e.samples;if(!this.id3Track){this.id3Track=this.getID3Track(this.media.textTracks);this.id3Track.mode="hidden"}var i=window.WebKitDataCue||window.VTTCue||window.TextTrackCue;for(var a=0;a<r.length;a++){var n=d.default.getID3Frames(r[a].data);if(n){var s=r[a].pts;var o=a<r.length-1?r[a+1].pts:t.endPTS;if(s===o){o+=1e-4}for(var l=0;l<n.length;l++){var u=n[l];if(!d.default.isTimeStampFrame(u)){var f=new i(s,o,"");f.value=u;this.id3Track.addCue(f)}}}}};return e}(n.default);t.default=o},"./src/controller/level-controller.js":function(e,t,r){"use strict";var i=this&&this.__extends||function(){var i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r]};return function(e,t){i(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:true});var u=r("./src/events.js");var a=r("./src/event-handler.js");var d=r("./src/utils/logger.js");var f=r("./src/errors.js");var c=r("./src/utils/codecs.js");var h=r("./src/controller/level-helper.js");var n=window.performance;var p;var s=function(r){i(e,r);function e(e){var t=r.call(this,e,u.default.MANIFEST_LOADED,u.default.LEVEL_LOADED,u.default.AUDIO_TRACK_SWITCHED,u.default.FRAG_LOADED,u.default.ERROR)||this;t.canload=false;t.currentLevelIndex=null;t.manualLevelIndex=-1;t.timer=null;p=/chrome|firefox/.test(navigator.userAgent.toLowerCase());return t}e.prototype.onHandlerDestroying=function(){this.clearTimer();this.manualLevelIndex=-1};e.prototype.clearTimer=function(){if(this.timer!==null){clearTimeout(this.timer);this.timer=null}};e.prototype.startLoad=function(){var e=this._levels;this.canload=true;this.levelRetryCount=0;if(e){e.forEach(function(e){e.loadError=0;var t=e.details;if(t&&t.live){e.details=undefined}})}if(this.timer!==null){this.loadLevel()}};e.prototype.stopLoad=function(){this.canload=false};e.prototype.onManifestLoaded=function(e){var r=[];var t=[];var i;var a={};var n=null;var s=false;var o=false;e.levels.forEach(function(e){var t=e.attrs;e.loadError=0;e.fragmentError=false;s=s||!!e.videoCodec;o=o||!!e.audioCodec;if(p&&e.audioCodec&&e.audioCodec.indexOf("mp4a.40.34")!==-1){e.audioCodec=undefined}n=a[e.bitrate];if(!n){e.url=[e.url];e.urlId=0;a[e.bitrate]=e;r.push(e)}else{n.url.push(e.url)}if(t){if(t.AUDIO){o=true;h.addGroupId(n||e,"audio",t.AUDIO)}if(t.SUBTITLES){h.addGroupId(n||e,"text",t.SUBTITLES)}}});if(s&&o){r=r.filter(function(e){var t=e.videoCodec;return!!t})}r=r.filter(function(e){var t=e.audioCodec,r=e.videoCodec;return(!t||c.isCodecSupportedInMp4(t,"audio"))&&(!r||c.isCodecSupportedInMp4(r,"video"))});if(e.audioTracks){t=e.audioTracks.filter(function(e){return!e.audioCodec||c.isCodecSupportedInMp4(e.audioCodec,"audio")});t.forEach(function(e,t){e.id=t})}if(r.length>0){i=r[0].bitrate;r.sort(function(e,t){return e.bitrate-t.bitrate});this._levels=r;for(var l=0;l<r.length;l++){if(r[l].bitrate===i){this._firstLevel=l;d.logger.log("manifest loaded,"+r.length+" level(s) found, first bitrate:"+i);break}}this.hls.trigger(u.default.MANIFEST_PARSED,{levels:r,audioTracks:t,firstLevel:this._firstLevel,stats:e.stats,audio:o,video:s,altAudio:t.some(function(e){return!!e.url})})}else{this.hls.trigger(u.default.ERROR,{type:f.ErrorTypes.MEDIA_ERROR,details:f.ErrorDetails.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:true,url:this.hls.url,reason:"no level with compatible codecs found in manifest"})}};Object.defineProperty(e.prototype,"levels",{get:function(){return this._levels},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"level",{get:function(){return this.currentLevelIndex},set:function(e){var t=this._levels;if(t){e=Math.min(e,t.length-1);if(this.currentLevelIndex!==e||!t[e].details){this.setLevelInternal(e)}}},enumerable:true,configurable:true});e.prototype.setLevelInternal=function(e){var t=this._levels;var r=this.hls;if(e>=0&&e<t.length){this.clearTimer();if(this.currentLevelIndex!==e){d.logger.log("switching to level "+e);this.currentLevelIndex=e;var i=t[e];i.level=e;r.trigger(u.default.LEVEL_SWITCHING,i)}var a=t[e];var n=a.details;if(!n||n.live){var s=a.urlId;r.trigger(u.default.LEVEL_LOADING,{url:a.url[s],level:e,id:s})}}else{r.trigger(u.default.ERROR,{type:f.ErrorTypes.OTHER_ERROR,details:f.ErrorDetails.LEVEL_SWITCH_ERROR,level:e,fatal:false,reason:"invalid level idx"})}};Object.defineProperty(e.prototype,"manualLevel",{get:function(){return this.manualLevelIndex},set:function(e){this.manualLevelIndex=e;if(this._startLevel===undefined){this._startLevel=e}if(e!==-1){this.level=e}},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"firstLevel",{get:function(){return this._firstLevel},set:function(e){this._firstLevel=e},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"startLevel",{get:function(){if(this._startLevel===undefined){var e=this.hls.config.startLevel;if(e!==undefined){return e}else{return this._firstLevel}}else{return this._startLevel}},set:function(e){this._startLevel=e},enumerable:true,configurable:true});e.prototype.onError=function(e){if(e.fatal){if(e.type===f.ErrorTypes.NETWORK_ERROR){this.clearTimer()}return}var t=false,r=false;var i;switch(e.details){case f.ErrorDetails.FRAG_LOAD_ERROR:case f.ErrorDetails.FRAG_LOAD_TIMEOUT:case f.ErrorDetails.KEY_LOAD_ERROR:case f.ErrorDetails.KEY_LOAD_TIMEOUT:i=e.frag.level;r=true;break;case f.ErrorDetails.LEVEL_LOAD_ERROR:case f.ErrorDetails.LEVEL_LOAD_TIMEOUT:i=e.context.level;t=true;break;case f.ErrorDetails.REMUX_ALLOC_ERROR:i=e.level;t=true;break}if(i!==undefined){this.recoverLevel(e,i,t,r)}};e.prototype.recoverLevel=function(e,t,r,i){var a=this;var n=this.hls.config;var s=e.details;var o=this._levels[t];var l,u,f;o.loadError++;o.fragmentError=i;if(r){if(this.levelRetryCount+1<=n.levelLoadingMaxRetry){u=Math.min(Math.pow(2,this.levelRetryCount)*n.levelLoadingRetryDelay,n.levelLoadingMaxRetryTimeout);this.timer=setTimeout(function(){return a.loadLevel()},u);e.levelRetry=true;this.levelRetryCount++;d.logger.warn("level controller, "+s+", retry in "+u+" ms, current retry count is "+this.levelRetryCount)}else{d.logger.error("level controller, cannot recover from "+s+" error");this.currentLevelIndex=null;this.clearTimer();e.fatal=true;return}}if(r||i){l=o.url.length;if(l>1&&o.loadError<l){o.urlId=(o.urlId+1)%l;o.details=undefined;d.logger.warn("level controller, "+s+" for level "+t+": switching to redundant URL-id "+o.urlId)}else{if(this.manualLevelIndex===-1){f=t===0?this._levels.length-1:t-1;d.logger.warn("level controller, "+s+": switch to "+f);this.hls.nextAutoLevel=this.currentLevelIndex=f}else if(i){d.logger.warn("level controller, "+s+": reload a fragment");this.currentLevelIndex=null}}}};e.prototype.onFragLoaded=function(e){var t=e.frag;if(t!==undefined&&t.type==="main"){var r=this._levels[t.level];if(r!==undefined){r.fragmentError=false;r.loadError=0;this.levelRetryCount=0}}};e.prototype.onLevelLoaded=function(e){var t=this;var r=e.level,i=e.details;if(r!==this.currentLevelIndex){return}var a=this._levels[r];if(!a.fragmentError){a.loadError=0;this.levelRetryCount=0}if(i.live){var n=h.computeReloadInterval(a.details,i,e.stats.trequest);d.logger.log("live playlist, reload in "+Math.round(n)+" ms");this.timer=setTimeout(function(){return t.loadLevel()},n)}else{this.clearTimer()}};e.prototype.onAudioTrackSwitched=function(e){var t=this.hls.audioTracks[e.id].groupId;var r=this.hls.levels[this.currentLevelIndex];if(!r){return}if(r.audioGroupIds){var i=-1;for(var a=0;a<r.audioGroupIds.length;a++){if(r.audioGroupIds[a]===t){i=a;break}}if(i!==r.urlId){r.urlId=i;this.startLoad()}}};e.prototype.loadLevel=function(){d.logger.debug("call to loadLevel");if(this.currentLevelIndex!==null&&this.canload){var e=this._levels[this.currentLevelIndex];if(typeof e==="object"&&e.url.length>0){var t=this.currentLevelIndex;var r=e.urlId;var i=e.url[r];d.logger.log("Attempt loading level index "+t+" with URL-id "+r);this.hls.trigger(u.default.LEVEL_LOADING,{url:i,level:t,id:r})}}};Object.defineProperty(e.prototype,"nextLoadLevel",{get:function(){if(this.manualLevelIndex!==-1){return this.manualLevelIndex}else{return this.hls.nextAutoLevel}},set:function(e){this.level=e;if(this.manualLevelIndex===-1){this.hls.nextAutoLevel=e}},enumerable:true,configurable:true});return e}(a.default);t.default=s},"./src/controller/level-helper.js":function(e,a,n){"use strict";(function(h){Object.defineProperty(a,"__esModule",{value:true});var s=n("./src/utils/logger.js");function e(e,t,r){switch(t){case"audio":if(!e.audioGroupIds){e.audioGroupIds=[]}e.audioGroupIds.push(r);break;case"text":if(!e.textGroupIds){e.textGroupIds=[]}e.textGroupIds.push(r);break}}a.addGroupId=e;function p(e,t,r){var i=e[t],a=e[r],n=a.startPTS;if(h.isFinite(n)){if(r>t){i.duration=n-i.start;if(i.duration<0){s.logger.warn("negative duration computed for frag "+i.sn+",level "+i.level+", there should be some duration drift between playlist and fragment!")}}else{a.duration=i.start-n;if(a.duration<0){s.logger.warn("negative duration computed for frag "+a.sn+",level "+a.level+", there should be some duration drift between playlist and fragment!")}}}else{if(r>t){a.start=i.start+i.duration}else{a.start=Math.max(i.start-a.duration,0)}}}a.updatePTS=p;function o(e,t,r,i,a,n){var s=r;if(h.isFinite(t.startPTS)){var o=Math.abs(t.startPTS-r);if(!h.isFinite(t.deltaPTS)){t.deltaPTS=o}else{t.deltaPTS=Math.max(o,t.deltaPTS)}s=Math.max(r,t.startPTS);r=Math.min(r,t.startPTS);i=Math.max(i,t.endPTS);a=Math.min(a,t.startDTS);n=Math.max(n,t.endDTS)}var l=r-t.start;t.start=t.startPTS=r;t.maxStartPTS=s;t.endPTS=i;t.startDTS=a;t.endDTS=n;t.duration=i-r;var u=t.sn;if(!e||u<e.startSN||u>e.endSN){return 0}var f,d,c;f=u-e.startSN;d=e.fragments;d[f]=t;for(c=f;c>0;c--){p(d,c,c-1)}for(c=f;c<d.length-1;c++){p(d,c,c+1)}e.PTSKnown=true;return l}a.updateFragPTSDTS=o;function t(e,r){if(r.initSegment&&e.initSegment){r.initSegment=e.initSegment}var i=0;var a;l(e,r,function(e,t){i=e.cc-t.cc;if(h.isFinite(e.startPTS)){t.start=t.startPTS=e.startPTS;t.endPTS=e.endPTS;t.duration=e.duration;t.backtracked=e.backtracked;t.dropped=e.dropped;a=t}r.PTSKnown=true});if(!r.PTSKnown){return}if(i){s.logger.log("discontinuity sliding from playlist, take drift into account");var t=r.fragments;for(var n=0;n<t.length;n++){t[n].cc+=i}}if(a){o(r,a,a.startPTS,a.endPTS,a.startDTS,a.endDTS)}else{u(e,r)}r.PTSKnown=e.PTSKnown}a.mergeDetails=t;function r(e,t,r){if(r===void 0){r=0}var i=-1;l(e,t,function(e,t,r){t.start=e.start;i=r});var a=t.fragments;if(i<0){a.forEach(function(e){e.start+=r});return}for(var n=i+1;n<a.length;n++){a[n].start=a[n-1].start+a[n-1].duration}}a.mergeSubtitlePlaylists=r;function l(e,t,r){if(!e||!t){return}var i=Math.max(e.startSN,t.startSN)-t.startSN;var a=Math.min(e.endSN,t.endSN)-t.startSN;var n=t.startSN-e.startSN;for(var s=i;s<=a;s++){var o=e.fragments[n+s];var l=t.fragments[s];if(!o||!l){break}r(o,l,s)}}a.mapFragmentIntersection=l;function u(e,t){var r=t.startSN-e.startSN;var i=e.fragments;var a=t.fragments;if(r<0||r>i.length){return}for(var n=0;n<a.length;n++){a[n].start+=i[r].start}}a.adjustSliding=u;function i(e,t,r){var i=1e3*(t.averagetargetduration?t.averagetargetduration:t.targetduration);var a=i/2;if(e&&t.endSN===e.endSN){i=a}if(r){i=Math.max(a,i-(window.performance.now()-r))}return Math.round(i)}a.computeReloadInterval=i}).call(this,n("./src/polyfills/number.js")["Number"])},"./src/controller/stream-controller.js":function(e,i,_){"use strict";(function(u){var t=this&&this.__extends||function(){var i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r]};return function(e,t){i(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}();Object.defineProperty(i,"__esModule",{value:true});var p=_("./src/utils/binary-search.js");var c=_("./src/utils/buffer-helper.js");var g=_("./src/demux/demuxer.js");var v=_("./src/events.js");var r=_("./src/controller/fragment-tracker.js");var f=_("./src/loader/fragment.js");var a=_("./src/loader/playlist-loader.js");var d=_("./src/controller/level-helper.js");var n=_("./src/utils/time-ranges.js");var s=_("./src/errors.js");var m=_("./src/utils/logger.js");var h=_("./src/utils/discontinuities.js");var y=_("./src/controller/fragment-finders.js");var o=_("./src/controller/gap-controller.js");var E=_("./src/controller/base-stream-controller.js");var l=100;var e=function(i){t(e,i);function e(e,t){var r=i.call(this,e,v.default.MEDIA_ATTACHED,v.default.MEDIA_DETACHING,v.default.MANIFEST_LOADING,v.default.MANIFEST_PARSED,v.default.LEVEL_LOADED,v.default.KEY_LOADED,v.default.FRAG_LOADED,v.default.FRAG_LOAD_EMERGENCY_ABORTED,v.default.FRAG_PARSING_INIT_SEGMENT,v.default.FRAG_PARSING_DATA,v.default.FRAG_PARSED,v.default.ERROR,v.default.AUDIO_TRACK_SWITCHING,v.default.AUDIO_TRACK_SWITCHED,v.default.BUFFER_CREATED,v.default.BUFFER_APPENDED,v.default.BUFFER_FLUSHED)||this;r.fragmentTracker=t;r.config=e.config;r.audioCodecSwap=false;r._state=E.State.STOPPED;r.stallReported=false;r.gapController=null;return r}e.prototype.startLoad=function(e){if(this.levels){var t=this.lastCurrentTime,r=this.hls;this.stopLoad();this.setInterval(l);this.level=-1;this.fragLoadError=0;if(!this.startFragRequested){var i=r.startLevel;if(i===-1){i=0;this.bitrateTest=true}this.level=r.nextLoadLevel=i;this.loadedmetadata=false}if(t>0&&e===-1){m.logger.log("override startPosition with lastCurrentTime @"+t.toFixed(3));e=t}this.state=E.State.IDLE;this.nextLoadPosition=this.startPosition=this.lastCurrentTime=e;this.tick()}else{this.forceStartLoad=true;this.state=E.State.STOPPED}};e.prototype.stopLoad=function(){this.forceStartLoad=false;i.prototype.stopLoad.call(this)};e.prototype.doTick=function(){switch(this.state){case E.State.BUFFER_FLUSHING:this.fragLoadError=0;break;case E.State.IDLE:this._doTickIdle();break;case E.State.WAITING_LEVEL:var e=this.levels[this.level];if(e&&e.details){this.state=E.State.IDLE}break;case E.State.FRAG_LOADING_WAITING_RETRY:var t=window.performance.now();var r=this.retryDate;if(!r||t>=r||this.media&&this.media.seeking){m.logger.log("mediaController: retryDate reached, switch back to IDLE state");this.state=E.State.IDLE}break;case E.State.ERROR:case E.State.STOPPED:case E.State.FRAG_LOADING:case E.State.PARSING:case E.State.PARSED:case E.State.ENDED:break;default:break}this._checkBuffer();this._checkFragmentChanged()};e.prototype._doTickIdle=function(){var e=this.hls,t=e.config,r=this.media;if(this.levelLastLoaded===undefined||!r&&(this.startFragRequested||!t.startFragPrefetch)){return}var i;if(this.loadedmetadata){i=r.currentTime}else{i=this.nextLoadPosition}var a=e.nextLoadLevel,n=this.levels[a];if(!n){return}var s=n.bitrate,o;if(s){o=Math.max(8*t.maxBufferSize/s,t.maxBufferLength)}else{o=t.maxBufferLength}o=Math.min(o,t.maxMaxBufferLength);var l=c.BufferHelper.bufferInfo(this.mediaBuffer?this.mediaBuffer:r,i,t.maxBufferHole),u=l.len;if(u>=o){return}m.logger.trace("buffer length of "+u.toFixed(3)+" is below max of "+o.toFixed(3)+". checking for more payload ...");this.level=e.nextLoadLevel=a;var f=n.details;if(!f||f.live&&this.levelLastLoaded!==a){this.state=E.State.WAITING_LEVEL;return}if(this._streamEnded(l,f)){var d={};if(this.altAudio){d.type="video"}this.hls.trigger(v.default.BUFFER_EOS,d);this.state=E.State.ENDED;return}this._fetchPayloadOrEos(i,l,f)};e.prototype._fetchPayloadOrEos=function(e,t,r){var i=this.fragPrevious,a=this.level,n=r.fragments,s=n.length;if(s===0){return}var o=n[0].start,l=n[s-1].start+n[s-1].duration,u=t.end,f;if(r.initSegment&&!r.initSegment.data){f=r.initSegment}else{if(r.live){var d=this.config.initialLiveManifestSize;if(s<d){m.logger.warn("Can not start playback of a level, reason: not enough fragments "+s+" < "+d);return}f=this._ensureFragmentAtLivePoint(r,u,o,l,i,n,s);if(f===null){return}}else{if(u<o){f=n[0]}}}if(!f){f=this._findFragment(o,i,s,n,u,l,r)}if(f){if(f.encrypted){m.logger.log("Loading key for "+f.sn+" of ["+r.startSN+" ,"+r.endSN+"],level "+a);this._loadKey(f)}else{m.logger.log("Loading "+f.sn+" of ["+r.startSN+" ,"+r.endSN+"],level "+a+", currentTime:"+e.toFixed(3)+",bufferEnd:"+u.toFixed(3));this._loadFragment(f)}}};e.prototype._ensureFragmentAtLivePoint=function(e,t,r,i,a,n,s){var o=this.hls.config,l=this.media;var u;var f=o.liveMaxLatencyDuration!==undefined?o.liveMaxLatencyDuration:o.liveMaxLatencyDurationCount*e.targetduration;if(t<Math.max(r-o.maxFragLookUpTolerance,i-f)){var d=this.liveSyncPosition=this.computeLivePosition(r,e);m.logger.log("buffer end: "+t.toFixed(3)+" is located too far from the end of live sliding playlist, reset currentTime to : "+d.toFixed(3));t=d;if(l&&l.readyState&&l.duration>d){l.currentTime=d}this.nextLoadPosition=d}if(e.PTSKnown&&t>i&&l&&l.readyState){return null}if(this.startFragRequested&&!e.PTSKnown){if(a){if(e.hasProgramDateTime){m.logger.log("live playlist, switching playlist, load frag with same PDT: "+a.programDateTime);u=y.findFragmentByPDT(n,a.endProgramDateTime,o.maxFragLookUpTolerance)}else{var c=a.sn+1;if(c>=e.startSN&&c<=e.endSN){var h=n[c-e.startSN];if(a.cc===h.cc){u=h;m.logger.log("live playlist, switching playlist, load frag with next SN: "+u.sn)}}if(!u){u=p.default.search(n,function(e){return a.cc-e.cc});if(u){m.logger.log("live playlist, switching playlist, load frag with same CC: "+u.sn)}}}}if(!u){u=n[Math.min(s-1,Math.round(s/2))];m.logger.log("live playlist, switching playlist, unknown, load middle frag : "+u.sn)}}return u};e.prototype._findFragment=function(e,t,r,i,a,n,s){var o=this.hls.config;var l;if(a<n){var u=a>n-o.maxFragLookUpTolerance?0:o.maxFragLookUpTolerance;l=y.findFragmentByPTS(t,i,a,u)}else{l=i[r-1]}if(l){var f=l.sn-s.startSN;var d=t&&l.level===t.level;var c=i[f-1];var h=i[f+1];if(t&&l.sn===t.sn){if(d&&!l.backtracked){if(l.sn<s.endSN){var p=t.deltaPTS;if(p&&p>o.maxBufferHole&&t.dropped&&f){l=c;m.logger.warn("SN just loaded, with large PTS gap between audio and video, maybe frag is not starting with a keyframe ? load previous one to try to overcome this")}else{l=h;m.logger.log("SN just loaded, load next one: "+l.sn,l)}}else{l=null}}else if(l.backtracked){if(h&&h.backtracked){m.logger.warn("Already backtracked from fragment "+h.sn+", will not backtrack to fragment "+l.sn+". Loading fragment "+h.sn);l=h}else{m.logger.warn("Loaded fragment with dropped frames, backtracking 1 segment to find a keyframe");l.dropped=0;if(c){l=c;l.backtracked=true}else if(f){l=null}}}}}return l};e.prototype._loadKey=function(e){this.state=E.State.KEY_LOADING;this.hls.trigger(v.default.KEY_LOADING,{frag:e})};e.prototype._loadFragment=function(e){var t=this.fragmentTracker.getState(e);this.fragCurrent=e;this.startFragRequested=true;if(u.isFinite(e.sn)&&!e.bitrateTest){this.nextLoadPosition=e.start+e.duration}if(e.backtracked||t===r.FragmentState.NOT_LOADED||t===r.FragmentState.PARTIAL){e.autoLevel=this.hls.autoLevelEnabled;e.bitrateTest=this.bitrateTest;this.hls.trigger(v.default.FRAG_LOADING,{frag:e});if(!this.demuxer){this.demuxer=new g.default(this.hls,"main")}this.state=E.State.FRAG_LOADING}else if(t===r.FragmentState.APPENDING){if(this._reduceMaxBufferLength(e.duration)){this.fragmentTracker.removeFragment(e)}}};Object.defineProperty(e.prototype,"state",{get:function(){return this._state},set:function(e){if(this.state!==e){var t=this.state;this._state=e;m.logger.log("main stream:"+t+"->"+e);this.hls.trigger(v.default.STREAM_STATE_TRANSITION,{previousState:t,nextState:e})}},enumerable:true,configurable:true});e.prototype.getBufferedFrag=function(e){return this.fragmentTracker.getBufferedFrag(e,a.default.LevelType.MAIN)};Object.defineProperty(e.prototype,"currentLevel",{get:function(){var e=this.media;if(e){var t=this.getBufferedFrag(e.currentTime);if(t){return t.level}}return-1},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"nextBufferedFrag",{get:function(){var e=this.media;if(e){return this.followingBufferedFrag(this.getBufferedFrag(e.currentTime))}else{return null}},enumerable:true,configurable:true});e.prototype.followingBufferedFrag=function(e){if(e){return this.getBufferedFrag(e.endPTS+.5)}return null};Object.defineProperty(e.prototype,"nextLevel",{get:function(){var e=this.nextBufferedFrag;if(e){return e.level}else{return-1}},enumerable:true,configurable:true});e.prototype._checkFragmentChanged=function(){var e,t,r=this.media;if(r&&r.readyState&&r.seeking===false){t=r.currentTime;if(t>this.lastCurrentTime){this.lastCurrentTime=t}if(c.BufferHelper.isBuffered(r,t)){e=this.getBufferedFrag(t)}else if(c.BufferHelper.isBuffered(r,t+.1)){e=this.getBufferedFrag(t+.1)}if(e){var i=e;if(i!==this.fragPlaying){this.hls.trigger(v.default.FRAG_CHANGED,{frag:i});var a=i.level;if(!this.fragPlaying||this.fragPlaying.level!==a){this.hls.trigger(v.default.LEVEL_SWITCHED,{level:a})}this.fragPlaying=i}}}};e.prototype.immediateLevelSwitch=function(){m.logger.log("immediateLevelSwitch");if(!this.immediateSwitch){this.immediateSwitch=true;var e=this.media,t=void 0;if(e){t=e.paused;e.pause()}else{t=true}this.previouslyPaused=t}var r=this.fragCurrent;if(r&&r.loader){r.loader.abort()}this.fragCurrent=null;this.flushMainBuffer(0,u.POSITIVE_INFINITY)};e.prototype.immediateLevelSwitchEnd=function(){var e=this.media;if(e&&e.buffered.length){this.immediateSwitch=false;if(c.BufferHelper.isBuffered(e,e.currentTime)){e.currentTime-=1e-4}if(!this.previouslyPaused){e.play()}}};e.prototype.nextLevelSwitch=function(){var e=this.media;if(e&&e.readyState){var t=void 0,r=void 0,i=void 0;r=this.getBufferedFrag(e.currentTime);if(r&&r.startPTS>1){this.flushMainBuffer(0,r.startPTS-1)}if(!e.paused){var a=this.hls.nextLoadLevel,n=this.levels[a],s=this.fragLastKbps;if(s&&this.fragCurrent){t=this.fragCurrent.duration*n.bitrate/(1e3*s)+1}else{t=0}}else{t=0}i=this.getBufferedFrag(e.currentTime+t);if(i){i=this.followingBufferedFrag(i);if(i){var o=this.fragCurrent;if(o&&o.loader){o.loader.abort()}this.fragCurrent=null;this.flushMainBuffer(i.maxStartPTS,u.POSITIVE_INFINITY)}}}};e.prototype.flushMainBuffer=function(e,t){this.state=E.State.BUFFER_FLUSHING;var r={startOffset:e,endOffset:t};if(this.altAudio){r.type="video"}this.hls.trigger(v.default.BUFFER_FLUSHING,r)};e.prototype.onMediaAttached=function(e){var t=this.media=this.mediaBuffer=e.media;this.onvseeking=this.onMediaSeeking.bind(this);this.onvseeked=this.onMediaSeeked.bind(this);this.onvended=this.onMediaEnded.bind(this);t.addEventListener("seeking",this.onvseeking);t.addEventListener("seeked",this.onvseeked);t.addEventListener("ended",this.onvended);var r=this.config;if(this.levels&&r.autoStartLoad){this.hls.startLoad(r.startPosition)}this.gapController=new o.default(r,t,this.fragmentTracker,this.hls)};e.prototype.onMediaDetaching=function(){var e=this.media;if(e&&e.ended){m.logger.log("MSE detaching and video ended, reset startPosition");this.startPosition=this.lastCurrentTime=0}var t=this.levels;if(t){t.forEach(function(e){if(e.details){e.details.fragments.forEach(function(e){e.backtracked=undefined})}})}if(e){e.removeEventListener("seeking",this.onvseeking);e.removeEventListener("seeked",this.onvseeked);e.removeEventListener("ended",this.onvended);this.onvseeking=this.onvseeked=this.onvended=null}this.media=this.mediaBuffer=null;this.loadedmetadata=false;this.stopLoad()};e.prototype.onMediaSeeked=function(){var e=this.media,t=e?e.currentTime:undefined;if(u.isFinite(t)){m.logger.log("media seeked to "+t.toFixed(3))}this.tick()};e.prototype.onManifestLoading=function(){m.logger.log("trigger BUFFER_RESET");this.hls.trigger(v.default.BUFFER_RESET);this.fragmentTracker.removeAllFragments();this.stalled=false;this.startPosition=this.lastCurrentTime=0};e.prototype.onManifestParsed=function(e){var t=false,r=false,i;e.levels.forEach(function(e){i=e.audioCodec;if(i){if(i.indexOf("mp4a.40.2")!==-1){t=true}if(i.indexOf("mp4a.40.5")!==-1){r=true}}});this.audioCodecSwitch=t&&r;if(this.audioCodecSwitch){m.logger.log("both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC")}this.levels=e.levels;this.startFragRequested=false;var a=this.config;if(a.autoStartLoad||this.forceStartLoad){this.hls.startLoad(a.startPosition)}};e.prototype.onLevelLoaded=function(e){var t=e.details;var r=e.level;var i=this.levels[this.levelLastLoaded];var a=this.levels[r];var n=t.totalduration;var s=0;m.logger.log("level "+r+" loaded ["+t.startSN+","+t.endSN+"],duration:"+n);if(t.live){var o=a.details;if(o&&t.fragments.length>0){d.mergeDetails(o,t);s=t.fragments[0].start;this.liveSyncPosition=this.computeLivePosition(s,o);if(t.PTSKnown&&u.isFinite(s)){m.logger.log("live playlist sliding:"+s.toFixed(3))}else{m.logger.log("live playlist - outdated PTS, unknown sliding");h.alignStream(this.fragPrevious,i,t)}}else{m.logger.log("live playlist - first load, unknown sliding");t.PTSKnown=false;h.alignStream(this.fragPrevious,i,t)}}else{t.PTSKnown=false}a.details=t;this.levelLastLoaded=r;this.hls.trigger(v.default.LEVEL_UPDATED,{details:t,level:r});if(this.startFragRequested===false){if(this.startPosition===-1||this.lastCurrentTime===-1){var l=t.startTimeOffset;if(u.isFinite(l)){if(l<0){m.logger.log("negative start time offset "+l+", count from end of last fragment");l=s+n+l}m.logger.log("start time offset found in playlist, adjust startPosition to "+l);this.startPosition=l}else{if(t.live){this.startPosition=this.computeLivePosition(s,t);m.logger.log("configure startPosition to "+this.startPosition)}else{this.startPosition=0}}this.lastCurrentTime=this.startPosition}this.nextLoadPosition=this.startPosition}if(this.state===E.State.WAITING_LEVEL){this.state=E.State.IDLE}this.tick()};e.prototype.onKeyLoaded=function(){if(this.state===E.State.KEY_LOADING){this.state=E.State.IDLE;this.tick()}};e.prototype.onFragLoaded=function(e){var t=this,r=t.fragCurrent,i=t.hls,a=t.levels,n=t.media;var s=e.frag;if(this.state===E.State.FRAG_LOADING&&r&&s.type==="main"&&s.level===r.level&&s.sn===r.sn){var o=e.stats;var l=a[r.level];var u=l.details;this.bitrateTest=false;this.stats=o;m.logger.log("Loaded "+r.sn+" of ["+u.startSN+" ,"+u.endSN+"],level "+r.level);if(s.bitrateTest&&i.nextLoadLevel){this.state=E.State.IDLE;this.startFragRequested=false;o.tparsed=o.tbuffered=window.performance.now();i.trigger(v.default.FRAG_BUFFERED,{stats:o,frag:r,id:"main"});this.tick()}else if(s.sn==="initSegment"){this.state=E.State.IDLE;o.tparsed=o.tbuffered=window.performance.now();u.initSegment.data=e.payload;i.trigger(v.default.FRAG_BUFFERED,{stats:o,frag:r,id:"main"});this.tick()}else{m.logger.log("Parsing "+r.sn+" of ["+u.startSN+" ,"+u.endSN+"],level "+r.level+", cc "+r.cc);this.state=E.State.PARSING;this.pendingBuffering=true;this.appended=false;if(s.bitrateTest){s.bitrateTest=false;this.fragmentTracker.onFragLoaded({frag:s})}var f=!(n&&n.seeking)&&(u.PTSKnown||!u.live);var d=u.initSegment?u.initSegment.data:[];var c=this._getAudioCodec(l);var h=this.demuxer=this.demuxer||new g.default(this.hls,"main");h.push(e.payload,d,c,l.videoCodec,r,u.totalduration,f)}}this.fragLoadError=0};e.prototype.onFragParsingInitSegment=function(e){var t=this.fragCurrent;var r=e.frag;if(t&&e.id==="main"&&r.sn===t.sn&&r.level===t.level&&this.state===E.State.PARSING){var i=e.tracks,a=void 0,n=void 0;if(i.audio&&this.altAudio){delete i.audio}n=i.audio;if(n){var s=this.levels[this.level].audioCodec,o=navigator.userAgent.toLowerCase();if(s&&this.audioCodecSwap){m.logger.log("swapping playlist audio codec");if(s.indexOf("mp4a.40.5")!==-1){s="mp4a.40.2"}else{s="mp4a.40.5"}}if(this.audioCodecSwitch){if(n.metadata.channelCount!==1&&o.indexOf("firefox")===-1){s="mp4a.40.5"}}if(o.indexOf("android")!==-1&&n.container!=="audio/mpeg"){s="mp4a.40.2";m.logger.log("Android: force audio codec to "+s)}n.levelCodec=s;n.id=e.id}n=i.video;if(n){n.levelCodec=this.levels[this.level].videoCodec;n.id=e.id}this.hls.trigger(v.default.BUFFER_CODECS,i);for(a in i){n=i[a];m.logger.log("main track:"+a+",container:"+n.container+",codecs[level/parsed]=["+n.levelCodec+"/"+n.codec+"]");var l=n.initSegment;if(l){this.appended=true;this.pendingBuffering=true;this.hls.trigger(v.default.BUFFER_APPENDING,{type:a,data:l,parent:"main",content:"initSegment"})}}this.tick()}};e.prototype.onFragParsingData=function(t){var r=this;var e=this.fragCurrent;var i=t.frag;if(e&&t.id==="main"&&i.sn===e.sn&&i.level===e.level&&!(t.type==="audio"&&this.altAudio)&&this.state===E.State.PARSING){var a=this.levels[this.level],n=e;if(!u.isFinite(t.endPTS)){t.endPTS=t.startPTS+e.duration;t.endDTS=t.startDTS+e.duration}if(t.hasAudio===true){n.addElementaryStream(f.default.ElementaryStreamTypes.AUDIO)}if(t.hasVideo===true){n.addElementaryStream(f.default.ElementaryStreamTypes.VIDEO)}m.logger.log("Parsed "+t.type+",PTS:["+t.startPTS.toFixed(3)+","+t.endPTS.toFixed(3)+"],DTS:["+t.startDTS.toFixed(3)+"/"+t.endDTS.toFixed(3)+"],nb:"+t.nb+",dropped:"+(t.dropped||0));if(t.type==="video"){n.dropped=t.dropped;if(n.dropped){if(!n.backtracked){var s=a.details;if(s&&n.sn===s.startSN){m.logger.warn("missing video frame(s) on first frag, appending with gap",n.sn)}else{m.logger.warn("missing video frame(s), backtracking fragment",n.sn);this.fragmentTracker.removeFragment(n);n.backtracked=true;this.nextLoadPosition=t.startPTS;this.state=E.State.IDLE;this.fragPrevious=n;this.tick();return}}else{m.logger.warn("Already backtracked on this fragment, appending with the gap",n.sn)}}else{n.backtracked=false}}var o=d.updateFragPTSDTS(a.details,n,t.startPTS,t.endPTS,t.startDTS,t.endDTS),l=this.hls;l.trigger(v.default.LEVEL_PTS_UPDATED,{details:a.details,level:this.level,drift:o,type:t.type,start:t.startPTS,end:t.endPTS});[t.data1,t.data2].forEach(function(e){if(e&&e.length&&r.state===E.State.PARSING){r.appended=true;r.pendingBuffering=true;l.trigger(v.default.BUFFER_APPENDING,{type:t.type,data:e,parent:"main",content:"data"})}});this.tick()}};e.prototype.onFragParsed=function(e){var t=this.fragCurrent;var r=e.frag;if(t&&e.id==="main"&&r.sn===t.sn&&r.level===t.level&&this.state===E.State.PARSING){this.stats.tparsed=window.performance.now();this.state=E.State.PARSED;this._checkAppendedParsed()}};e.prototype.onAudioTrackSwitching=function(e){var t=!!e.url,r=e.id;if(!t){if(this.mediaBuffer!==this.media){m.logger.log("switching on main audio, use media.buffered to schedule main fragment loading");this.mediaBuffer=this.media;var i=this.fragCurrent;if(i.loader){m.logger.log("switching to main audio track, cancel main fragment load");i.loader.abort()}this.fragCurrent=null;this.fragPrevious=null;if(this.demuxer){this.demuxer.destroy();this.demuxer=null}this.state=E.State.IDLE}var a=this.hls;a.trigger(v.default.BUFFER_FLUSHING,{startOffset:0,endOffset:u.POSITIVE_INFINITY,type:"audio"});a.trigger(v.default.AUDIO_TRACK_SWITCHED,{id:r});this.altAudio=false}};e.prototype.onAudioTrackSwitched=function(e){var t=e.id,r=!!this.hls.audioTracks[t].url;if(r){var i=this.videoBuffer;if(i&&this.mediaBuffer!==i){m.logger.log("switching on alternate audio, use video.buffered to schedule main fragment loading");this.mediaBuffer=i}}this.altAudio=r;this.tick()};e.prototype.onBufferCreated=function(e){var t=e.tracks,r,i,a=false;for(var n in t){var s=t[n];if(s.id==="main"){i=n;r=s;if(n==="video"){this.videoBuffer=t[n].buffer}}else{a=true}}if(a&&r){m.logger.log("alternate track found, use "+i+".buffered to schedule main fragment loading");this.mediaBuffer=r.buffer}else{this.mediaBuffer=this.media}};e.prototype.onBufferAppended=function(e){if(e.parent==="main"){var t=this.state;if(t===E.State.PARSING||t===E.State.PARSED){this.pendingBuffering=e.pending>0;this._checkAppendedParsed()}}};e.prototype._checkAppendedParsed=function(){if(this.state===E.State.PARSED&&(!this.appended||!this.pendingBuffering)){var e=this.fragCurrent;if(e){var t=this.mediaBuffer?this.mediaBuffer:this.media;m.logger.log("main buffered : "+n.default.toString(t.buffered));this.fragPrevious=e;var r=this.stats;r.tbuffered=window.performance.now();this.fragLastKbps=Math.round(8*r.total/(r.tbuffered-r.tfirst));this.hls.trigger(v.default.FRAG_BUFFERED,{stats:r,frag:e,id:"main"});this.state=E.State.IDLE}this.tick()}};e.prototype.onError=function(e){var t=e.frag||this.fragCurrent;if(t&&t.type!=="main"){return}var r=!!this.media&&c.BufferHelper.isBuffered(this.media,this.media.currentTime)&&c.BufferHelper.isBuffered(this.media,this.media.currentTime+.5);switch(e.details){case s.ErrorDetails.FRAG_LOAD_ERROR:case s.ErrorDetails.FRAG_LOAD_TIMEOUT:case s.ErrorDetails.KEY_LOAD_ERROR:case s.ErrorDetails.KEY_LOAD_TIMEOUT:if(!e.fatal){if(this.fragLoadError+1<=this.config.fragLoadingMaxRetry){var i=Math.min(Math.pow(2,this.fragLoadError)*this.config.fragLoadingRetryDelay,this.config.fragLoadingMaxRetryTimeout);m.logger.warn("mediaController: frag loading failed, retry in "+i+" ms");this.retryDate=window.performance.now()+i;if(!this.loadedmetadata){this.startFragRequested=false;this.nextLoadPosition=this.startPosition}this.fragLoadError++;this.state=E.State.FRAG_LOADING_WAITING_RETRY}else{m.logger.error("mediaController: "+e.details+" reaches max retry, redispatch as fatal ...");e.fatal=true;this.state=E.State.ERROR}}break;case s.ErrorDetails.LEVEL_LOAD_ERROR:case s.ErrorDetails.LEVEL_LOAD_TIMEOUT:if(this.state!==E.State.ERROR){if(e.fatal){this.state=E.State.ERROR;m.logger.warn("streamController: "+e.details+",switch to "+this.state+" state ...")}else{if(!e.levelRetry&&this.state===E.State.WAITING_LEVEL){this.state=E.State.IDLE}}}break;case s.ErrorDetails.BUFFER_FULL_ERROR:if(e.parent==="main"&&(this.state===E.State.PARSING||this.state===E.State.PARSED)){if(r){this._reduceMaxBufferLength(this.config.maxBufferLength);this.state=E.State.IDLE}else{m.logger.warn("buffer full error also media.currentTime is not buffered, flush everything");this.fragCurrent=null;this.flushMainBuffer(0,u.POSITIVE_INFINITY)}}break;default:break}};e.prototype._reduceMaxBufferLength=function(e){var t=this.config;if(t.maxMaxBufferLength>=e){t.maxMaxBufferLength/=2;m.logger.warn("main:reduce max buffer length to "+t.maxMaxBufferLength+"s");return true}return false};e.prototype._checkBuffer=function(){var e=this.media;if(!e||e.readyState===0){return}var t=this.mediaBuffer?this.mediaBuffer:e;var r=t.buffered;if(!this.loadedmetadata&&r.length){this.loadedmetadata=true;this._seekToStartPos()}else if(this.immediateSwitch){this.immediateLevelSwitchEnd()}else{this.gapController.poll(this.lastCurrentTime,r)}};e.prototype.onFragLoadEmergencyAborted=function(){this.state=E.State.IDLE;if(!this.loadedmetadata){this.startFragRequested=false;this.nextLoadPosition=this.startPosition}this.tick()};e.prototype.onBufferFlushed=function(){var e=this.mediaBuffer?this.mediaBuffer:this.media;if(e){this.fragmentTracker.detectEvictedFragments(f.default.ElementaryStreamTypes.VIDEO,e.buffered)}this.state=E.State.IDLE;this.fragPrevious=null};e.prototype.swapAudioCodec=function(){this.audioCodecSwap=!this.audioCodecSwap};e.prototype.computeLivePosition=function(e,t){var r=this.config.liveSyncDuration!==undefined?this.config.liveSyncDuration:this.config.liveSyncDurationCount*t.targetduration;return e+Math.max(0,t.totalduration-r)};e.prototype._seekToStartPos=function(){var e=this.media;var t=e.currentTime;var r=e.seeking?t:this.startPosition;if(t!==r){m.logger.log("target start position not buffered, seek to buffered.start(0) "+r+" from current time "+t+" ");e.currentTime=r}};e.prototype._getAudioCodec=function(e){var t=this.config.defaultAudioCodec||e.audioCodec;if(this.audioCodecSwap){m.logger.log("swapping playlist audio codec");if(t){if(t.indexOf("mp4a.40.5")!==-1){t="mp4a.40.2"}else{t="mp4a.40.5"}}}return t};Object.defineProperty(e.prototype,"liveSyncPosition",{get:function(){return this._liveSyncPosition},set:function(e){this._liveSyncPosition=e},enumerable:true,configurable:true});return e}(E.default);i.default=e}).call(this,_("./src/polyfills/number.js")["Number"])},"./src/controller/subtitle-stream-controller.js":function(e,t,r){"use strict";var a=this&&this.__extends||function(){var i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r]};return function(e,t){i(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:true});var y=r("./src/events.js");var E=r("./src/utils/logger.js");var n=r("./src/crypt/decrypter.js");var _=r("./src/utils/buffer-helper.js");var T=r("./src/controller/fragment-finders.js");var S=r("./src/controller/fragment-tracker.js");var b=r("./src/controller/base-stream-controller.js");var o=r("./src/controller/level-helper.js");var s=window.performance;var l=500;var i=function(i){a(e,i);function e(e,t){var r=i.call(this,e,y.default.MEDIA_ATTACHED,y.default.MEDIA_DETACHING,y.default.ERROR,y.default.KEY_LOADED,y.default.FRAG_LOADED,y.default.SUBTITLE_TRACKS_UPDATED,y.default.SUBTITLE_TRACK_SWITCH,y.default.SUBTITLE_TRACK_LOADED,y.default.SUBTITLE_FRAG_PROCESSED,y.default.LEVEL_UPDATED)||this;r.fragmentTracker=t;r.config=e.config;r.state=b.State.STOPPED;r.tracks=[];r.tracksBuffered=[];r.currentTrackId=-1;r.decrypter=new n.default(e,e.config);r.lastAVStart=0;r._onMediaSeeking=r.onMediaSeeking.bind(r);return r}e.prototype.onSubtitleFragProcessed=function(e){var t=e.frag,r=e.success;this.fragPrevious=t;this.state=b.State.IDLE;if(!r){return}var i=this.tracksBuffered[this.currentTrackId];if(!i){return}var a;var n=t.start;for(var s=0;s<i.length;s++){if(n>=i[s].start&&n<=i[s].end){a=i[s];break}}var o=t.start+t.duration;if(a){a.end=o}else{a={start:n,end:o};i.push(a)}};e.prototype.onMediaAttached=function(e){var t=e.media;this.media=t;t.addEventListener("seeking",this._onMediaSeeking);this.state=b.State.IDLE};e.prototype.onMediaDetaching=function(){this.media.removeEventListener("seeking",this._onMediaSeeking);this.media=null;this.state=b.State.STOPPED};e.prototype.onError=function(e){var t=e.frag;if(!t||t.type!=="subtitle"){return}this.state=b.State.IDLE};e.prototype.onSubtitleTracksUpdated=function(e){var t=this;E.logger.log("subtitle tracks updated");this.tracksBuffered=[];this.tracks=e.subtitleTracks;this.tracks.forEach(function(e){t.tracksBuffered[e.id]=[]})};e.prototype.onSubtitleTrackSwitch=function(e){this.currentTrackId=e.id;if(!this.tracks||this.currentTrackId===-1){this.clearInterval();return}var t=this.tracks[this.currentTrackId];if(t&&t.details){this.setInterval(l)}};e.prototype.onSubtitleTrackLoaded=function(e){var t=e.id,r=e.details;var i=this,a=i.currentTrackId,n=i.tracks;var s=n[a];if(t>=n.length||t!==a||!s){return}if(r.live){o.mergeSubtitlePlaylists(s.details,r,this.lastAVStart)}s.details=r;this.setInterval(l)};e.prototype.onKeyLoaded=function(){if(this.state===b.State.KEY_LOADING){this.state=b.State.IDLE}};e.prototype.onFragLoaded=function(e){var t=this.fragCurrent;var r=e.frag.decryptdata;var i=e.frag;var a=this.hls;if(this.state===b.State.FRAG_LOADING&&t&&e.frag.type==="subtitle"&&t.sn===e.frag.sn){if(e.payload.byteLength>0&&(r&&r.key&&r.method==="AES-128")){var n=s.now();this.decrypter.decrypt(e.payload,r.key.buffer,r.iv.buffer,function(e){var t=s.now();a.trigger(y.default.FRAG_DECRYPTED,{frag:i,payload:e,stats:{tstart:n,tdecrypt:t}})})}}};e.prototype.onLevelUpdated=function(e){var t=e.details;var r=t.fragments;this.lastAVStart=r.length?r[0].start:0};e.prototype.doTick=function(){if(!this.media){this.state=b.State.IDLE;return}switch(this.state){case b.State.IDLE:{var e=this,t=e.config,r=e.currentTrackId,i=e.fragmentTracker,a=e.media,n=e.tracks;if(!n||!n[r]||!n[r].details){break}var s=t.maxBufferHole,o=t.maxFragLookUpTolerance;var l=Math.min(t.maxBufferLength,t.maxMaxBufferLength);var u=_.BufferHelper.bufferedInfo(this._getBuffered(),a.currentTime,s);var f=u.end,d=u.len;var c=n[r].details;var h=c.fragments;var p=h.length;var g=h[p-1].start+h[p-1].duration;if(d>l){return}var v=void 0;var m=this.fragPrevious;if(f<g){if(m&&c.hasProgramDateTime){v=T.findFragmentByPDT(h,m.endProgramDateTime,o)}if(!v){v=T.findFragmentByPTS(m,h,f,o)}}else{v=h[p-1]}if(v&&v.encrypted){E.logger.log("Loading key for "+v.sn);this.state=b.State.KEY_LOADING;this.hls.trigger(y.default.KEY_LOADING,{frag:v})}else if(v&&i.getState(v)===S.FragmentState.NOT_LOADED){this.fragCurrent=v;this.state=b.State.FRAG_LOADING;this.hls.trigger(y.default.FRAG_LOADING,{frag:v})}}}};e.prototype.stopLoad=function(){this.lastAVStart=0;i.prototype.stopLoad.call(this)};e.prototype._getBuffered=function(){return this.tracksBuffered[this.currentTrackId]||[]};e.prototype.onMediaSeeking=function(){this.fragPrevious=null};return e}(b.default);t.SubtitleStreamController=i},"./src/controller/subtitle-track-controller.js":function(e,r,s){"use strict";(function(a){var t=this&&this.__extends||function(){var i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r]};return function(e,t){i(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}();Object.defineProperty(r,"__esModule",{value:true});var n=s("./src/events.js");var i=s("./src/event-handler.js");var u=s("./src/utils/logger.js");var f=s("./src/controller/level-helper.js");var e=function(r){t(e,r);function e(e){var t=r.call(this,e,n.default.MEDIA_ATTACHED,n.default.MEDIA_DETACHING,n.default.MANIFEST_LOADED,n.default.SUBTITLE_TRACK_LOADED)||this;t.tracks=[];t.trackId=-1;t.media=null;t.stopped=true;t.subtitleDisplay=true;return t}e.prototype.destroy=function(){i.default.prototype.destroy.call(this)};e.prototype.onMediaAttached=function(e){var t=this;this.media=e.media;if(!this.media){return}if(this.queuedDefaultTrack){this.subtitleTrack=this.queuedDefaultTrack;delete this.queuedDefaultTrack}this.trackChangeListener=this._onTextTracksChanged.bind(this);this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks);if(this.useTextTrackPolling){this.subtitlePollingInterval=setInterval(function(){t.trackChangeListener()},500)}else{this.media.textTracks.addEventListener("change",this.trackChangeListener)}};e.prototype.onMediaDetaching=function(){if(!this.media){return}if(this.useTextTrackPolling){clearInterval(this.subtitlePollingInterval)}else{this.media.textTracks.removeEventListener("change",this.trackChangeListener)}this.media=null};e.prototype.onManifestLoaded=function(e){var t=this;var r=e.subtitles||[];this.tracks=r;this.hls.trigger(n.default.SUBTITLE_TRACKS_UPDATED,{subtitleTracks:r});r.forEach(function(e){if(e.default){if(t.media){t.subtitleTrack=e.id}else{t.queuedDefaultTrack=e.id}}})};e.prototype.onSubtitleTrackLoaded=function(e){var t=this;var r=e.id,i=e.details;var a=this,n=a.trackId,s=a.tracks;var o=s[n];if(r>=s.length||r!==n||!o||this.stopped){this._clearReloadTimer();return}u.logger.log("subtitle track "+r+" loaded");if(i.live){var l=f.computeReloadInterval(o.details,i,e.stats.trequest);u.logger.log("Reloading live subtitle playlist in "+l+"ms");this.timer=setTimeout(function(){t._loadCurrentTrack()},l)}else{this._clearReloadTimer()}};e.prototype.startLoad=function(){this.stopped=false;this._loadCurrentTrack()};e.prototype.stopLoad=function(){this.stopped=true;this._clearReloadTimer()};Object.defineProperty(e.prototype,"subtitleTracks",{get:function(){return this.tracks},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"subtitleTrack",{get:function(){return this.trackId},set:function(e){if(this.trackId!==e){this._toggleTrackModes(e);this._setSubtitleTrackInternal(e)}},enumerable:true,configurable:true});e.prototype._clearReloadTimer=function(){if(this.timer){clearTimeout(this.timer);this.timer=null}};e.prototype._loadCurrentTrack=function(){var e=this,t=e.trackId,r=e.tracks,i=e.hls;var a=r[t];if(t<0||!a||a.details&&!a.details.live){return}u.logger.log("Loading subtitle track "+t);i.trigger(n.default.SUBTITLE_TRACK_LOADING,{url:a.url,id:t})};e.prototype._toggleTrackModes=function(e){var t=this,r=t.media,i=t.subtitleDisplay,a=t.trackId;if(!r){return}var n=l(r.textTracks);if(e===-1){[].slice.call(n).forEach(function(e){e.mode="disabled"})}else{var s=n[a];if(s){s.mode="disabled"}}var o=n[e];if(o){o.mode=i?"showing":"hidden"}};e.prototype._setSubtitleTrackInternal=function(e){var t=this,r=t.hls,i=t.tracks;if(!a.isFinite(e)||e<-1||e>=i.length){return}this.trackId=e;u.logger.log("Switching to subtitle track "+e);r.trigger(n.default.SUBTITLE_TRACK_SWITCH,{id:e});this._loadCurrentTrack()};e.prototype._onTextTracksChanged=function(){if(!this.media){return}var e=-1;var t=l(this.media.textTracks);for(var r=0;r<t.length;r++){if(t[r].mode==="hidden"){e=r}else if(t[r].mode==="showing"){e=r;break}}this.subtitleTrack=e};return e}(i.default);function l(e){var t=[];for(var r=0;r<e.length;r++){var i=e[r];if(i.kind==="subtitles"&&i.label){t.push(e[r])}}return t}r.default=e}).call(this,s("./src/polyfills/number.js")["Number"])},"./src/controller/timeline-controller.js":function(e,a,h){"use strict";(function(s){var t=this&&this.__extends||function(){var i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r]};return function(e,t){i(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}();Object.defineProperty(a,"__esModule",{value:true});var o=h("./src/events.js");var r=h("./src/event-handler.js");var n=h("./src/utils/cea-608-parser.js");var l=h("./src/utils/output-filter.js");var i=h("./src/utils/webvtt-parser.js");var u=h("./src/utils/logger.js");var f=h("./src/utils/texttrack-utils.js");function d(e,t){return e&&e.label===t.name&&!(e.textTrack1||e.textTrack2)}function c(e,t,r,i){return Math.min(t,i)-Math.max(e,r)}var e=function(a){t(e,a);function e(e){var t=a.call(this,e,o.default.MEDIA_ATTACHING,o.default.MEDIA_DETACHING,o.default.FRAG_PARSING_USERDATA,o.default.FRAG_DECRYPTED,o.default.MANIFEST_LOADING,o.default.MANIFEST_LOADED,o.default.FRAG_LOADED,o.default.LEVEL_SWITCHING,o.default.INIT_PTS_FOUND)||this;t.hls=e;t.config=e.config;t.enabled=true;t.Cues=e.config.cueHandler;t.textTracks=[];t.tracks=[];t.unparsedVttFrags=[];t.initPTS=[];t.cueRanges=[];t.captionsTracks={};t.captionsProperties={textTrack1:{label:t.config.captionsTextTrack1Label,languageCode:t.config.captionsTextTrack1LanguageCode},textTrack2:{label:t.config.captionsTextTrack2Label,languageCode:t.config.captionsTextTrack2LanguageCode}};if(t.config.enableCEA708Captions){var r=new l.default(t,"textTrack1");var i=new l.default(t,"textTrack2");t.cea608Parser=new n.default(0,r,i)}return t}e.prototype.addCues=function(e,t,r,i){var a=this.cueRanges;var n=false;for(var s=a.length;s--;){var o=a[s];var l=c(o[0],o[1],t,r);if(l>=0){o[0]=Math.min(o[0],t);o[1]=Math.max(o[1],r);n=true;if(l/(r-t)>.5){return}}}if(!n){a.push([t,r])}this.Cues.newCue(this.captionsTracks[e],t,r,i)};e.prototype.onInitPtsFound=function(e){var t=this;if(e.id==="main"){this.initPTS[e.frag.cc]=e.initPTS}if(this.unparsedVttFrags.length){var r=this.unparsedVttFrags;this.unparsedVttFrags=[];r.forEach(function(e){t.onFragLoaded(e)})}};e.prototype.getExistingTrack=function(e){var t=this.media;if(t){for(var r=0;r<t.textTracks.length;r++){var i=t.textTracks[r];if(i[e]){return i}}}return null};e.prototype.createCaptionsTrack=function(e){var t=this.captionsProperties[e],r=t.label,i=t.languageCode;var a=this.captionsTracks;if(!a[e]){var n=this.getExistingTrack(e);if(!n){var s=this.createTextTrack("captions",r,i);if(s){s[e]=true;a[e]=s}}else{a[e]=n;f.clearCurrentCues(a[e]);f.sendAddTrackEvent(a[e],this.media)}}};e.prototype.createTextTrack=function(e,t,r){var i=this.media;if(i){return i.addTextTrack(e,t,r)}};e.prototype.destroy=function(){r.default.prototype.destroy.call(this)};e.prototype.onMediaAttaching=function(e){this.media=e.media;this._cleanTracks()};e.prototype.onMediaDetaching=function(){var t=this.captionsTracks;Object.keys(t).forEach(function(e){f.clearCurrentCues(t[e]);delete t[e]})};e.prototype.onManifestLoading=function(){this.lastSn=-1;this.prevCC=-1;this.vttCCs={ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:false}};this._cleanTracks()};e.prototype._cleanTracks=function(){var e=this.media;if(e){var t=e.textTracks;if(t){for(var r=0;r<t.length;r++){f.clearCurrentCues(t[r])}}}};e.prototype.onManifestLoaded=function(e){var n=this;this.textTracks=[];this.unparsedVttFrags=this.unparsedVttFrags||[];this.initPTS=[];this.cueRanges=[];if(this.config.enableWebVTT){this.tracks=e.subtitles||[];var s=this.media?this.media.textTracks:[];this.tracks.forEach(function(e,t){var r;if(t<s.length){var i=null;for(var a=0;a<s.length;a++){if(d(s[a],e)){i=s[a];break}}if(i){r=i}}if(!r){r=n.createTextTrack("subtitles",e.name,e.lang)}if(e.default){r.mode=n.hls.subtitleDisplay?"showing":"hidden"}else{r.mode="disabled"}n.textTracks.push(r)})}};e.prototype.onLevelSwitching=function(){this.enabled=this.hls.currentLevel.closedCaptions!=="NONE"};e.prototype.onFragLoaded=function(e){var t=e.frag,r=e.payload;if(t.type==="main"){var i=t.sn;if(i!==this.lastSn+1){var a=this.cea608Parser;if(a){a.reset()}}this.lastSn=i}else if(t.type==="subtitle"){if(r.byteLength){if(!s.isFinite(this.initPTS[t.cc])){this.unparsedVttFrags.push(e);if(this.initPTS.length){this.hls.trigger(o.default.SUBTITLE_FRAG_PROCESSED,{success:false,frag:t})}return}var n=t.decryptdata;if(n==null||n.key==null||n.method!=="AES-128"){this._parseVTTs(t,r)}}else{this.hls.trigger(o.default.SUBTITLE_FRAG_PROCESSED,{success:false,frag:t})}}};e.prototype._parseVTTs=function(t,e){var r=this.vttCCs;if(!r[t.cc]){r[t.cc]={start:t.start,prevCC:this.prevCC,new:true};this.prevCC=t.cc}var a=this.textTracks,n=this.hls;i.default.parse(e,this.initPTS[t.cc],r,t.cc,function(e){var i=a[t.level];if(i.mode==="disabled"){n.trigger(o.default.SUBTITLE_FRAG_PROCESSED,{success:false,frag:t});return}e.forEach(function(t){if(!i.cues.getCueById(t.id)){try{i.addCue(t)}catch(e){var r=new window.TextTrackCue(t.startTime,t.endTime,t.text);r.id=t.id;i.addCue(r)}}});n.trigger(o.default.SUBTITLE_FRAG_PROCESSED,{success:true,frag:t})},function(e){u.logger.log("Failed to parse VTT cue: "+e);n.trigger(o.default.SUBTITLE_FRAG_PROCESSED,{success:false,frag:t})})};e.prototype.onFragDecrypted=function(e){var t=e.payload,r=e.frag;if(r.type==="subtitle"){if(!s.isFinite(this.initPTS[r.cc])){this.unparsedVttFrags.push(e);return}this._parseVTTs(r,t)}};e.prototype.onFragParsingUserdata=function(e){if(this.enabled&&this.config.enableCEA708Captions){for(var t=0;t<e.samples.length;t++){var r=this.extractCea608Data(e.samples[t].bytes);this.cea608Parser.addData(e.samples[t].pts,r)}}};e.prototype.extractCea608Data=function(e){var t=e[0]&31;var r=2;var i,a,n,s,o;var l=[];for(var u=0;u<t;u++){i=e[r++];a=127&e[r++];n=127&e[r++];s=(4&i)!==0;o=3&i;if(a===0&&n===0){continue}if(s){if(o===0){l.push(a);l.push(n)}}}return l};return e}(r.default);a.default=e}).call(this,h("./src/polyfills/number.js")["Number"])},"./src/crypt/aes-crypto.js":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});var i=function(){function e(e,t){this.subtle=e;this.aesIV=t}e.prototype.decrypt=function(e,t){return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},t,e)};return e}();t.default=i},"./src/crypt/aes-decryptor.js":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});function x(e){var t=e.byteLength;var r=t&&new DataView(e).getUint8(t-1);if(r){return e.slice(0,t-r)}else{return e}}t.removePadding=x;var i=function(){function e(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54];this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)];this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)];this.sBox=new Uint32Array(256);this.invSBox=new Uint32Array(256);this.key=new Uint32Array(0);this.initTable()}e.prototype.uint8ArrayToUint32Array_=function(e){var t=new DataView(e);var r=new Uint32Array(4);for(var i=0;i<4;i++){r[i]=t.getUint32(i*4)}return r};e.prototype.initTable=function(){var e=this.sBox;var t=this.invSBox;var r=this.subMix;var i=r[0];var a=r[1];var n=r[2];var s=r[3];var o=this.invSubMix;var l=o[0];var u=o[1];var f=o[2];var d=o[3];var c=new Uint32Array(256);var h=0;var p=0;var g=0;for(g=0;g<256;g++){if(g<128){c[g]=g<<1}else{c[g]=g<<1^283}}for(g=0;g<256;g++){var v=p^p<<1^p<<2^p<<3^p<<4;v=v>>>8^v&255^99;e[h]=v;t[v]=h;var m=c[h];var y=c[m];var E=c[y];var _=c[v]*257^v*16843008;i[h]=_<<24|_>>>8;a[h]=_<<16|_>>>16;n[h]=_<<8|_>>>24;s[h]=_;_=E*16843009^y*65537^m*257^h*16843008;l[v]=_<<24|_>>>8;u[v]=_<<16|_>>>16;f[v]=_<<8|_>>>24;d[v]=_;if(!h){h=p=1}else{h=m^c[c[c[E^m]]];p^=c[c[p]]}}};e.prototype.expandKey=function(e){var t=this.uint8ArrayToUint32Array_(e);var r=true;var i=0;while(i<t.length&&r){r=t[i]===this.key[i];i++}if(r){return}this.key=t;var a=this.keySize=t.length;if(a!==4&&a!==6&&a!==8){throw new Error("Invalid aes key size="+a)}var n=this.ksRows=(a+6+1)*4;var s;var o;var l=this.keySchedule=new Uint32Array(n);var u=this.invKeySchedule=new Uint32Array(n);var f=this.sBox;var d=this.rcon;var c=this.invSubMix;var h=c[0];var p=c[1];var g=c[2];var v=c[3];var m;var y;for(s=0;s<n;s++){if(s<a){m=l[s]=t[s];continue}y=m;if(s%a===0){y=y<<8|y>>>24;y=f[y>>>24]<<24|f[y>>>16&255]<<16|f[y>>>8&255]<<8|f[y&255];y^=d[s/a|0]<<24}else if(a>6&&s%a===4){y=f[y>>>24]<<24|f[y>>>16&255]<<16|f[y>>>8&255]<<8|f[y&255]}l[s]=m=(l[s-a]^y)>>>0}for(o=0;o<n;o++){s=n-o;if(o&3){y=l[s]}else{y=l[s-4]}if(o<4||s<=4){u[o]=y}else{u[o]=h[f[y>>>24]]^p[f[y>>>16&255]]^g[f[y>>>8&255]]^v[f[y&255]]}u[o]=u[o]>>>0}};e.prototype.networkToHostOrderSwap=function(e){return e<<24|(e&65280)<<8|(e&16711680)>>8|e>>>24};e.prototype.decrypt=function(e,t,r,i){var a=this.keySize+6;var n=this.invKeySchedule;var s=this.invSBox;var o=this.invSubMix;var l=o[0];var u=o[1];var f=o[2];var d=o[3];var c=this.uint8ArrayToUint32Array_(r);var h=c[0];var p=c[1];var g=c[2];var v=c[3];var m=new Int32Array(e);var y=new Int32Array(m.length);var E,_,T,S;var b,A,R,D;var L,w,O,k;var I,P;var C=this.networkToHostOrderSwap;while(t<m.length){L=C(m[t]);w=C(m[t+1]);O=C(m[t+2]);k=C(m[t+3]);b=L^n[0];A=k^n[1];R=O^n[2];D=w^n[3];I=4;for(P=1;P<a;P++){E=l[b>>>24]^u[A>>16&255]^f[R>>8&255]^d[D&255]^n[I];_=l[A>>>24]^u[R>>16&255]^f[D>>8&255]^d[b&255]^n[I+1];T=l[R>>>24]^u[D>>16&255]^f[b>>8&255]^d[A&255]^n[I+2];S=l[D>>>24]^u[b>>16&255]^f[A>>8&255]^d[R&255]^n[I+3];b=E;A=_;R=T;D=S;I=I+4}E=s[b>>>24]<<24^s[A>>16&255]<<16^s[R>>8&255]<<8^s[D&255]^n[I];_=s[A>>>24]<<24^s[R>>16&255]<<16^s[D>>8&255]<<8^s[b&255]^n[I+1];T=s[R>>>24]<<24^s[D>>16&255]<<16^s[b>>8&255]<<8^s[A&255]^n[I+2];S=s[D>>>24]<<24^s[b>>16&255]<<16^s[A>>8&255]<<8^s[R&255]^n[I+3];I=I+3;y[t]=C(E^h);y[t+1]=C(S^p);y[t+2]=C(T^g);y[t+3]=C(_^v);h=L;p=w;g=O;v=k;t=t+4}return i?x(y.buffer):y.buffer};e.prototype.destroy=function(){this.key=undefined;this.keySize=undefined;this.ksRows=undefined;this.sBox=undefined;this.invSBox=undefined;this.subMix=undefined;this.invSubMix=undefined;this.keySchedule=undefined;this.invKeySchedule=undefined;this.rcon=undefined};return e}();t.default=i},"./src/crypt/decrypter.js":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});var l=r("./src/crypt/aes-crypto.js");var u=r("./src/crypt/fast-aes-key.js");var f=r("./src/crypt/aes-decryptor.js");var n=r("./src/errors.js");var d=r("./src/utils/logger.js");var s=r("./src/events.js");var i=r("./src/utils/get-self-scope.js");var o=i.getSelfScope();var a=function(){function e(e,t,r){var i=(r===void 0?{}:r).removePKCS7Padding,a=i===void 0?true:i;this.logEnabled=true;this.observer=e;this.config=t;this.removePKCS7Padding=a;if(a){try{var n=o.crypto;if(n){this.subtle=n.subtle||n.webkitSubtle}}catch(e){}}this.disableWebCrypto=!this.subtle}e.prototype.isSync=function(){return this.disableWebCrypto&&this.config.enableSoftwareAES};e.prototype.decrypt=function(r,i,a,n){var s=this;if(this.disableWebCrypto&&this.config.enableSoftwareAES){if(this.logEnabled){d.logger.log("JS AES decrypt");this.logEnabled=false}var e=this.decryptor;if(!e){this.decryptor=e=new f.default}e.expandKey(i);n(e.decrypt(r,0,a,this.removePKCS7Padding))}else{if(this.logEnabled){d.logger.log("WebCrypto AES decrypt");this.logEnabled=false}var o=this.subtle;if(this.key!==i){this.key=i;this.fastAesKey=new u.default(o,i)}this.fastAesKey.expandKey().then(function(e){var t=new l.default(o,a);t.decrypt(r,e).catch(function(e){s.onWebCryptoError(e,r,i,a,n)}).then(function(e){n(e)})}).catch(function(e){s.onWebCryptoError(e,r,i,a,n)})}};e.prototype.onWebCryptoError=function(e,t,r,i,a){if(this.config.enableSoftwareAES){d.logger.log("WebCrypto Error, disable WebCrypto API");this.disableWebCrypto=true;this.logEnabled=true;this.decrypt(t,r,i,a)}else{d.logger.error("decrypting error : "+e.message);this.observer.trigger(s.default.ERROR,{type:n.ErrorTypes.MEDIA_ERROR,details:n.ErrorDetails.FRAG_DECRYPT_ERROR,fatal:true,reason:e.message})}};e.prototype.destroy=function(){var e=this.decryptor;if(e){e.destroy();this.decryptor=undefined}};return e}();t.default=a},"./src/crypt/fast-aes-key.js":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});var i=function(){function e(e,t){this.subtle=e;this.key=t}e.prototype.expandKey=function(){return this.subtle.importKey("raw",this.key,{name:"AES-CBC"},false,["encrypt","decrypt"])};return e}();t.default=i},"./src/demux/aacdemuxer.js":function(e,t,r){"use strict";(function(p){Object.defineProperty(t,"__esModule",{value:true});var g=r("./src/demux/adts.js");var v=r("./src/utils/logger.js");var m=r("./src/demux/id3.js");var e=function(){function e(e,t,r){this.observer=e;this.config=r;this.remuxer=t}e.prototype.resetInitSegment=function(e,t,r,i){this._audioTrack={container:"audio/adts",type:"audio",id:0,sequenceNumber:0,isAAC:true,samples:[],len:0,manifestCodec:t,duration:i,inputTimeScale:9e4}};e.prototype.resetTimeStamp=function(){};e.probe=function(e){if(!e){return false}var t=m.default.getID3Data(e,0)||[];var r=t.length;for(var i=e.length;r<i;r++){if(g.probe(e,r)){v.logger.log("ADTS sync word found !");return true}}return false};e.prototype.append=function(e,t,r,i){var a=this._audioTrack;var n=m.default.getID3Data(e,0)||[];var s=m.default.getTimeStamp(n);var o=p.isFinite(s)?s*90:t*9e4;var l=0;var u=o;var f=e.length;var d=n.length;var c=[{pts:u,dts:u,data:n}];while(d<f-1){if(g.isHeader(e,d)&&d+5<f){g.initTrackConfig(a,this.observer,e,d,a.manifestCodec);var h=g.appendFrame(a,e,d,o,l);if(h){d+=h.length;u=h.sample.pts;l++}else{v.logger.log("Unable to parse AAC frame");break}}else if(m.default.isHeader(e,d)){n=m.default.getID3Data(e,d);c.push({pts:u,dts:u,data:n});d+=n.length}else{d++}}this.remuxer.remux(a,{samples:[]},{samples:c,inputTimeScale:9e4},{samples:[]},t,r,i)};e.prototype.destroy=function(){};return e}();t.default=e}).call(this,r("./src/polyfills/number.js")["Number"])},"./src/demux/adts.js":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});var c=r("./src/utils/logger.js");var h=r("./src/errors.js");var p=r("./src/events.js");function s(e,t,r,i){var a,n,s,o,l,u=navigator.userAgent.toLowerCase(),f=i,d=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];a=((t[r+2]&192)>>>6)+1;n=(t[r+2]&60)>>>2;if(n>d.length-1){e.trigger(p.default.ERROR,{type:h.ErrorTypes.MEDIA_ERROR,details:h.ErrorDetails.FRAG_PARSING_ERROR,fatal:true,reason:"invalid ADTS sampling index:"+n});return}o=(t[r+2]&1)<<2;o|=(t[r+3]&192)>>>6;c.logger.log("manifest codec:"+i+",ADTS data:type:"+a+",sampleingIndex:"+n+"["+d[n]+"Hz],channelConfig:"+o);if(/firefox/i.test(u)){if(n>=6){a=5;l=new Array(4);s=n-3}else{a=2;l=new Array(2);s=n}}else if(u.indexOf("android")!==-1){a=2;l=new Array(2);s=n}else{a=5;l=new Array(4);if(i&&(i.indexOf("mp4a.40.29")!==-1||i.indexOf("mp4a.40.5")!==-1)||!i&&n>=6){s=n-3}else{if(i&&i.indexOf("mp4a.40.2")!==-1&&(n>=6&&o===1||/vivaldi/i.test(u))||!i&&o===1){a=2;l=new Array(2)}s=n}}l[0]=a<<3;l[0]|=(n&14)>>1;l[1]|=(n&1)<<7;l[1]|=o<<3;if(a===5){l[1]|=(s&14)>>1;l[2]=(s&1)<<7;l[2]|=2<<2;l[3]=0}return{config:l,samplerate:d[n],channelCount:o,codec:"mp4a.40."+a,manifestCodec:f}}t.getAudioConfig=s;function n(e,t){return e[t]===255&&(e[t+1]&246)===240}t.isHeaderPattern=n;function u(e,t){return e[t+1]&1?7:9}t.getHeaderLength=u;function f(e,t){return(e[t+3]&3)<<11|e[t+4]<<3|(e[t+5]&224)>>>5}t.getFullFrameLength=f;function i(e,t){if(t+1<e.length&&n(e,t)){return true}return false}t.isHeader=i;function a(e,t){if(t+1<e.length&&n(e,t)){var r=u(e,t);var i=r;if(t+5<e.length){i=f(e,t)}var a=t+i;if(a===e.length||a+1<e.length&&n(e,a)){return true}}return false}t.probe=a;function o(e,t,r,i,a){if(!e.samplerate){var n=s(t,r,i,a);e.config=n.config;e.samplerate=n.samplerate;e.channelCount=n.channelCount;e.codec=n.codec;e.manifestCodec=n.manifestCodec;c.logger.log("parsed codec:"+e.codec+",rate:"+n.samplerate+",nb channel:"+n.channelCount)}}t.initTrackConfig=o;function d(e){return 1024*9e4/e}t.getFrameDuration=d;function g(e,t,r,i,a){var n,s,o;var l=e.length;n=u(e,t);s=f(e,t);s-=n;if(s>0&&t+n+s<=l){o=r+i*a;return{headerLength:n,frameLength:s,stamp:o}}return undefined}t.parseFrameHeader=g;function l(e,t,r,i,a){var n=d(e.samplerate);var s=g(t,r,i,a,n);if(s){var o=s.stamp;var l=s.headerLength;var u=s.frameLength;var f={unit:t.subarray(r+l,r+l+u),pts:o,dts:o};e.samples.push(f);e.len+=u;return{sample:f,length:u+l}}return undefined}t.appendFrame=l},"./src/demux/demuxer-inline.js":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});var b=r("./src/events.js");var A=r("./src/errors.js");var g=r("./src/crypt/decrypter.js");var R=r("./src/demux/aacdemuxer.js");var D=r("./src/demux/mp4demuxer.js");var L=r("./src/demux/tsdemuxer.js");var w=r("./src/demux/mp3demuxer.js");var O=r("./src/remux/mp4-remuxer.js");var k=r("./src/remux/passthrough-remuxer.js");var i=r("./src/utils/get-self-scope.js");var a=r("./src/utils/logger.js");var n=i.getSelfScope();var v;try{v=n.performance.now.bind(n.performance)}catch(e){a.logger.debug("Unable to use Performance API on this environment");v=n.Date.now}var s=function(){function e(e,t,r,i){this.observer=e;this.typeSupported=t;this.config=r;this.vendor=i}e.prototype.destroy=function(){var e=this.demuxer;if(e){e.destroy()}};e.prototype.push=function(e,r,i,a,n,s,o,l,u,f,d,c){var h=this;if(e.byteLength>0&&r!=null&&r.key!=null&&r.method==="AES-128"){var t=this.decrypter;if(t==null){t=this.decrypter=new g.default(this.observer,this.config)}var p=v();t.decrypt(e,r.key.buffer,r.iv.buffer,function(e){var t=v();h.observer.trigger(b.default.FRAG_DECRYPTED,{stats:{tstart:p,tdecrypt:t}});h.pushDecrypted(new Uint8Array(e),r,new Uint8Array(i),a,n,s,o,l,u,f,d,c)})}else{this.pushDecrypted(new Uint8Array(e),r,new Uint8Array(i),a,n,s,o,l,u,f,d,c)}};e.prototype.pushDecrypted=function(e,t,r,i,a,n,s,o,l,u,f,d){var c=this.demuxer;if(!c||(s||o)&&!this.probe(e)){var h=this.observer;var p=this.typeSupported;var g=this.config;var v=[{demux:L.default,remux:O.default},{demux:D.default,remux:k.default},{demux:R.default,remux:O.default},{demux:w.default,remux:O.default}];for(var m=0,y=v.length;m<y;m++){var E=v[m];var _=E.demux.probe;if(_(e)){var T=this.remuxer=new E.remux(h,g,p,this.vendor);c=new E.demux(h,T,g,p);this.probe=_;break}}if(!c){h.trigger(b.default.ERROR,{type:A.ErrorTypes.MEDIA_ERROR,details:A.ErrorDetails.FRAG_PARSING_ERROR,fatal:true,reason:"no demux matching with content found"});return}this.demuxer=c}var S=this.remuxer;if(s||o){c.resetInitSegment(r,i,a,u);S.resetInitSegment()}if(s){c.resetTimeStamp(d);S.resetTimeStamp(d)}if(typeof c.setDecryptData==="function"){c.setDecryptData(t)}c.append(e,n,l,f)};return e}();t.default=s},"./src/demux/demuxer-worker.js":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});var s=r("./src/demux/demuxer-inline.js");var o=r("./src/events.js");var l=r("./src/utils/logger.js");var u=r("./node_modules/node-libs-browser/node_modules/events/events.js");var i=function(a){var n=new u.EventEmitter;n.trigger=function e(t){var r=[];for(var i=1;i<arguments.length;i++){r[i-1]=arguments[i]}n.emit.apply(n,[t,t].concat(r))};n.off=function e(t){var r=[];for(var i=1;i<arguments.length;i++){r[i-1]=arguments[i]}n.removeListener.apply(n,[t].concat(r))};var i=function(e,t){a.postMessage({event:e,data:t})};a.addEventListener("message",function(e){var t=e.data;switch(t.cmd){case"init":var r=JSON.parse(t.config);a.demuxer=new s.default(n,t.typeSupported,r,t.vendor);l.enableLogs(r.debug);i("init",null);break;case"demux":a.demuxer.push(t.data,t.decryptdata,t.initSegment,t.audioCodec,t.videoCodec,t.timeOffset,t.discontinuity,t.trackSwitch,t.contiguous,t.duration,t.accurateTimeOffset,t.defaultInitPTS);break;default:break}});n.on(o.default.FRAG_DECRYPTED,i);n.on(o.default.FRAG_PARSING_INIT_SEGMENT,i);n.on(o.default.FRAG_PARSED,i);n.on(o.default.ERROR,i);n.on(o.default.FRAG_PARSING_METADATA,i);n.on(o.default.FRAG_PARSING_USERDATA,i);n.on(o.default.INIT_PTS_FOUND,i);n.on(o.default.FRAG_PARSING_DATA,function(e,t){var r=[];var i={event:e,data:t};if(t.data1){i.data1=t.data1.buffer;r.push(t.data1.buffer);delete t.data1}if(t.data2){i.data2=t.data2.buffer;r.push(t.data2.buffer);delete t.data2}a.postMessage(i,r)})};t.default=i},"./src/demux/demuxer.js":function(e,i,a){"use strict";(function(m){Object.defineProperty(i,"__esModule",{value:true});var u=a("./node_modules/webworkify-webpack/index.js");var f=a("./src/events.js");var d=a("./src/demux/demuxer-inline.js");var y=a("./src/utils/logger.js");var c=a("./src/errors.js");var e=a("./src/utils/mediasource-helper.js");var t=a("./src/utils/get-self-scope.js");var h=a("./src/observer.js");var p=t.getSelfScope();var g=e.getMediaSource();var r=function(){function e(r,e){var i=this;this.hls=r;this.id=e;var t=this.observer=new h.Observer;var a=r.config;var n=function(e,t){t=t||{};t.frag=i.frag;t.id=i.id;r.trigger(e,t)};t.on(f.default.FRAG_DECRYPTED,n);t.on(f.default.FRAG_PARSING_INIT_SEGMENT,n);t.on(f.default.FRAG_PARSING_DATA,n);t.on(f.default.FRAG_PARSED,n);t.on(f.default.ERROR,n);t.on(f.default.FRAG_PARSING_METADATA,n);t.on(f.default.FRAG_PARSING_USERDATA,n);t.on(f.default.INIT_PTS_FOUND,n);var s={mp4:g.isTypeSupported("video/mp4"),mpeg:g.isTypeSupported("audio/mpeg"),mp3:g.isTypeSupported('audio/mp4; codecs="mp3"')};var o=navigator.vendor;if(a.enableWorker&&typeof Worker!=="undefined"){y.logger.log("demuxing in webworker");var l=void 0;try{l=this.w=u("./src/demux/demuxer-worker.js");this.onwmsg=this.onWorkerMessage.bind(this);l.addEventListener("message",this.onwmsg);l.onerror=function(e){r.trigger(f.default.ERROR,{type:c.ErrorTypes.OTHER_ERROR,details:c.ErrorDetails.INTERNAL_EXCEPTION,fatal:true,event:"demuxerWorker",err:{message:e.message+" ("+e.filename+":"+e.lineno+")"}})};l.postMessage({cmd:"init",typeSupported:s,vendor:o,id:e,config:JSON.stringify(a)})}catch(e){y.logger.warn("Error in worker:",e);y.logger.error("Error while initializing DemuxerWorker, fallback on DemuxerInline");if(l){p.URL.revokeObjectURL(l.objectURL)}this.demuxer=new d.default(t,s,a,o);this.w=undefined}}else{this.demuxer=new d.default(t,s,a,o)}}e.prototype.destroy=function(){var e=this.w;if(e){e.removeEventListener("message",this.onwmsg);e.terminate();this.w=null}else{var t=this.demuxer;if(t){t.destroy();this.demuxer=null}}var r=this.observer;if(r){r.removeAllListeners();this.observer=null}};e.prototype.push=function(e,t,r,i,a,n,s,o){var l=this.w;var u=m.isFinite(a.startPTS)?a.startPTS:a.start;var f=a.decryptdata;var d=this.frag;var c=!(d&&a.cc===d.cc);var h=!(d&&a.level===d.level);var p=d&&a.sn===d.sn+1;var g=!h&&p;if(c){y.logger.log(this.id+":discontinuity detected")}if(h){y.logger.log(this.id+":switch detected")}this.frag=a;if(l){l.postMessage({cmd:"demux",data:e,decryptdata:f,initSegment:t,audioCodec:r,videoCodec:i,timeOffset:u,discontinuity:c,trackSwitch:h,contiguous:g,duration:n,accurateTimeOffset:s,defaultInitPTS:o},e instanceof ArrayBuffer?[e]:[])}else{var v=this.demuxer;if(v){v.push(e,f,t,r,i,u,c,h,g,n,s,o)}}};e.prototype.onWorkerMessage=function(e){var t=e.data,r=this.hls;switch(t.event){case"init":p.URL.revokeObjectURL(this.w.objectURL);break;case f.default.FRAG_PARSING_DATA:t.data.data1=new Uint8Array(t.data1);if(t.data2){t.data.data2=new Uint8Array(t.data2)}default:t.data=t.data||{};t.data.frag=this.frag;t.data.id=this.id;r.trigger(t.event,t.data);break}};return e}();i.default=r}).call(this,a("./src/polyfills/number.js")["Number"])},"./src/demux/exp-golomb.js":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});var i=r("./src/utils/logger.js");var a=function(){function e(e){this.data=e;this.bytesAvailable=e.byteLength;this.word=0;this.bitsAvailable=0}e.prototype.loadWord=function(){var e=this.data,t=this.bytesAvailable,r=e.byteLength-t,i=new Uint8Array(4),a=Math.min(4,t);if(a===0){throw new Error("no bytes available")}i.set(e.subarray(r,r+a));this.word=new DataView(i.buffer).getUint32(0);this.bitsAvailable=a*8;this.bytesAvailable-=a};e.prototype.skipBits=function(e){var t;if(this.bitsAvailable>e){this.word<<=e;this.bitsAvailable-=e}else{e-=this.bitsAvailable;t=e>>3;e-=t>>3;this.bytesAvailable-=t;this.loadWord();this.word<<=e;this.bitsAvailable-=e}};e.prototype.readBits=function(e){var t=Math.min(this.bitsAvailable,e),r=this.word>>>32-t;if(e>32){i.logger.error("Cannot read more than 32 bits at a time")}this.bitsAvailable-=t;if(this.bitsAvailable>0){this.word<<=t}else if(this.bytesAvailable>0){this.loadWord()}t=e-t;if(t>0&&this.bitsAvailable){return r<<t|this.readBits(t)}else{return r}};e.prototype.skipLZ=function(){var e;for(e=0;e<this.bitsAvailable;++e){if((this.word&2147483648>>>e)!==0){this.word<<=e;this.bitsAvailable-=e;return e}}this.loadWord();return e+this.skipLZ()};e.prototype.skipUEG=function(){this.skipBits(1+this.skipLZ())};e.prototype.skipEG=function(){this.skipBits(1+this.skipLZ())};e.prototype.readUEG=function(){var e=this.skipLZ();return this.readBits(e+1)-1};e.prototype.readEG=function(){var e=this.readUEG();if(1&e){return 1+e>>>1}else{return-1*(e>>>1)}};e.prototype.readBoolean=function(){return this.readBits(1)===1};e.prototype.readUByte=function(){return this.readBits(8)};e.prototype.readUShort=function(){return this.readBits(16)};e.prototype.readUInt=function(){return this.readBits(32)};e.prototype.skipScalingList=function(e){var t=8,r=8,i,a;for(i=0;i<e;i++){if(r!==0){a=this.readEG();r=(t+a+256)%256}t=r===0?t:r}};e.prototype.readSPS=function(){var e=0,t=0,r=0,i=0,a,n,s,o,l,u,f,d,c,h=this.readUByte.bind(this),p=this.readBits.bind(this),g=this.readUEG.bind(this),v=this.readBoolean.bind(this),m=this.skipBits.bind(this),y=this.skipEG.bind(this),E=this.skipUEG.bind(this),_=this.skipScalingList.bind(this);h();a=h();n=p(5);m(3);s=h();E();if(a===100||a===110||a===122||a===244||a===44||a===83||a===86||a===118||a===128){var T=g();if(T===3){m(1)}E();E();m(1);if(v()){d=T!==3?8:12;for(c=0;c<d;c++){if(v()){if(c<6){_(16)}else{_(64)}}}}}E();var S=g();if(S===0){g()}else if(S===1){m(1);y();y();o=g();for(c=0;c<o;c++){y()}}E();m(1);l=g();u=g();f=p(1);if(f===0){m(1)}m(1);if(v()){e=g();t=g();r=g();i=g()}var b=[1,1];if(v()){if(v()){var A=h();switch(A){case 1:b=[1,1];break;case 2:b=[12,11];break;case 3:b=[10,11];break;case 4:b=[16,11];break;case 5:b=[40,33];break;case 6:b=[24,11];break;case 7:b=[20,11];break;case 8:b=[32,11];break;case 9:b=[80,33];break;case 10:b=[18,11];break;case 11:b=[15,11];break;case 12:b=[64,33];break;case 13:b=[160,99];break;case 14:b=[4,3];break;case 15:b=[3,2];break;case 16:b=[2,1];break;case 255:{b=[h()<<8|h(),h()<<8|h()];break}}}}return{width:Math.ceil((l+1)*16-e*2-t*2),height:(2-f)*(u+1)*16-(f?2:4)*(r+i),pixelRatio:b}};e.prototype.readSliceType=function(){this.readUByte();this.readUEG();return this.readUEG()};return e}();t.default=a},"./src/demux/id3.js":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});var i=function(){function o(){}o.isHeader=function(e,t){if(t+10<=e.length){if(e[t]===73&&e[t+1]===68&&e[t+2]===51){if(e[t+3]<255&&e[t+4]<255){if(e[t+6]<128&&e[t+7]<128&&e[t+8]<128&&e[t+9]<128){return true}}}}return false};o.isFooter=function(e,t){if(t+10<=e.length){if(e[t]===51&&e[t+1]===68&&e[t+2]===73){if(e[t+3]<255&&e[t+4]<255){if(e[t+6]<128&&e[t+7]<128&&e[t+8]<128&&e[t+9]<128){return true}}}}return false};o.getID3Data=function(e,t){var r=t;var i=0;while(o.isHeader(e,t)){i+=10;var a=o._readSize(e,t+6);i+=a;if(o.isFooter(e,t+10)){i+=10}t+=i}if(i>0){return e.subarray(r,r+i)}return undefined};o._readSize=function(e,t){var r=0;r=(e[t]&127)<<21;r|=(e[t+1]&127)<<14;r|=(e[t+2]&127)<<7;r|=e[t+3]&127;return r};o.getTimeStamp=function(e){var t=o.getID3Frames(e);for(var r=0;r<t.length;r++){var i=t[r];if(o.isTimeStampFrame(i)){return o._readTimeStamp(i)}}return undefined};o.isTimeStampFrame=function(e){return e&&e.key==="PRIV"&&e.info==="com.apple.streaming.transportStreamTimestamp"};o._getFrameData=function(e){var t=String.fromCharCode(e[0],e[1],e[2],e[3]);var r=o._readSize(e,4);var i=10;return{type:t,size:r,data:e.subarray(i,i+r)}};o.getID3Frames=function(e){var t=0;var r=[];while(o.isHeader(e,t)){var i=o._readSize(e,t+6);t+=10;var a=t+i;while(t+8<a){var n=o._getFrameData(e.subarray(t));var s=o._decodeFrame(n);if(s){r.push(s)}t+=n.size+10}if(o.isFooter(e,t)){t+=10}}return r};o._decodeFrame=function(e){if(e.type==="PRIV"){return o._decodePrivFrame(e)}else if(e.type[0]==="T"){return o._decodeTextFrame(e)}else if(e.type[0]==="W"){return o._decodeURLFrame(e)}return undefined};o._readTimeStamp=function(e){if(e.data.byteLength===8){var t=new Uint8Array(e.data);var r=t[3]&1;var i=(t[4]<<23)+(t[5]<<15)+(t[6]<<7)+t[7];i/=45;if(r){i+=47721858.84}return Math.round(i)}return undefined};o._decodePrivFrame=function(e){if(e.size<2){return undefined}var t=o._utf8ArrayToStr(e.data,true);var r=new Uint8Array(e.data.subarray(t.length+1));return{key:e.type,info:t,data:r.buffer}};o._decodeTextFrame=function(e){if(e.size<2){return undefined}if(e.type==="TXXX"){var t=1;var r=o._utf8ArrayToStr(e.data.subarray(t));t+=r.length+1;var i=o._utf8ArrayToStr(e.data.subarray(t));return{key:e.type,info:r,data:i}}else{var a=o._utf8ArrayToStr(e.data.subarray(1));return{key:e.type,data:a}}};o._decodeURLFrame=function(e){if(e.type==="WXXX"){if(e.size<2){return undefined}var t=1;var r=o._utf8ArrayToStr(e.data.subarray(t));t+=r.length+1;var i=o._utf8ArrayToStr(e.data.subarray(t));return{key:e.type,info:r,data:i}}else{var a=o._utf8ArrayToStr(e.data);return{key:e.type,data:a}}};o._utf8ArrayToStr=function(e,t){if(t===void 0){t=false}var r=e.length;var i;var a;var n;var s="";var o=0;while(o<r){i=e[o++];if(i===0&&t){return s}else if(i===0||i===3){continue}switch(i>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:s+=String.fromCharCode(i);break;case 12:case 13:a=e[o++];s+=String.fromCharCode((i&31)<<6|a&63);break;case 14:a=e[o++];n=e[o++];s+=String.fromCharCode((i&15)<<12|(a&63)<<6|(n&63)<<0);break;default:}}return s};return o}();var a=i._utf8ArrayToStr;t.utf8ArrayToStr=a;t.default=i},"./src/demux/mp3demuxer.js":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});var p=r("./src/demux/id3.js");var a=r("./src/utils/logger.js");var g=r("./src/demux/mpegaudio.js");var i=function(){function e(e,t,r){this.observer=e;this.config=r;this.remuxer=t}e.prototype.resetInitSegment=function(e,t,r,i){this._audioTrack={container:"audio/mpeg",type:"audio",id:-1,sequenceNumber:0,isAAC:false,samples:[],len:0,manifestCodec:t,duration:i,inputTimeScale:9e4}};e.prototype.resetTimeStamp=function(){};e.probe=function(e){var t,r;var i=p.default.getID3Data(e,0);if(i&&p.default.getTimeStamp(i)!==undefined){for(t=i.length,r=Math.min(e.length-1,t+100);t<r;t++){if(g.default.probe(e,t)){a.logger.log("MPEG Audio sync word found !");return true}}}return false};e.prototype.append=function(e,t,r,i){var a=p.default.getID3Data(e,0);var n=p.default.getTimeStamp(a);var s=n?90*n:t*9e4;var o=a.length;var l=e.length;var u=0,f=0;var d=this._audioTrack;var c=[{pts:s,dts:s,data:a}];while(o<l){if(g.default.isHeader(e,o)){var h=g.default.appendFrame(d,e,o,s,u);if(h){o+=h.length;f=h.sample.pts;u++}else{break}}else if(p.default.isHeader(e,o)){a=p.default.getID3Data(e,o);c.push({pts:f,dts:f,data:a});o+=a.length}else{o++}}this.remuxer.remux(d,{samples:[]},{samples:c,inputTimeScale:9e4},{samples:[]},t,r,i)};e.prototype.destroy=function(){};return e}();t.default=i},"./src/demux/mp4demuxer.js":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});var h=r("./src/utils/logger.js");var l=r("./src/events.js");var o=Math.pow(2,32)-1;var i=function(){function y(e,t){this.observer=e;this.remuxer=t}y.prototype.resetTimeStamp=function(e){this.initPTS=e};y.prototype.resetInitSegment=function(e,t,r,i){if(e&&e.byteLength){var a=this.initData=y.parseInitSegment(e);if(t==null){t="mp4a.40.5"}if(r==null){r="avc1.42e01e"}var n={};if(a.audio&&a.video){n.audiovideo={container:"video/mp4",codec:t+","+r,initSegment:i?e:null}}else{if(a.audio){n.audio={container:"audio/mp4",codec:t,initSegment:i?e:null}}if(a.video){n.video={container:"video/mp4",codec:r,initSegment:i?e:null}}}this.observer.trigger(l.default.FRAG_PARSING_INIT_SEGMENT,{tracks:n})}else{if(t){this.audioCodec=t}if(r){this.videoCodec=r}}};y.probe=function(e){return y.findBox({data:e,start:0,end:Math.min(e.length,16384)},["moof"]).length>0};y.bin2str=function(e){return String.fromCharCode.apply(null,e)};y.readUint16=function(e,t){if(e.data){t+=e.start;e=e.data}var r=e[t]<<8|e[t+1];return r<0?65536+r:r};y.readUint32=function(e,t){if(e.data){t+=e.start;e=e.data}var r=e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3];return r<0?4294967296+r:r};y.writeUint32=function(e,t,r){if(e.data){t+=e.start;e=e.data}e[t]=r>>24;e[t+1]=r>>16&255;e[t+2]=r>>8&255;e[t+3]=r&255};y.findBox=function(e,t){var r=[],i,a,n,s,o,l,u;if(e.data){l=e.start;s=e.end;e=e.data}else{l=0;s=e.byteLength}if(!t.length){return null}for(i=l;i<s;){a=y.readUint32(e,i);n=y.bin2str(e.subarray(i+4,i+8));u=a>1?i+a:s;if(n===t[0]){if(t.length===1){r.push({data:e,start:i+8,end:u})}else{o=y.findBox({data:e,start:i+8,end:u},t.slice(1));if(o.length){r=r.concat(o)}}}i=u}return r};y.parseSegmentIndex=function(e){var t=y.findBox(e,["moov"])[0];var r=t?t.end:null;var i=0;var a=y.findBox(e,["sidx"]);var n;if(!a||!a[0]){return null}n=[];a=a[0];var s=a.data[0];i=s===0?8:16;var o=y.readUint32(a,i);i+=4;var l=0;var u=0;if(s===0){i+=8}else{i+=16}i+=2;var f=a.end+u;var d=y.readUint16(a,i);i+=2;for(var c=0;c<d;c++){var h=i;var p=y.readUint32(a,h);h+=4;var g=p&2147483647;var v=(p&2147483648)>>>31;if(v===1){console.warn("SIDX has hierarchical references (not supported)");return}var m=y.readUint32(a,h);h+=4;n.push({referenceSize:g,subsegmentDuration:m,info:{duration:m/o,start:f,end:f+g-1}});f+=g;h+=4;i=h}return{earliestPresentationTime:l,timescale:o,version:s,referencesCount:d,references:n,moovEndOffset:r}};y.parseInitSegment=function(e){var c=[];var t=y.findBox(e,["moov","trak"]);t.forEach(function(e){var t=y.findBox(e,["tkhd"])[0];if(t){var r=t.data[t.start];var i=r===0?12:20;var a=y.readUint32(t,i);var n=y.findBox(e,["mdia","mdhd"])[0];if(n){r=n.data[n.start];i=r===0?12:20;var s=y.readUint32(n,i);var o=y.findBox(e,["mdia","hdlr"])[0];if(o){var l=y.bin2str(o.data.subarray(o.start+8,o.start+12));var u={soun:"audio",vide:"video"}[l];if(u){var f=y.findBox(e,["mdia","minf","stbl","stsd"]);if(f.length){f=f[0];var d=y.bin2str(f.data.subarray(f.start+12,f.start+16));h.logger.log("MP4Demuxer:"+u+":"+d+" found")}c[a]={timescale:s,type:u};c[u]={timescale:s,id:a}}}}}});return c};y.getStartDTS=function(n,e){var t,r,i;t=y.findBox(e,["moof","traf"]);r=[].concat.apply([],t.map(function(a){return y.findBox(a,["tfhd"]).map(function(e){var t,r,i;t=y.readUint32(e,4);r=n[t].timescale||9e4;i=y.findBox(a,["tfdt"]).map(function(e){var t,r;t=e.data[e.start];r=y.readUint32(e,4);if(t===1){r*=Math.pow(2,32);r+=y.readUint32(e,8)}return r})[0];return i/r})}));i=Math.min.apply(null,r);return isFinite(i)?i:0};y.offsetStartDTS=function(i,e,s){y.findBox(e,["moof","traf"]).map(function(r){return y.findBox(r,["tfhd"]).map(function(e){var t=y.readUint32(e,4);var n=i[t].timescale||9e4;y.findBox(r,["tfdt"]).map(function(e){var t=e.data[e.start];var r=y.readUint32(e,4);if(t===0){y.writeUint32(e,4,r-s*n)}else{r*=Math.pow(2,32);r+=y.readUint32(e,8);r-=s*n;r=Math.max(r,0);var i=Math.floor(r/(o+1));var a=Math.floor(r%(o+1));y.writeUint32(e,4,i);y.writeUint32(e,8,a)}})})})};y.prototype.append=function(e,t,r,i){var a=this.initData;if(!a){this.resetInitSegment(e,this.audioCodec,this.videoCodec,false);a=this.initData}var n,s=this.initPTS;if(s===undefined){var o=y.getStartDTS(a,e);this.initPTS=s=o-t;this.observer.trigger(l.default.INIT_PTS_FOUND,{initPTS:s})}y.offsetStartDTS(a,e,s);n=y.getStartDTS(a,e);this.remuxer.remux(a.audio,a.video,null,null,n,r,i,e)};y.prototype.destroy=function(){};return y}();t.default=i},"./src/demux/mpegaudio.js":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});var v={BitratesMap:[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],SamplingRateMap:[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],SamplesCoefficients:[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],BytesInSlot:[0,1,1,4],appendFrame:function(e,t,r,i,a){if(r+24>t.length){return undefined}var n=this.parseHeader(t,r);if(n&&r+n.frameLength<=t.length){var s=n.samplesPerFrame*9e4/n.sampleRate;var o=i+a*s;var l={unit:t.subarray(r,r+n.frameLength),pts:o,dts:o};e.config=[];e.channelCount=n.channelCount;e.samplerate=n.sampleRate;e.samples.push(l);e.len+=n.frameLength;return{sample:l,length:n.frameLength}}return undefined},parseHeader:function(e,t){var r=e[t+1]>>3&3;var i=e[t+1]>>1&3;var a=e[t+2]>>4&15;var n=e[t+2]>>2&3;var s=e[t+2]>>1&1;if(r!==1&&a!==0&&a!==15&&n!==3){var o=r===3?3-i:i===3?3:4;var l=v.BitratesMap[o*14+a-1]*1e3;var u=r===3?0:r===2?1:2;var f=v.SamplingRateMap[u*3+n];var d=e[t+3]>>6===3?1:2;var c=v.SamplesCoefficients[r][i];var h=v.BytesInSlot[i];var p=c*8*h;var g=parseInt(c*l/f+s,10)*h;return{sampleRate:f,channelCount:d,frameLength:g,samplesPerFrame:p}}return undefined},isHeaderPattern:function(e,t){return e[t]===255&&(e[t+1]&224)===224&&(e[t+1]&6)!==0},isHeader:function(e,t){if(t+1<e.length&&this.isHeaderPattern(e,t)){return true}return false},probe:function(e,t){if(t+1<e.length&&this.isHeaderPattern(e,t)){var r=4;var i=this.parseHeader(e,t);var a=r;if(i&&i.frameLength){a=i.frameLength}var n=t+a;if(n===e.length||n+1<e.length&&this.isHeaderPattern(e,n)){return true}}return false}};t.default=v},"./src/demux/sample-aes.js":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});var a=r("./src/crypt/decrypter.js");var i=function(){function e(e,t,r,i){this.decryptdata=r;this.discardEPB=i;this.decrypter=new a.default(e,t,{removePKCS7Padding:false})}e.prototype.decryptBuffer=function(e,t){this.decrypter.decrypt(e,this.decryptdata.key.buffer,this.decryptdata.iv.buffer,t)};e.prototype.decryptAacSample=function(t,r,i,a){var n=t[r].unit;var e=n.subarray(16,n.length-n.length%16);var s=e.buffer.slice(e.byteOffset,e.byteOffset+e.length);var o=this;this.decryptBuffer(s,function(e){e=new Uint8Array(e);n.set(e,16);if(!a){o.decryptAacSamples(t,r+1,i)}})};e.prototype.decryptAacSamples=function(e,t,r){for(;;t++){if(t>=e.length){r();return}if(e[t].unit.length<32){continue}var i=this.decrypter.isSync();this.decryptAacSample(e,t,r,i);if(!i){return}}};e.prototype.getAvcEncryptedData=function(e){var t=Math.floor((e.length-48)/160)*16+16;var r=new Int8Array(t);var i=0;for(var a=32;a<=e.length-16;a+=160,i+=16){r.set(e.subarray(a,a+16),i)}return r};e.prototype.getAvcDecryptedUnit=function(e,t){t=new Uint8Array(t);var r=0;for(var i=32;i<=e.length-16;i+=160,r+=16){e.set(t.subarray(r,r+16),i)}return e};e.prototype.decryptAvcSample=function(t,r,i,a,n,s){var o=this.discardEPB(n.data);var e=this.getAvcEncryptedData(o);var l=this;this.decryptBuffer(e.buffer,function(e){n.data=l.getAvcDecryptedUnit(o,e);if(!s){l.decryptAvcSamples(t,r,i+1,a)}})};e.prototype.decryptAvcSamples=function(e,t,r,i){for(;;t++,r=0){if(t>=e.length){i();return}var a=e[t].units;for(;;r++){if(r>=a.length){break}var n=a[r];if(n.length<=48||n.type!==1&&n.type!==5){continue}var s=this.decrypter.isSync();this.decryptAvcSample(e,t,r,i,n,s);if(!s){return}}}};return e}();t.default=i},"./src/demux/tsdemuxer.js":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});var m=r("./src/demux/adts.js");var o=r("./src/demux/mpegaudio.js");var C=r("./src/events.js");var I=r("./src/demux/exp-golomb.js");var i=r("./src/demux/sample-aes.js");var x=r("./src/utils/logger.js");var F=r("./src/errors.js");var a={video:1,audio:2,id3:3,text:4};var n=function(){function P(e,t,r,i){this.observer=e;this.config=r;this.typeSupported=i;this.remuxer=t;this.sampleAes=null}P.prototype.setDecryptData=function(e){if(e!=null&&e.key!=null&&e.method==="SAMPLE-AES"){this.sampleAes=new i.default(this.observer,this.config,e,this.discardEPB)}else{this.sampleAes=null}};P.probe=function(e){var t=P._syncOffset(e);if(t<0){return false}else{if(t){x.logger.warn("MPEG2-TS detected but first sync word found @ offset "+t+", junk ahead ?")}return true}};P._syncOffset=function(e){var t=Math.min(1e3,e.length-3*188);var r=0;while(r<t){if(e[r]===71&&e[r+188]===71&&e[r+2*188]===71){return r}else{r++}}return-1};P.createTrack=function(e,t){return{container:e==="video"||e==="audio"?"video/mp2t":undefined,type:e,id:a[e],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],len:0,dropped:e==="video"?0:undefined,isAAC:e==="audio"?true:undefined,duration:e==="audio"?t:undefined}};P.prototype.resetInitSegment=function(e,t,r,i){this.pmtParsed=false;this._pmtId=-1;this._avcTrack=P.createTrack("video",i);this._audioTrack=P.createTrack("audio",i);this._id3Track=P.createTrack("id3",i);this._txtTrack=P.createTrack("text",i);this.aacOverFlow=null;this.aacLastPTS=null;this.avcSample=null;this.audioCodec=t;this.videoCodec=r;this._duration=i};P.prototype.resetTimeStamp=function(){};P.prototype.append=function(e,t,r,i){var a,n=e.length,s,o,l,u,f,d=false;this.contiguous=r;var c=this.pmtParsed,h=this._avcTrack,p=this._audioTrack,g=this._id3Track,v=h.pid,m=p.pid,y=g.pid,E=this._pmtId,_=h.pesData,T=p.pesData,S=g.pesData,b=this._parsePAT,A=this._parsePMT,R=this._parsePES,D=this._parseAVCPES.bind(this),L=this._parseAACPES.bind(this),w=this._parseMPEGPES.bind(this),O=this._parseID3PES.bind(this);var k=P._syncOffset(e);n-=(n+k)%188;for(a=k;a<n;a+=188){if(e[a]===71){s=!!(e[a+1]&64);o=((e[a+1]&31)<<8)+e[a+2];l=(e[a+3]&48)>>4;if(l>1){u=a+5+e[a+4];if(u===a+188){continue}}else{u=a+4}switch(o){case v:if(s){if(_&&(f=R(_))&&f.pts!==undefined){D(f,false)}_={data:[],size:0}}if(_){_.data.push(e.subarray(u,a+188));_.size+=a+188-u}break;case m:if(s){if(T&&(f=R(T))&&f.pts!==undefined){if(p.isAAC){L(f)}else{w(f)}}T={data:[],size:0}}if(T){T.data.push(e.subarray(u,a+188));T.size+=a+188-u}break;case y:if(s){if(S&&(f=R(S))&&f.pts!==undefined){O(f)}S={data:[],size:0}}if(S){S.data.push(e.subarray(u,a+188));S.size+=a+188-u}break;case 0:if(s){u+=e[u]+1}E=this._pmtId=b(e,u);break;case E:if(s){u+=e[u]+1}var I=A(e,u,this.typeSupported.mpeg===true||this.typeSupported.mp3===true,this.sampleAes!=null);v=I.avc;if(v>0){h.pid=v}m=I.audio;if(m>0){p.pid=m;p.isAAC=I.isAAC}y=I.id3;if(y>0){g.pid=y}if(d&&!c){x.logger.log("reparse from beginning");d=false;a=k-188}c=this.pmtParsed=true;break;case 17:case 8191:break;default:d=true;break}}else{this.observer.trigger(C.default.ERROR,{type:F.ErrorTypes.MEDIA_ERROR,details:F.ErrorDetails.FRAG_PARSING_ERROR,fatal:false,reason:"TS packet did not start with 0x47"})}}if(_&&(f=R(_))&&f.pts!==undefined){D(f,true);h.pesData=null}else{h.pesData=_}if(T&&(f=R(T))&&f.pts!==undefined){if(p.isAAC){L(f)}else{w(f)}p.pesData=null}else{if(T&&T.size){x.logger.log("last AAC PES packet truncated,might overlap between fragments")}p.pesData=T}if(S&&(f=R(S))&&f.pts!==undefined){O(f);g.pesData=null}else{g.pesData=S}if(this.sampleAes==null){this.remuxer.remux(p,h,g,this._txtTrack,t,r,i)}else{this.decryptAndRemux(p,h,g,this._txtTrack,t,r,i)}};P.prototype.decryptAndRemux=function(e,t,r,i,a,n,s){if(e.samples&&e.isAAC){var o=this;this.sampleAes.decryptAacSamples(e.samples,0,function(){o.decryptAndRemuxAvc(e,t,r,i,a,n,s)})}else{this.decryptAndRemuxAvc(e,t,r,i,a,n,s)}};P.prototype.decryptAndRemuxAvc=function(e,t,r,i,a,n,s){if(t.samples){var o=this;this.sampleAes.decryptAvcSamples(t.samples,0,0,function(){o.remuxer.remux(e,t,r,i,a,n,s)})}else{this.remuxer.remux(e,t,r,i,a,n,s)}};P.prototype.destroy=function(){this._initPTS=this._initDTS=undefined;this._duration=0};P.prototype._parsePAT=function(e,t){return(e[t+10]&31)<<8|e[t+11]};P.prototype._parsePMT=function(e,t,r,i){var a,n,s,o,l={audio:-1,avc:-1,id3:-1,isAAC:true};a=(e[t+1]&15)<<8|e[t+2];n=t+3+a-4;s=(e[t+10]&15)<<8|e[t+11];t+=12+s;while(t<n){o=(e[t+1]&31)<<8|e[t+2];switch(e[t]){case 207:if(!i){x.logger.log("unkown stream type:"+e[t]);break}case 15:if(l.audio===-1){l.audio=o}break;case 21:if(l.id3===-1){l.id3=o}break;case 219:if(!i){x.logger.log("unkown stream type:"+e[t]);break}case 27:if(l.avc===-1){l.avc=o}break;case 3:case 4:if(!r){x.logger.log("MPEG audio found, not supported in this browser for now")}else if(l.audio===-1){l.audio=o;l.isAAC=false}break;case 36:x.logger.warn("HEVC stream type found, not supported for now");break;default:x.logger.log("unkown stream type:"+e[t]);break}t+=((e[t+3]&15)<<8|e[t+4])+5}return l};P.prototype._parsePES=function(e){var t=0,r,i,a,n,s,o,l,u,f,d=e.data;if(!e||e.size===0){return null}while(d[0].length<19&&d.length>1){var c=new Uint8Array(d[0].length+d[1].length);c.set(d[0]);c.set(d[1],d[0].length);d[0]=c;d.splice(1,1)}r=d[0];a=(r[0]<<16)+(r[1]<<8)+r[2];if(a===1){n=(r[4]<<8)+r[5];if(n&&n>e.size-6){return null}i=r[7];if(i&192){l=(r[9]&14)*536870912+(r[10]&255)*4194304+(r[11]&254)*16384+(r[12]&255)*128+(r[13]&254)/2;if(l>4294967295){l-=8589934592}if(i&64){u=(r[14]&14)*536870912+(r[15]&255)*4194304+(r[16]&254)*16384+(r[17]&255)*128+(r[18]&254)/2;if(u>4294967295){u-=8589934592}if(l-u>60*9e4){x.logger.warn(Math.round((l-u)/9e4)+"s delta between PTS and DTS, align them");l=u}}else{u=l}}s=r[8];f=s+9;e.size-=f;o=new Uint8Array(e.size);for(var h=0,p=d.length;h<p;h++){r=d[h];var g=r.byteLength;if(f){if(f>g){f-=g;continue}else{r=r.subarray(f);g-=f;f=0}}o.set(r,t);t+=g}if(n){n-=s+3}return{data:o,pts:l,dts:u,len:n}}else{return null}};P.prototype.pushAccesUnit=function(e,t){if(e.units.length&&e.frame){var r=t.samples;var i=r.length;if(!this.config.forceKeyFrameOnDiscontinuity||e.key===true||t.sps&&(i||this.contiguous)){e.id=i;r.push(e)}else{t.dropped++}}if(e.debug.length){x.logger.log(e.pts+"/"+e.dts+":"+e.debug)}};P.prototype._parseAVCPES=function(_,e){var T=this;var S=this._avcTrack,t=this._parseAVCNALu(_.data),b=false,A,R=this.avcSample,D,L=false,w,O=this.pushAccesUnit.bind(this),k=function(e,t,r,i){return{key:e,pts:t,dts:r,units:[],debug:i}};_.data=null;if(R&&t.length&&!S.audFound){O(R,S);R=this.avcSample=k(false,_.pts,_.dts,"")}t.forEach(function(e){switch(e.type){case 1:D=true;if(!R){R=T.avcSample=k(true,_.pts,_.dts,"")}if(b){R.debug+="NDR "}R.frame=true;var t=e.data;if(L&&t.length>4){var r=new I.default(t).readSliceType();if(r===2||r===4||r===7||r===9){R.key=true}}break;case 5:D=true;if(!R){R=T.avcSample=k(true,_.pts,_.dts,"")}if(b){R.debug+="IDR "}R.key=true;R.frame=true;break;case 6:D=true;if(b&&R){R.debug+="SEI "}A=new I.default(T.discardEPB(e.data));A.readUByte();var i=0;var a=0;var n=false;var s=0;while(!n&&A.bytesAvailable>1){i=0;do{s=A.readUByte();i+=s}while(s===255);a=0;do{s=A.readUByte();a+=s}while(s===255);if(i===4&&A.bytesAvailable!==0){n=true;var o=A.readUByte();if(o===181){var l=A.readUShort();if(l===49){var u=A.readUInt();if(u===1195456820){var f=A.readUByte();if(f===3){var d=A.readUByte();var c=A.readUByte();var h=31&d;var p=[d,c];for(w=0;w<h;w++){p.push(A.readUByte());p.push(A.readUByte());p.push(A.readUByte())}T._insertSampleInOrder(T._txtTrack.samples,{type:3,pts:_.pts,bytes:p})}}}}}else if(a<A.bytesAvailable){for(w=0;w<a;w++){A.readUByte()}}}break;case 7:D=true;L=true;if(b&&R){R.debug+="SPS "}if(!S.sps){A=new I.default(e.data);var g=A.readSPS();S.width=g.width;S.height=g.height;S.pixelRatio=g.pixelRatio;S.sps=[e.data];S.duration=T._duration;var v=e.data.subarray(1,4);var m="avc1.";for(w=0;w<3;w++){var y=v[w].toString(16);if(y.length<2){y="0"+y}m+=y}S.codec=m}break;case 8:D=true;if(b&&R){R.debug+="PPS "}if(!S.pps){S.pps=[e.data]}break;case 9:D=false;S.audFound=true;if(R){O(R,S)}R=T.avcSample=k(false,_.pts,_.dts,b?"AUD ":"");break;case 12:D=false;break;default:D=false;if(R){R.debug+="unknown NAL "+e.type+" "}break}if(R&&D){var E=R.units;E.push(e)}});if(e&&R){O(R,S);this.avcSample=null}};P.prototype._insertSampleInOrder=function(e,t){var r=e.length;if(r>0){if(t.pts>=e[r-1].pts){e.push(t)}else{for(var i=r-1;i>=0;i--){if(t.pts<e[i].pts){e.splice(i,0,t);break}}}}else{e.push(t)}};P.prototype._getLastNalUnit=function(){var e=this.avcSample,t;if(!e||e.units.length===0){var r=this._avcTrack,i=r.samples;e=i[i.length-1]}if(e){var a=e.units;t=a[a.length-1]}return t};P.prototype._parseAVCNALu=function(e){var t=0,r=e.byteLength,i,a,n=this._avcTrack,s=n.naluState||0,o=s;var l=[],u,f,d=-1,c;if(s===-1){d=0;c=e[0]&31;s=0;t=1}while(t<r){i=e[t++];if(!s){s=i?0:1;continue}if(s===1){s=i?0:2;continue}if(!i){s=3}else if(i===1){if(d>=0){u={data:e.subarray(d,t-s-1),type:c};l.push(u)}else{var h=this._getLastNalUnit();if(h){if(o&&t<=4-o){if(h.state){h.data=h.data.subarray(0,h.data.byteLength-o)}}a=t-s-1;if(a>0){var p=new Uint8Array(h.data.byteLength+a);p.set(h.data,0);p.set(e.subarray(0,a),h.data.byteLength);h.data=p}}}if(t<r){f=e[t]&31;d=t;c=f;s=0}else{s=-1}}else{s=0}}if(d>=0&&s>=0){u={data:e.subarray(d,r),type:c,state:s};l.push(u)}if(l.length===0){var h=this._getLastNalUnit();if(h){var p=new Uint8Array(h.data.byteLength+e.byteLength);p.set(h.data,0);p.set(e,h.data.byteLength);h.data=p}}n.naluState=s;return l};P.prototype.discardEPB=function(e){var t=e.byteLength,r=[],i=1,a,n;while(i<t-2){if(e[i]===0&&e[i+1]===0&&e[i+2]===3){r.push(i+2);i+=2}else{i++}}if(r.length===0){return e}a=t-r.length;n=new Uint8Array(a);var s=0;for(i=0;i<a;s++,i++){if(s===r[0]){s++;r.shift()}n[i]=e[s]}return n};P.prototype._parseAACPES=function(e){var t=this._audioTrack,r=e.data,i=e.pts,a=0,n=this.aacOverFlow,s=this.aacLastPTS,o,l,u,f,d;if(n){var c=new Uint8Array(n.byteLength+r.byteLength);c.set(n,0);c.set(r,n.byteLength);r=c}for(u=a,d=r.length;u<d-1;u++){if(m.isHeader(r,u)){break}}if(u){var h=void 0,p=void 0;if(u<d-1){h="AAC PES did not start with ADTS header,offset:"+u;p=false}else{h="no ADTS header found in AAC PES";p=true}x.logger.warn("parsing error:"+h);this.observer.trigger(C.default.ERROR,{type:F.ErrorTypes.MEDIA_ERROR,details:F.ErrorDetails.FRAG_PARSING_ERROR,fatal:p,reason:h});if(p){return}}m.initTrackConfig(t,this.observer,r,u,this.audioCodec);l=0;o=m.getFrameDuration(t.samplerate);if(n&&s){var g=s+o;if(Math.abs(g-i)>1){x.logger.log("AAC: align PTS for overlapping frames by "+Math.round((g-i)/90));i=g}}while(u<d){if(m.isHeader(r,u)&&u+5<d){var v=m.appendFrame(t,r,u,i,l);if(v){u+=v.length;f=v.sample.pts;l++}else{break}}else{u++}}if(u<d){n=r.subarray(u,d)}else{n=null}this.aacOverFlow=n;this.aacLastPTS=f};P.prototype._parseMPEGPES=function(e){var t=e.data;var r=t.length;var i=0;var a=0;var n=e.pts;while(a<r){if(o.default.isHeader(t,a)){var s=o.default.appendFrame(this._audioTrack,t,a,n,i);if(s){a+=s.length;i++}else{break}}else{a++}}};P.prototype._parseID3PES=function(e){this._id3Track.samples.push(e)};return P}();t.default=n},"./src/errors.js":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.ErrorTypes={NETWORK_ERROR:"networkError",MEDIA_ERROR:"mediaError",KEY_SYSTEM_ERROR:"keySystemError",MUX_ERROR:"muxError",OTHER_ERROR:"otherError"};t.ErrorDetails={KEY_SYSTEM_NO_KEYS:"keySystemNoKeys",KEY_SYSTEM_NO_ACCESS:"keySystemNoAccess",KEY_SYSTEM_NO_SESSION:"keySystemNoSession",KEY_SYSTEM_LICENSE_REQUEST_FAILED:"keySystemLicenseRequestFailed",MANIFEST_LOAD_ERROR:"manifestLoadError",MANIFEST_LOAD_TIMEOUT:"manifestLoadTimeOut",MANIFEST_PARSING_ERROR:"manifestParsingError",MANIFEST_INCOMPATIBLE_CODECS_ERROR:"manifestIncompatibleCodecsError",LEVEL_LOAD_ERROR:"levelLoadError",LEVEL_LOAD_TIMEOUT:"levelLoadTimeOut",LEVEL_SWITCH_ERROR:"levelSwitchError",AUDIO_TRACK_LOAD_ERROR:"audioTrackLoadError",AUDIO_TRACK_LOAD_TIMEOUT:"audioTrackLoadTimeOut",FRAG_LOAD_ERROR:"fragLoadError",FRAG_LOAD_TIMEOUT:"fragLoadTimeOut",FRAG_DECRYPT_ERROR:"fragDecryptError",FRAG_PARSING_ERROR:"fragParsingError",REMUX_ALLOC_ERROR:"remuxAllocError",KEY_LOAD_ERROR:"keyLoadError",KEY_LOAD_TIMEOUT:"keyLoadTimeOut",BUFFER_ADD_CODEC_ERROR:"bufferAddCodecError",BUFFER_APPEND_ERROR:"bufferAppendError",BUFFER_APPENDING_ERROR:"bufferAppendingError",BUFFER_STALLED_ERROR:"bufferStalledError",BUFFER_FULL_ERROR:"bufferFullError",BUFFER_SEEK_OVER_HOLE:"bufferSeekOverHole",BUFFER_NUDGE_ON_STALL:"bufferNudgeOnStall",INTERNAL_EXCEPTION:"internalException"}},"./src/event-handler.js":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});var i=r("./src/utils/logger.js");var a=r("./src/errors.js");var n=r("./src/events.js");var s={hlsEventGeneric:true,hlsHandlerDestroying:true,hlsHandlerDestroyed:true};var o=function(){function e(e){var t=[];for(var r=1;r<arguments.length;r++){t[r-1]=arguments[r]}this.hls=e;this.onEvent=this.onEvent.bind(this);this.handledEvents=t;this.useGenericHandler=true;this.registerListeners()}e.prototype.destroy=function(){this.onHandlerDestroying();this.unregisterListeners();this.onHandlerDestroyed()};e.prototype.onHandlerDestroying=function(){};e.prototype.onHandlerDestroyed=function(){};e.prototype.isEventHandler=function(){return typeof this.handledEvents==="object"&&this.handledEvents.length&&typeof this.onEvent==="function"};e.prototype.registerListeners=function(){if(this.isEventHandler()){this.handledEvents.forEach(function(e){if(s[e]){throw new Error("Forbidden event-name: "+e)}this.hls.on(e,this.onEvent)},this)}};e.prototype.unregisterListeners=function(){if(this.isEventHandler()){this.handledEvents.forEach(function(e){this.hls.off(e,this.onEvent)},this)}};e.prototype.onEvent=function(e,t){this.onEventGeneric(e,t)};e.prototype.onEventGeneric=function(t,e){var r=function(e,t){var r="on"+e.replace("hls","");if(typeof this[r]!=="function"){throw new Error("Event "+e+" has no generic handler in this "+this.constructor.name+" class (tried "+r+")")}return this[r].bind(this,t)};try{r.call(this,t,e).call()}catch(e){i.logger.error("An internal error happened while handling event "+t+'. Error message: "'+e.message+'". Here is a stacktrace:',e);this.hls.trigger(n.default.ERROR,{type:a.ErrorTypes.OTHER_ERROR,details:a.ErrorDetails.INTERNAL_EXCEPTION,fatal:false,event:t,err:e})}};return e}();t.default=o},"./src/events.js":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});var i={MEDIA_ATTACHING:"hlsMediaAttaching",MEDIA_ATTACHED:"hlsMediaAttached",MEDIA_DETACHING:"hlsMediaDetaching",MEDIA_DETACHED:"hlsMediaDetached",BUFFER_RESET:"hlsBufferReset",BUFFER_CODECS:"hlsBufferCodecs",BUFFER_CREATED:"hlsBufferCreated",BUFFER_APPENDING:"hlsBufferAppending",BUFFER_APPENDED:"hlsBufferAppended",BUFFER_EOS:"hlsBufferEos",BUFFER_FLUSHING:"hlsBufferFlushing",BUFFER_FLUSHED:"hlsBufferFlushed",MANIFEST_LOADING:"hlsManifestLoading",MANIFEST_LOADED:"hlsManifestLoaded",MANIFEST_PARSED:"hlsManifestParsed",LEVEL_SWITCHING:"hlsLevelSwitching",LEVEL_SWITCHED:"hlsLevelSwitched",LEVEL_LOADING:"hlsLevelLoading",LEVEL_LOADED:"hlsLevelLoaded",LEVEL_UPDATED:"hlsLevelUpdated",LEVEL_PTS_UPDATED:"hlsLevelPtsUpdated",AUDIO_TRACKS_UPDATED:"hlsAudioTracksUpdated",AUDIO_TRACK_SWITCHING:"hlsAudioTrackSwitching",AUDIO_TRACK_SWITCHED:"hlsAudioTrackSwitched",AUDIO_TRACK_LOADING:"hlsAudioTrackLoading",AUDIO_TRACK_LOADED:"hlsAudioTrackLoaded",SUBTITLE_TRACKS_UPDATED:"hlsSubtitleTracksUpdated",SUBTITLE_TRACK_SWITCH:"hlsSubtitleTrackSwitch",SUBTITLE_TRACK_LOADING:"hlsSubtitleTrackLoading",SUBTITLE_TRACK_LOADED:"hlsSubtitleTrackLoaded",SUBTITLE_FRAG_PROCESSED:"hlsSubtitleFragProcessed",INIT_PTS_FOUND:"hlsInitPtsFound",FRAG_LOADING:"hlsFragLoading",FRAG_LOAD_PROGRESS:"hlsFragLoadProgress",FRAG_LOAD_EMERGENCY_ABORTED:"hlsFragLoadEmergencyAborted",FRAG_LOADED:"hlsFragLoaded",FRAG_DECRYPTED:"hlsFragDecrypted",FRAG_PARSING_INIT_SEGMENT:"hlsFragParsingInitSegment",FRAG_PARSING_USERDATA:"hlsFragParsingUserdata",FRAG_PARSING_METADATA:"hlsFragParsingMetadata",FRAG_PARSING_DATA:"hlsFragParsingData",FRAG_PARSED:"hlsFragParsed",FRAG_BUFFERED:"hlsFragBuffered",FRAG_CHANGED:"hlsFragChanged",FPS_DROP:"hlsFpsDrop",FPS_DROP_LEVEL_CAPPING:"hlsFpsDropLevelCapping",ERROR:"hlsError",DESTROYING:"hlsDestroying",KEY_LOADING:"hlsKeyLoading",KEY_LOADED:"hlsKeyLoaded",STREAM_STATE_TRANSITION:"hlsStreamStateTransition"};t.default=i},"./src/hls.js":function(e,t,r){"use strict";var i=this&&this.__extends||function(){var i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r]};return function(e,t){i(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:true});var a=r("./node_modules/url-toolkit/src/url-toolkit.js");var n=r("./src/errors.js");var b=r("./src/loader/playlist-loader.js");var A=r("./src/loader/fragment-loader.js");var R=r("./src/loader/key-loader.js");var D=r("./src/controller/fragment-tracker.js");var L=r("./src/controller/stream-controller.js");var w=r("./src/controller/level-controller.js");var O=r("./src/controller/id3-track-controller.js");var s=r("./src/is-supported.js");var k=r("./src/utils/logger.js");var o=r("./src/config.js");var l=r("./src/events.js");var u=r("./src/observer.js");var f=function(T){i(S,T);function S(e){if(e===void 0){e={}}var t=T.call(this)||this;var r=S.DefaultConfig;if((e.liveSyncDurationCount||e.liveMaxLatencyDurationCount)&&(e.liveSyncDuration||e.liveMaxLatencyDuration)){throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration")}for(var i in r){if(i in e)continue;e[i]=r[i]}if(e.liveMaxLatencyDurationCount!==undefined&&e.liveMaxLatencyDurationCount<=e.liveSyncDurationCount){throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be gt "liveSyncDurationCount"')}if(e.liveMaxLatencyDuration!==undefined&&(e.liveMaxLatencyDuration<=e.liveSyncDuration||e.liveSyncDuration===undefined)){throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be gt "liveSyncDuration"')}k.enableLogs(e.debug);t.config=e;t._autoLevelCapping=-1;var a=t.abrController=new e.abrController(t);var n=new e.bufferController(t);var s=new e.capLevelController(t);var o=new e.fpsController(t);var l=new b.default(t);var u=new A.default(t);var f=new R.default(t);var d=new O.default(t);var c=t.levelController=new w.default(t);var h=new D.FragmentTracker(t);var p=t.streamController=new L.default(t,h);var g=[c,p];var v=e.audioStreamController;if(v){g.push(new v(t,h))}t.networkControllers=g;var m=[l,u,f,a,n,s,o,d,h];v=e.audioTrackController;if(v){var y=new v(t);t.audioTrackController=y;m.push(y)}v=e.subtitleTrackController;if(v){var E=new v(t);t.subtitleTrackController=E;g.push(E)}v=e.emeController;if(v){var _=new v(t);t.emeController=_;m.push(_)}v=e.subtitleStreamController;if(v){g.push(new v(t,h))}v=e.timelineController;if(v){m.push(new v(t))}t.coreComponents=m;return t}Object.defineProperty(S,"version",{get:function(){return"0.12.4"},enumerable:true,configurable:true});S.isSupported=function(){return s.isSupported()};Object.defineProperty(S,"Events",{get:function(){return l.default},enumerable:true,configurable:true});Object.defineProperty(S,"ErrorTypes",{get:function(){return n.ErrorTypes},enumerable:true,configurable:true});Object.defineProperty(S,"ErrorDetails",{get:function(){return n.ErrorDetails},enumerable:true,configurable:true});Object.defineProperty(S,"DefaultConfig",{get:function(){if(!S.defaultConfig){return o.hlsDefaultConfig}return S.defaultConfig},set:function(e){S.defaultConfig=e},enumerable:true,configurable:true});S.prototype.destroy=function(){k.logger.log("destroy");this.trigger(l.default.DESTROYING);this.detachMedia();this.coreComponents.concat(this.networkControllers).forEach(function(e){e.destroy()});this.url=null;this.removeAllListeners();this._autoLevelCapping=-1};S.prototype.attachMedia=function(e){k.logger.log("attachMedia");this.media=e;this.trigger(l.default.MEDIA_ATTACHING,{media:e})};S.prototype.detachMedia=function(){k.logger.log("detachMedia");this.trigger(l.default.MEDIA_DETACHING);this.media=null};S.prototype.loadSource=function(e){e=a.buildAbsoluteURL(window.location.href,e,{alwaysNormalize:true});k.logger.log("loadSource:"+e);this.url=e;this.trigger(l.default.MANIFEST_LOADING,{url:e})};S.prototype.startLoad=function(t){if(t===void 0){t=-1}k.logger.log("startLoad("+t+")");this.networkControllers.forEach(function(e){e.startLoad(t)})};S.prototype.stopLoad=function(){k.logger.log("stopLoad");this.networkControllers.forEach(function(e){e.stopLoad()})};S.prototype.swapAudioCodec=function(){k.logger.log("swapAudioCodec");this.streamController.swapAudioCodec()};S.prototype.recoverMediaError=function(){k.logger.log("recoverMediaError");var e=this.media;this.detachMedia();this.attachMedia(e)};Object.defineProperty(S.prototype,"levels",{get:function(){return this.levelController.levels},enumerable:true,configurable:true});Object.defineProperty(S.prototype,"currentLevel",{get:function(){return this.streamController.currentLevel},set:function(e){k.logger.log("set currentLevel:"+e);this.loadLevel=e;this.streamController.immediateLevelSwitch()},enumerable:true,configurable:true});Object.defineProperty(S.prototype,"nextLevel",{get:function(){return this.streamController.nextLevel},set:function(e){k.logger.log("set nextLevel:"+e);this.levelController.manualLevel=e;this.streamController.nextLevelSwitch()},enumerable:true,configurable:true});Object.defineProperty(S.prototype,"loadLevel",{get:function(){return this.levelController.level},set:function(e){k.logger.log("set loadLevel:"+e);this.levelController.manualLevel=e},enumerable:true,configurable:true});Object.defineProperty(S.prototype,"nextLoadLevel",{get:function(){return this.levelController.nextLoadLevel},set:function(e){this.levelController.nextLoadLevel=e},enumerable:true,configurable:true});Object.defineProperty(S.prototype,"firstLevel",{get:function(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)},set:function(e){k.logger.log("set firstLevel:"+e);this.levelController.firstLevel=e},enumerable:true,configurable:true});Object.defineProperty(S.prototype,"startLevel",{get:function(){return this.levelController.startLevel},set:function(e){k.logger.log("set startLevel:"+e);var t=this;if(e!==-1){e=Math.max(e,t.minAutoLevel)}t.levelController.startLevel=e},enumerable:true,configurable:true});Object.defineProperty(S.prototype,"autoLevelCapping",{get:function(){return this._autoLevelCapping},set:function(e){k.logger.log("set autoLevelCapping:"+e);this._autoLevelCapping=e},enumerable:true,configurable:true});Object.defineProperty(S.prototype,"autoLevelEnabled",{get:function(){return this.levelController.manualLevel===-1},enumerable:true,configurable:true});Object.defineProperty(S.prototype,"manualLevel",{get:function(){return this.levelController.manualLevel},enumerable:true,configurable:true});Object.defineProperty(S.prototype,"minAutoLevel",{get:function(){var e=this,t=e.levels,r=e.config.minAutoBitrate,i=t?t.length:0;for(var a=0;a<i;a++){var n=t[a].realBitrate?Math.max(t[a].realBitrate,t[a].bitrate):t[a].bitrate;if(n>r){return a}}return 0},enumerable:true,configurable:true});Object.defineProperty(S.prototype,"maxAutoLevel",{get:function(){var e=this;var t=e.levels;var r=e.autoLevelCapping;var i;if(r===-1&&t&&t.length){i=t.length-1}else{i=r}return i},enumerable:true,configurable:true});Object.defineProperty(S.prototype,"nextAutoLevel",{get:function(){var e=this;return Math.min(Math.max(e.abrController.nextAutoLevel,e.minAutoLevel),e.maxAutoLevel)},set:function(e){var t=this;t.abrController.nextAutoLevel=Math.max(t.minAutoLevel,e)},enumerable:true,configurable:true});Object.defineProperty(S.prototype,"audioTracks",{get:function(){var e=this.audioTrackController;return e?e.audioTracks:[]},enumerable:true,configurable:true});Object.defineProperty(S.prototype,"audioTrack",{get:function(){var e=this.audioTrackController;return e?e.audioTrack:-1},set:function(e){var t=this.audioTrackController;if(t){t.audioTrack=e}},enumerable:true,configurable:true});Object.defineProperty(S.prototype,"liveSyncPosition",{get:function(){return this.streamController.liveSyncPosition},enumerable:true,configurable:true});Object.defineProperty(S.prototype,"subtitleTracks",{get:function(){var e=this.subtitleTrackController;return e?e.subtitleTracks:[]},enumerable:true,configurable:true});Object.defineProperty(S.prototype,"subtitleTrack",{get:function(){var e=this.subtitleTrackController;return e?e.subtitleTrack:-1},set:function(e){var t=this.subtitleTrackController;if(t){t.subtitleTrack=e}},enumerable:true,configurable:true});Object.defineProperty(S.prototype,"subtitleDisplay",{get:function(){var e=this.subtitleTrackController;return e?e.subtitleDisplay:false},set:function(e){var t=this.subtitleTrackController;if(t){t.subtitleDisplay=e}},enumerable:true,configurable:true});return S}(u.Observer);t.default=f},"./src/is-supported.js":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});var a=r("./src/utils/mediasource-helper.js");function i(){var e=a.getMediaSource();var t=window.SourceBuffer||window.WebKitSourceBuffer;var r=e&&typeof e.isTypeSupported==="function"&&e.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"');var i=!t||t.prototype&&typeof t.prototype.appendBuffer==="function"&&typeof t.prototype.remove==="function";return!!r&&!!i}t.isSupported=i},"./src/loader/fragment-loader.js":function(e,i,a){"use strict";(function(h){var t=this&&this.__extends||function(){var i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r]};return function(e,t){i(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}();Object.defineProperty(i,"__esModule",{value:true});var s=a("./src/events.js");var e=a("./src/event-handler.js");var n=a("./src/errors.js");var p=a("./src/utils/logger.js");var r=function(i){t(e,i);function e(e){var t=i.call(this,e,s.default.FRAG_LOADING)||this;t.loaders={};return t}e.prototype.destroy=function(){var e=this.loaders;for(var t in e){var r=e[t];if(r){r.destroy()}}this.loaders={};i.prototype.destroy.call(this)};e.prototype.onFragLoading=function(e){var t=e.frag,r=t.type,i=this.loaders,a=this.hls.config,n=a.fLoader,s=a.loader;t.loaded=0;var o=i[r];if(o){p.logger.warn("abort previous fragment loader for type: "+r);o.abort()}o=i[r]=t.loader=a.fLoader?new n(a):new s(a);var l,u,f;l={url:t.url,frag:t,responseType:"arraybuffer",progressData:false};var d=t.byteRangeStartOffset,c=t.byteRangeEndOffset;if(h.isFinite(d)&&h.isFinite(c)){l.rangeStart=d;l.rangeEnd=c}u={timeout:a.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:a.fragLoadingMaxRetryTimeout};f={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this),onProgress:this.loadprogress.bind(this)};o.load(l,u,f)};e.prototype.loadsuccess=function(e,t,r,i){if(i===void 0){i=null}var a=e.data,n=r.frag;n.loader=undefined;this.loaders[n.type]=undefined;this.hls.trigger(s.default.FRAG_LOADED,{payload:a,frag:n,stats:t,networkDetails:i})};e.prototype.loaderror=function(e,t,r){if(r===void 0){r=null}var i=t.frag;var a=i.loader;if(a){a.abort()}this.loaders[i.type]=undefined;this.hls.trigger(s.default.ERROR,{type:n.ErrorTypes.NETWORK_ERROR,details:n.ErrorDetails.FRAG_LOAD_ERROR,fatal:false,frag:t.frag,response:e,networkDetails:r})};e.prototype.loadtimeout=function(e,t,r){if(r===void 0){r=null}var i=t.frag;var a=i.loader;if(a){a.abort()}this.loaders[i.type]=undefined;this.hls.trigger(s.default.ERROR,{type:n.ErrorTypes.NETWORK_ERROR,details:n.ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:false,frag:t.frag,networkDetails:r})};e.prototype.loadprogress=function(e,t,r,i){if(i===void 0){i=null}var a=t.frag;a.loaded=e.loaded;this.hls.trigger(s.default.FRAG_LOAD_PROGRESS,{frag:a,stats:e,networkDetails:i})};return e}(e.default);i.default=r}).call(this,a("./src/polyfills/number.js")["Number"])},"./src/loader/fragment.js":function(e,a,n){"use strict";(function(r){Object.defineProperty(a,"__esModule",{value:true});var e=n("./node_modules/url-toolkit/src/url-toolkit.js");var i=n("./src/loader/level-key.js");var t=function(){function t(){var e;this._url=null;this._byteRange=null;this._decryptdata=null;this.tagList=[];this.programDateTime=null;this.rawProgramDateTime=null;this._elementaryStreams=(e={},e[t.ElementaryStreamTypes.AUDIO]=false,e[t.ElementaryStreamTypes.VIDEO]=false,e)}Object.defineProperty(t,"ElementaryStreamTypes",{get:function(){return{AUDIO:"audio",VIDEO:"video"}},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"url",{get:function(){if(!this._url&&this.relurl){this._url=e.buildAbsoluteURL(this.baseurl,this.relurl,{alwaysNormalize:true})}return this._url},set:function(e){this._url=e},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"byteRange",{get:function(){if(!this._byteRange&&!this.rawByteRange){return[]}if(this._byteRange){return this._byteRange}var e=[];if(this.rawByteRange){var t=this.rawByteRange.split("@",2);if(t.length===1){var r=this.lastByteRangeEndOffset;e[0]=r||0}else{e[0]=parseInt(t[1])}e[1]=parseInt(t[0])+e[0];this._byteRange=e}return e},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"byteRangeStartOffset",{get:function(){return this.byteRange[0]},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"byteRangeEndOffset",{get:function(){return this.byteRange[1]},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"decryptdata",{get:function(){if(!this._decryptdata){this._decryptdata=this.fragmentDecryptdataFromLevelkey(this.levelkey,this.sn)}return this._decryptdata},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"endProgramDateTime",{get:function(){if(!r.isFinite(this.programDateTime)){return null}var e=!r.isFinite(this.duration)?0:this.duration;return this.programDateTime+e*1e3},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"encrypted",{get:function(){return!!(this.decryptdata&&this.decryptdata.uri!==null&&this.decryptdata.key===null)},enumerable:true,configurable:true});t.prototype.addElementaryStream=function(e){this._elementaryStreams[e]=true};t.prototype.hasElementaryStream=function(e){return this._elementaryStreams[e]===true};t.prototype.createInitializationVector=function(e){var t=new Uint8Array(16);for(var r=12;r<16;r++){t[r]=e>>8*(15-r)&255}return t};t.prototype.fragmentDecryptdataFromLevelkey=function(e,t){var r=e;if(e&&e.method&&e.uri&&!e.iv){r=new i.default;r.method=e.method;r.baseuri=e.baseuri;r.reluri=e.reluri;r.iv=this.createInitializationVector(t)}return r};return t}();a.default=t}).call(this,n("./src/polyfills/number.js")["Number"])},"./src/loader/key-loader.js":function(e,t,r){"use strict";var i=this&&this.__extends||function(){var i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r]};return function(e,t){i(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:true});var f=r("./src/events.js");var a=r("./src/event-handler.js");var n=r("./src/errors.js");var d=r("./src/utils/logger.js");var s=function(r){i(e,r);function e(e){var t=r.call(this,e,f.default.KEY_LOADING)||this;t.loaders={};t.decryptkey=null;t.decrypturl=null;return t}e.prototype.destroy=function(){for(var e in this.loaders){var t=this.loaders[e];if(t){t.destroy()}}this.loaders={};a.default.prototype.destroy.call(this)};e.prototype.onKeyLoading=function(e){var t=e.frag,r=t.type,i=this.loaders[r],a=t.decryptdata,n=a.uri;if(n!==this.decrypturl||this.decryptkey===null){var s=this.hls.config;if(i){d.logger.warn("abort previous key loader for type:"+r);i.abort()}t.loader=this.loaders[r]=new s.loader(s);this.decrypturl=n;this.decryptkey=null;var o=void 0,l=void 0,u=void 0;o={url:n,frag:t,responseType:"arraybuffer"};l={timeout:s.fragLoadingTimeOut,maxRetry:0,retryDelay:s.fragLoadingRetryDelay,maxRetryDelay:s.fragLoadingMaxRetryTimeout};u={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)};t.loader.load(o,l,u)}else if(this.decryptkey){a.key=this.decryptkey;this.hls.trigger(f.default.KEY_LOADED,{frag:t})}};e.prototype.loadsuccess=function(e,t,r){var i=r.frag;this.decryptkey=i.decryptdata.key=new Uint8Array(e.data);i.loader=undefined;this.loaders[i.type]=undefined;this.hls.trigger(f.default.KEY_LOADED,{frag:i})};e.prototype.loaderror=function(e,t){var r=t.frag,i=r.loader;if(i){i.abort()}this.loaders[t.type]=undefined;this.hls.trigger(f.default.ERROR,{type:n.ErrorTypes.NETWORK_ERROR,details:n.ErrorDetails.KEY_LOAD_ERROR,fatal:false,frag:r,response:e})};e.prototype.loadtimeout=function(e,t){var r=t.frag,i=r.loader;if(i){i.abort()}this.loaders[t.type]=undefined;this.hls.trigger(f.default.ERROR,{type:n.ErrorTypes.NETWORK_ERROR,details:n.ErrorDetails.KEY_LOAD_TIMEOUT,fatal:false,frag:r})};return e}(a.default);t.default=s},"./src/loader/level-key.js":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});var i=r("./node_modules/url-toolkit/src/url-toolkit.js");var a=function(){function e(){this.method=null;this.key=null;this.iv=null;this._uri=null}Object.defineProperty(e.prototype,"uri",{get:function(){if(!this._uri&&this.reluri){this._uri=i.buildAbsoluteURL(this.baseuri,this.reluri,{alwaysNormalize:true})}return this._uri},enumerable:true,configurable:true});return e}();t.default=a},"./src/loader/level.js":function(e,r,t){"use strict";(function(t){Object.defineProperty(r,"__esModule",{value:true});var e=function(){function e(e){this.endCC=0;this.endSN=0;this.fragments=[];this.initSegment=null;this.live=true;this.needSidxRanges=false;this.startCC=0;this.startSN=0;this.startTimeOffset=null;this.targetduration=0;this.totalduration=0;this.type=null;this.url=e;this.version=null}Object.defineProperty(e.prototype,"hasProgramDateTime",{get:function(){return!!(this.fragments[0]&&t.isFinite(this.fragments[0].programDateTime))},enumerable:true,configurable:true});return e}();r.default=e}).call(this,t("./src/polyfills/number.js")["Number"])},"./src/loader/m3u8-parser.js":function(e,t,i){"use strict";(function(k){Object.defineProperty(t,"__esModule",{value:true});var r=i("./node_modules/url-toolkit/src/url-toolkit.js");var I=i("./src/loader/fragment.js");var P=i("./src/loader/level.js");var C=i("./src/loader/level-key.js");var x=i("./src/utils/attr-list.js");var F=i("./src/utils/logger.js");var l=i("./src/utils/codecs.js");var u=/#EXT-X-STREAM-INF:([^\n\r]*)[\r\n]+([^\r\n]+)/g;var d=/#EXT-X-MEDIA:(.*)/g;var M=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/|(?!#)([\S+ ?]+)/.source,/|#EXT-X-BYTERANGE:*(.+)/.source,/|#EXT-X-PROGRAM-DATE-TIME:(.+)/.source,/|#.*/.source].join(""),"g");var N=/(?:(?:#(EXTM3U))|(?:#EXT-X-(PLAYLIST-TYPE):(.+))|(?:#EXT-X-(MEDIA-SEQUENCE): *(\d+))|(?:#EXT-X-(TARGETDURATION): *(\d+))|(?:#EXT-X-(KEY):(.+))|(?:#EXT-X-(START):(.+))|(?:#EXT-X-(ENDLIST))|(?:#EXT-X-(DISCONTINUITY-SEQ)UENCE:(\d+))|(?:#EXT-X-(DIS)CONTINUITY))|(?:#EXT-X-(VERSION):(\d+))|(?:#EXT-X-(MAP):(.+))|(?:(#)([^:]*):(.*))|(?:(#)(.*))(?:.*)\r?\n?/;var j=/\.(mp4|m4s|m4v|m4a)$/i;var e=function(){function f(){}f.findGroup=function(e,t){if(!e){return null}var r=null;for(var i=0;i<e.length;i++){var a=e[i];if(a.id===t){r=a}}return r};f.convertAVC1ToAVCOTI=function(e){var t,r=e.split(".");if(r.length>2){t=r.shift()+".";t+=parseInt(r.shift()).toString(16);t+=("000"+parseInt(r.shift()).toString(16)).substr(-4)}else{t=e}return t};f.resolve=function(e,t){return r.buildAbsoluteURL(t,e,{alwaysNormalize:true})};f.parseMasterPlaylist=function(e,t){var r=[],i;u.lastIndex=0;function a(i,a){["video","audio"].forEach(function(t){var r=i.filter(function(e){return l.isCodecType(e,t)});if(r.length){var e=r.filter(function(e){return e.lastIndexOf("avc1",0)===0||e.lastIndexOf("mp4a",0)===0});a[t+"Codec"]=e.length>0?e[0]:r[0];i=i.filter(function(e){return r.indexOf(e)===-1})}});a.unknownCodecs=i}while((i=u.exec(e))!=null){var n={};var s=n.attrs=new x.default(i[1]);n.url=f.resolve(i[2],t);var o=s.decimalResolution("RESOLUTION");if(o){n.width=o.width;n.height=o.height}n.bitrate=s.decimalInteger("AVERAGE-BANDWIDTH")||s.decimalInteger("BANDWIDTH");n.name=s.NAME;a([].concat((s.CODECS||"").split(/[ ,]+/)),n);if(n.videoCodec&&n.videoCodec.indexOf("avc1")!==-1){n.videoCodec=f.convertAVC1ToAVCOTI(n.videoCodec)}r.push(n)}return r};f.parseMasterPlaylistMedia=function(e,t,r,i){if(i===void 0){i=[]}var a;var n=[];var s=0;d.lastIndex=0;while((a=d.exec(e))!==null){var o={};var l=new x.default(a[1]);if(l.TYPE===r){o.groupId=l["GROUP-ID"];o.name=l.NAME;o.type=r;o.default=l.DEFAULT==="YES";o.autoselect=l.AUTOSELECT==="YES";o.forced=l.FORCED==="YES";if(l.URI){o.url=f.resolve(l.URI,t)}o.lang=l.LANGUAGE;if(!o.name){o.name=o.lang}if(i.length){var u=f.findGroup(i,o.groupId);o.audioCodec=u?u.codec:i[0].codec}o.id=s++;n.push(o)}}return n};f.parseLevelPlaylist=function(e,t,r,i,a){var n=0;var s=0;var o=new P.default(t);var l=new C.default;var u=0;var f=null;var d=new I.default;var c;var h;var p=null;M.lastIndex=0;while((c=M.exec(e))!==null){var g=c[1];if(g){d.duration=parseFloat(g);var v=(" "+c[2]).slice(1);d.title=v||null;d.tagList.push(v?["INF",g,v]:["INF",g])}else if(c[3]){if(k.isFinite(d.duration)){var m=n++;d.type=i;d.start=s;d.levelkey=l;d.sn=m;d.level=r;d.cc=u;d.urlId=a;d.baseurl=t;d.relurl=(" "+c[3]).slice(1);B(d,f);o.fragments.push(d);f=d;s+=d.duration;d=new I.default}}else if(c[4]){d.rawByteRange=(" "+c[4]).slice(1);if(f){var y=f.byteRangeEndOffset;if(y){d.lastByteRangeEndOffset=y}}}else if(c[5]){d.rawProgramDateTime=(" "+c[5]).slice(1);d.tagList.push(["PROGRAM-DATE-TIME",d.rawProgramDateTime]);if(p===null){p=o.fragments.length}}else{c=c[0].match(N);for(h=1;h<c.length;h++){if(c[h]!==undefined){break}}var E=(" "+c[h+1]).slice(1);var _=(" "+c[h+2]).slice(1);switch(c[h]){case"#":d.tagList.push(_?[E,_]:[E]);break;case"PLAYLIST-TYPE":o.type=E.toUpperCase();break;case"MEDIA-SEQUENCE":n=o.startSN=parseInt(E);break;case"TARGETDURATION":o.targetduration=parseFloat(E);break;case"VERSION":o.version=parseInt(E);break;case"EXTM3U":break;case"ENDLIST":o.live=false;break;case"DIS":u++;d.tagList.push(["DIS"]);break;case"DISCONTINUITY-SEQ":u=parseInt(E);break;case"KEY":var T=E;var S=new x.default(T);var b=S.enumeratedString("METHOD"),A=S.URI,R=S.hexadecimalInteger("IV");if(b){l=new C.default;if(A&&["AES-128","SAMPLE-AES","SAMPLE-AES-CENC"].indexOf(b)>=0){l.method=b;l.baseuri=t;l.reluri=A;l.key=null;l.iv=R}}break;case"START":var D=E;var L=new x.default(D);var w=L.decimalFloatingPoint("TIME-OFFSET");if(k.isFinite(w)){o.startTimeOffset=w}break;case"MAP":var O=new x.default(E);d.relurl=O.URI;d.rawByteRange=O.BYTERANGE;d.baseurl=t;d.level=r;d.type=i;d.sn="initSegment";o.initSegment=d;d=new I.default;d.rawProgramDateTime=o.initSegment.rawProgramDateTime;break;default:F.logger.warn("line parsed but not handled: "+c);break}}}d=f;if(d&&!d.relurl){o.fragments.pop();s-=d.duration}o.totalduration=s;o.averagetargetduration=s/o.fragments.length;o.endSN=n-1;o.startCC=o.fragments[0]?o.fragments[0].cc:0;o.endCC=u;if(!o.initSegment&&o.fragments.length){if(o.fragments.every(function(e){return j.test(e.relurl)})){F.logger.warn("MP4 fragments found but no init segment (probably no MAP, incomplete M3U8), trying to fetch SIDX");d=new I.default;d.relurl=o.fragments[0].relurl;d.baseurl=t;d.level=r;d.type=i;d.sn="initSegment";o.initSegment=d;o.needSidxRanges=true}}if(p){U(o.fragments,p)}return o};return f}();t.default=e;function U(e,t){var r=e[t];for(var i=t-1;i>=0;i--){var a=e[i];a.programDateTime=r.programDateTime-a.duration*1e3;r=a}}function B(e,t){if(e.rawProgramDateTime){e.programDateTime=Date.parse(e.rawProgramDateTime)}else if(t&&t.programDateTime){e.programDateTime=t.endProgramDateTime}if(!k.isFinite(e.programDateTime)){e.programDateTime=null;e.rawProgramDateTime=null}}}).call(this,i("./src/polyfills/number.js")["Number"])},"./src/loader/playlist-loader.js":function(e,a,s){"use strict";(function(v){var e=this&&this.__extends||function(){var i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r]};return function(e,t){i(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}();Object.defineProperty(a,"__esModule",{value:true});var m=s("./src/events.js");var t=s("./src/event-handler.js");var l=s("./src/errors.js");var c=s("./src/utils/logger.js");var n=s("./src/demux/mp4demuxer.js");var y=s("./src/loader/m3u8-parser.js");var E=window.performance;var _={MANIFEST:"manifest",LEVEL:"level",AUDIO_TRACK:"audioTrack",SUBTITLE_TRACK:"subtitleTrack"};var i={MAIN:"main",AUDIO:"audio",SUBTITLE:"subtitle"};var r=function(r){e(g,r);function g(e){var t=r.call(this,e,m.default.MANIFEST_LOADING,m.default.LEVEL_LOADING,m.default.AUDIO_TRACK_LOADING,m.default.SUBTITLE_TRACK_LOADING)||this;t.loaders={};return t}Object.defineProperty(g,"ContextType",{get:function(){return _},enumerable:true,configurable:true});Object.defineProperty(g,"LevelType",{get:function(){return i},enumerable:true,configurable:true});g.canHaveQualityLevels=function(e){return e!==_.AUDIO_TRACK&&e!==_.SUBTITLE_TRACK};g.mapContextToLevelType=function(e){var t=e.type;switch(t){case _.AUDIO_TRACK:return i.AUDIO;case _.SUBTITLE_TRACK:return i.SUBTITLE;default:return i.MAIN}};g.getResponseUrl=function(e,t){var r=e.url;if(r===undefined||r.indexOf("data:")===0){r=t.url}return r};g.prototype.createInternalLoader=function(e){var t=this.hls.config;var r=t.pLoader;var i=t.loader;var a=r||i;var n=new a(t);e.loader=n;this.loaders[e.type]=n;return n};g.prototype.getInternalLoader=function(e){return this.loaders[e.type]};g.prototype.resetInternalLoader=function(e){if(this.loaders[e]){delete this.loaders[e]}};g.prototype.destroyInternalLoaders=function(){for(var e in this.loaders){var t=this.loaders[e];if(t){t.destroy()}this.resetInternalLoader(e)}};g.prototype.destroy=function(){this.destroyInternalLoaders();r.prototype.destroy.call(this)};g.prototype.onManifestLoading=function(e){this.load(e.url,{type:_.MANIFEST,level:0,id:null})};g.prototype.onLevelLoading=function(e){this.load(e.url,{type:_.LEVEL,level:e.level,id:e.id})};g.prototype.onAudioTrackLoading=function(e){this.load(e.url,{type:_.AUDIO_TRACK,level:null,id:e.id})};g.prototype.onSubtitleTrackLoading=function(e){this.load(e.url,{type:_.SUBTITLE_TRACK,level:null,id:e.id})};g.prototype.load=function(e,t){var r=this.hls.config;c.logger.debug("Loading playlist of type "+t.type+", level: "+t.level+", id: "+t.id);var i=this.getInternalLoader(t);if(i){var a=i.context;if(a&&a.url===e){c.logger.trace("playlist request ongoing");return false}else{c.logger.warn("aborting previous loader for type: "+t.type);i.abort()}}var n,s,o,l;switch(t.type){case _.MANIFEST:n=r.manifestLoadingMaxRetry;s=r.manifestLoadingTimeOut;o=r.manifestLoadingRetryDelay;l=r.manifestLoadingMaxRetryTimeout;break;case _.LEVEL:n=0;s=r.levelLoadingTimeOut;break;default:n=r.levelLoadingMaxRetry;s=r.levelLoadingTimeOut;o=r.levelLoadingRetryDelay;l=r.levelLoadingMaxRetryTimeout;break}i=this.createInternalLoader(t);t.url=e;t.responseType=t.responseType||"";var u={timeout:s,maxRetry:n,retryDelay:o,maxRetryDelay:l};var f={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)};c.logger.debug("Calling internal loader delegate for URL: "+e);i.load(t,u,f);return true};g.prototype.loadsuccess=function(e,t,r,i){if(i===void 0){i=null}if(r.isSidxRequest){this._handleSidxRequest(e,r);this._handlePlaylistLoaded(e,t,r,i);return}this.resetInternalLoader(r.type);var a=e.data;t.tload=E.now();if(a.indexOf("#EXTM3U")!==0){this._handleManifestParsingError(e,r,"no EXTM3U delimiter",i);return}if(a.indexOf("#EXTINF:")>0||a.indexOf("#EXT-X-TARGETDURATION:")>0){this._handleTrackOrLevelPlaylist(e,t,r,i)}else{this._handleMasterPlaylist(e,t,r,i)}};g.prototype.loaderror=function(e,t,r){if(r===void 0){r=null}this._handleNetworkError(t,r,false,e)};g.prototype.loadtimeout=function(e,t,r){if(r===void 0){r=null}this._handleNetworkError(t,r,true)};g.prototype._handleMasterPlaylist=function(e,t,r,i){var a=this.hls;var n=e.data;var s=g.getResponseUrl(e,r);var o=y.default.parseMasterPlaylist(n,s);if(!o.length){this._handleManifestParsingError(e,r,"no level found in manifest",i);return}var l=o.map(function(e){return{id:e.attrs.AUDIO,codec:e.audioCodec}});var u=y.default.parseMasterPlaylistMedia(n,s,"AUDIO",l);var f=y.default.parseMasterPlaylistMedia(n,s,"SUBTITLES");if(u.length){var d=false;u.forEach(function(e){if(!e.url){d=true}});if(d===false&&o[0].audioCodec&&!o[0].attrs.AUDIO){c.logger.log("audio codec signaled in quality level, but no embedded audio track signaled, create one");u.unshift({type:"main",name:"main"})}}a.trigger(m.default.MANIFEST_LOADED,{levels:o,audioTracks:u,subtitles:f,url:s,stats:t,networkDetails:i})};g.prototype._handleTrackOrLevelPlaylist=function(e,t,r,i){var a=this.hls;var n=r.id,s=r.level,o=r.type;var l=g.getResponseUrl(e,r);var u=v.isFinite(n)?n:0;var f=v.isFinite(s)?s:u;var d=g.mapContextToLevelType(r);var c=y.default.parseLevelPlaylist(e.data,l,f,d,u);c.tload=t.tload;if(o===_.MANIFEST){var h={url:l,details:c};a.trigger(m.default.MANIFEST_LOADED,{levels:[h],audioTracks:[],url:l,stats:t,networkDetails:i})}t.tparsed=E.now();if(c.needSidxRanges){var p=c.initSegment.url;this.load(p,{isSidxRequest:true,type:o,level:s,levelDetails:c,id:n,rangeStart:0,rangeEnd:2048,responseType:"arraybuffer"});return}r.levelDetails=c;this._handlePlaylistLoaded(e,t,r,i)};g.prototype._handleSidxRequest=function(e,t){var r=n.default.parseSegmentIndex(new Uint8Array(e.data));if(!r){return}var i=r.references;var a=t.levelDetails;i.forEach(function(e,t){var r=e.info;var i=a.fragments[t];if(i.byteRange.length===0){i.rawByteRange=String(1+r.end-r.start)+"@"+String(r.start)}});a.initSegment.rawByteRange=String(r.moovEndOffset)+"@0"};g.prototype._handleManifestParsingError=function(e,t,r,i){this.hls.trigger(m.default.ERROR,{type:l.ErrorTypes.NETWORK_ERROR,details:l.ErrorDetails.MANIFEST_PARSING_ERROR,fatal:true,url:e.url,reason:r,networkDetails:i})};g.prototype._handleNetworkError=function(e,t,r,i){if(r===void 0){r=false}if(i===void 0){i=null}c.logger.info("A network error occured while loading a "+e.type+"-type playlist");var a;var n;var s=this.getInternalLoader(e);switch(e.type){case _.MANIFEST:a=r?l.ErrorDetails.MANIFEST_LOAD_TIMEOUT:l.ErrorDetails.MANIFEST_LOAD_ERROR;n=true;break;case _.LEVEL:a=r?l.ErrorDetails.LEVEL_LOAD_TIMEOUT:l.ErrorDetails.LEVEL_LOAD_ERROR;n=false;break;case _.AUDIO_TRACK:a=r?l.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:l.ErrorDetails.AUDIO_TRACK_LOAD_ERROR;n=false;break;default:n=false}if(s){s.abort();this.resetInternalLoader(e.type)}var o={type:l.ErrorTypes.NETWORK_ERROR,details:a,fatal:n,url:s.url,loader:s,context:e,networkDetails:t};if(i){o.response=i}this.hls.trigger(m.default.ERROR,o)};g.prototype._handlePlaylistLoaded=function(e,t,r,i){var a=r.type,n=r.level,s=r.id,o=r.levelDetails;if(!o.targetduration){this._handleManifestParsingError(e,r,"invalid target duration",i);return}var l=g.canHaveQualityLevels(r.type);if(l){this.hls.trigger(m.default.LEVEL_LOADED,{details:o,level:n||0,id:s||0,stats:t,networkDetails:i})}else{switch(a){case _.AUDIO_TRACK:this.hls.trigger(m.default.AUDIO_TRACK_LOADED,{details:o,id:s,stats:t,networkDetails:i});break;case _.SUBTITLE_TRACK:this.hls.trigger(m.default.SUBTITLE_TRACK_LOADED,{details:o,id:s,stats:t,networkDetails:i});break}}};return g}(t.default);a.default=r}).call(this,s("./src/polyfills/number.js")["Number"])},"./src/observer.js":function(e,t,r){"use strict";var i=this&&this.__extends||function(){var i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r]};return function(e,t){i(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:true});var a=r("./node_modules/eventemitter3/index.js");var n=function(e){i(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}t.prototype.trigger=function(e){var t=[];for(var r=1;r<arguments.length;r++){t[r-1]=arguments[r]}this.emit.apply(this,[e,e].concat(t))};return t}(a.EventEmitter);t.Observer=n},"./src/polyfills/number.js":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});var i=r("./src/utils/get-self-scope.js");var a=i.getSelfScope();var n=a.Number;t.Number=n;n.isFinite=n.isFinite||function(e){return typeof e==="number"&&isFinite(e)}},"./src/remux/aac-helper.js":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});var i=function(){function e(){}e.getSilentFrame=function(e,t){switch(e){case"mp4a.40.2":if(t===1){return new Uint8Array([0,200,0,128,35,128])}else if(t===2){return new Uint8Array([33,0,73,144,2,25,0,35,128])}else if(t===3){return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142])}else if(t===4){return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56])}else if(t===5){return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56])}else if(t===6){return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224])}break;default:if(t===1){return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}else if(t===2){return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}else if(t===3){return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}break}return null};return e}();t.default=i},"./src/remux/mp4-generator.js":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});var o=Math.pow(2,32)-1;var i=function(){function c(){}c.init=function(){c.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]};var e;for(e in c.types){if(c.types.hasOwnProperty(e)){c.types[e]=[e.charCodeAt(0),e.charCodeAt(1),e.charCodeAt(2),e.charCodeAt(3)]}}var t=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]);var r=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);c.HDLR_TYPES={video:t,audio:r};var i=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]);var a=new Uint8Array([0,0,0,0,0,0,0,0]);c.STTS=c.STSC=c.STCO=a;c.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]);c.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]);c.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]);c.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);var n=new Uint8Array([105,115,111,109]);var s=new Uint8Array([97,118,99,49]);var o=new Uint8Array([0,0,0,1]);c.FTYP=c.box(c.types.ftyp,n,o,n,s);c.DINF=c.box(c.types.dinf,c.box(c.types.dref,i))};c.box=function(e){var t=Array.prototype.slice.call(arguments,1),r=8,i=t.length,a=i,n;while(i--){r+=t[i].byteLength}n=new Uint8Array(r);n[0]=r>>24&255;n[1]=r>>16&255;n[2]=r>>8&255;n[3]=r&255;n.set(e,4);for(i=0,r=8;i<a;i++){n.set(t[i],r);r+=t[i].byteLength}return n};c.hdlr=function(e){return c.box(c.types.hdlr,c.HDLR_TYPES[e])};c.mdat=function(e){return c.box(c.types.mdat,e)};c.mdhd=function(e,t){t*=e;var r=Math.floor(t/(o+1));var i=Math.floor(t%(o+1));return c.box(c.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,e&255,r>>24,r>>16&255,r>>8&255,r&255,i>>24,i>>16&255,i>>8&255,i&255,85,196,0,0]))};c.mdia=function(e){return c.box(c.types.mdia,c.mdhd(e.timescale,e.duration),c.hdlr(e.type),c.minf(e))};c.mfhd=function(e){return c.box(c.types.mfhd,new Uint8Array([0,0,0,0,e>>24,e>>16&255,e>>8&255,e&255]))};c.minf=function(e){if(e.type==="audio"){return c.box(c.types.minf,c.box(c.types.smhd,c.SMHD),c.DINF,c.stbl(e))}else{return c.box(c.types.minf,c.box(c.types.vmhd,c.VMHD),c.DINF,c.stbl(e))}};c.moof=function(e,t,r){return c.box(c.types.moof,c.mfhd(e),c.traf(r,t))};c.moov=function(e){var t=e.length,r=[];while(t--){r[t]=c.trak(e[t])}return c.box.apply(null,[c.types.moov,c.mvhd(e[0].timescale,e[0].duration)].concat(r).concat(c.mvex(e)))};c.mvex=function(e){var t=e.length,r=[];while(t--){r[t]=c.trex(e[t])}return c.box.apply(null,[c.types.mvex].concat(r))};c.mvhd=function(e,t){t*=e;var r=Math.floor(t/(o+1));var i=Math.floor(t%(o+1));var a=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,e&255,r>>24,r>>16&255,r>>8&255,r&255,i>>24,i>>16&255,i>>8&255,i&255,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return c.box(c.types.mvhd,a)};c.sdtp=function(e){var t=e.samples||[],r=new Uint8Array(4+t.length),i,a;for(a=0;a<t.length;a++){i=t[a].flags;r[a+4]=i.dependsOn<<4|i.isDependedOn<<2|i.hasRedundancy}return c.box(c.types.sdtp,r)};c.stbl=function(e){return c.box(c.types.stbl,c.stsd(e),c.box(c.types.stts,c.STTS),c.box(c.types.stsc,c.STSC),c.box(c.types.stsz,c.STSZ),c.box(c.types.stco,c.STCO))};c.avc1=function(e){var t=[],r=[],i,a,n;for(i=0;i<e.sps.length;i++){a=e.sps[i];n=a.byteLength;t.push(n>>>8&255);t.push(n&255);t=t.concat(Array.prototype.slice.call(a))}for(i=0;i<e.pps.length;i++){a=e.pps[i];n=a.byteLength;r.push(n>>>8&255);r.push(n&255);r=r.concat(Array.prototype.slice.call(a))}var s=c.box(c.types.avcC,new Uint8Array([1,t[3],t[4],t[5],252|3,224|e.sps.length].concat(t).concat([e.pps.length]).concat(r))),o=e.width,l=e.height,u=e.pixelRatio[0],f=e.pixelRatio[1];return c.box(c.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,o>>8&255,o&255,l>>8&255,l&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),s,c.box(c.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),c.box(c.types.pasp,new Uint8Array([u>>24,u>>16&255,u>>8&255,u&255,f>>24,f>>16&255,f>>8&255,f&255])))};c.esds=function(e){var t=e.config.length;return new Uint8Array([0,0,0,0,3,23+t,0,1,0,4,15+t,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([t]).concat(e.config).concat([6,1,2]))};c.mp4a=function(e){var t=e.samplerate;return c.box(c.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,e.channelCount,0,16,0,0,0,0,t>>8&255,t&255,0,0]),c.box(c.types.esds,c.esds(e)))};c.mp3=function(e){var t=e.samplerate;return c.box(c.types[".mp3"],new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,e.channelCount,0,16,0,0,0,0,t>>8&255,t&255,0,0]))};c.stsd=function(e){if(e.type==="audio"){if(!e.isAAC&&e.codec==="mp3"){return c.box(c.types.stsd,c.STSD,c.mp3(e))}return c.box(c.types.stsd,c.STSD,c.mp4a(e))}else{return c.box(c.types.stsd,c.STSD,c.avc1(e))}};c.tkhd=function(e){var t=e.id,r=e.duration*e.timescale,i=e.width,a=e.height,n=Math.floor(r/(o+1)),s=Math.floor(r%(o+1));return c.box(c.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,t&255,0,0,0,0,n>>24,n>>16&255,n>>8&255,n&255,s>>24,s>>16&255,s>>8&255,s&255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,i>>8&255,i&255,0,0,a>>8&255,a&255,0,0]))};c.traf=function(e,t){var r=c.sdtp(e),i=e.id,a=Math.floor(t/(o+1)),n=Math.floor(t%(o+1));return c.box(c.types.traf,c.box(c.types.tfhd,new Uint8Array([0,0,0,0,i>>24,i>>16&255,i>>8&255,i&255])),c.box(c.types.tfdt,new Uint8Array([1,0,0,0,a>>24,a>>16&255,a>>8&255,a&255,n>>24,n>>16&255,n>>8&255,n&255])),c.trun(e,r.length+16+20+8+16+8+8),r)};c.trak=function(e){e.duration=e.duration||4294967295;return c.box(c.types.trak,c.tkhd(e),c.mdia(e))};c.trex=function(e){var t=e.id;return c.box(c.types.trex,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,t&255,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))};c.trun=function(e,t){var r=e.samples||[],i=r.length,a=12+16*i,n=new Uint8Array(a),s,o,l,u,f,d;t+=8+a;n.set([0,0,15,1,i>>>24&255,i>>>16&255,i>>>8&255,i&255,t>>>24&255,t>>>16&255,t>>>8&255,t&255],0);for(s=0;s<i;s++){o=r[s];l=o.duration;u=o.size;f=o.flags;d=o.cts;n.set([l>>>24&255,l>>>16&255,l>>>8&255,l&255,u>>>24&255,u>>>16&255,u>>>8&255,u&255,f.isLeading<<2|f.dependsOn,f.isDependedOn<<6|f.hasRedundancy<<4|f.paddingValue<<1|f.isNonSync,f.degradPrio&240<<8,f.degradPrio&15,d>>>24&255,d>>>16&255,d>>>8&255,d&255],12+16*s)}return c.box(c.types.trun,n)};c.initSegment=function(e){if(!c.types){c.init()}var t=c.moov(e),r;r=new Uint8Array(c.FTYP.byteLength+t.byteLength);r.set(c.FTYP);r.set(t,c.FTYP.byteLength);return r};return c}();t.default=i},"./src/remux/mp4-remuxer.js":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});var W=r("./src/remux/aac-helper.js");var z=r("./src/remux/mp4-generator.js");var Q=r("./src/events.js");var $=r("./src/errors.js");var J=r("./src/utils/logger.js");var Y=10*1e3;var i=function(){function e(e,t,r,i){this.observer=e;this.config=t;this.typeSupported=r;var a=navigator.userAgent;this.isSafari=i&&i.indexOf("Apple")>-1&&a&&!a.match("CriOS");this.ISGenerated=false}e.prototype.destroy=function(){};e.prototype.resetTimeStamp=function(e){this._initPTS=this._initDTS=e};e.prototype.resetInitSegment=function(){this.ISGenerated=false};e.prototype.remux=function(e,t,r,i,a,n,s){if(!this.ISGenerated){this.generateIS(e,t,a)}if(this.ISGenerated){var o=e.samples.length;var l=t.samples.length;var u=a;var f=a;if(o&&l){var d=(e.samples[0].pts-t.samples[0].pts)/t.inputTimeScale;u+=Math.max(0,d);f+=Math.max(0,-d)}if(o){if(!e.timescale){J.logger.warn("regenerate InitSegment as audio detected");this.generateIS(e,t,a)}var c=this.remuxAudio(e,u,n,s);if(l){var h=void 0;if(c){h=c.endPTS-c.startPTS}if(!t.timescale){J.logger.warn("regenerate InitSegment as video detected");this.generateIS(e,t,a)}this.remuxVideo(t,f,n,h,s)}}else{if(l){var p=this.remuxVideo(t,f,n,0,s);if(p&&e.codec){this.remuxEmptyAudio(e,u,n,p)}}}}if(r.samples.length){this.remuxID3(r,a)}if(i.samples.length){this.remuxText(i,a)}this.observer.trigger(Q.default.FRAG_PARSED)};e.prototype.generateIS=function(e,t,r){var i=this.observer,a=e.samples,n=t.samples,s=this.typeSupported,o="audio/mp4",l={},u={tracks:l},f=this._initPTS===undefined,d,c;if(f){d=c=Infinity}if(e.config&&a.length){e.timescale=e.samplerate;J.logger.log("audio sampling rate : "+e.samplerate);if(!e.isAAC){if(s.mpeg){o="audio/mpeg";e.codec=""}else if(s.mp3){e.codec="mp3"}}l.audio={container:o,codec:e.codec,initSegment:!e.isAAC&&s.mpeg?new Uint8Array:z.default.initSegment([e]),metadata:{channelCount:e.channelCount}};if(f){d=c=a[0].pts-e.inputTimeScale*r}}if(t.sps&&t.pps&&n.length){var h=t.inputTimeScale;t.timescale=h;l.video={container:"video/mp4",codec:t.codec,initSegment:z.default.initSegment([t]),metadata:{width:t.width,height:t.height}};if(f){d=Math.min(d,n[0].pts-h*r);c=Math.min(c,n[0].dts-h*r);this.observer.trigger(Q.default.INIT_PTS_FOUND,{initPTS:d})}}if(Object.keys(l).length){i.trigger(Q.default.FRAG_PARSING_INIT_SEGMENT,u);this.ISGenerated=true;if(f){this._initPTS=d;this._initDTS=c}}else{i.trigger(Q.default.ERROR,{type:$.ErrorTypes.MEDIA_ERROR,details:$.ErrorDetails.FRAG_PARSING_ERROR,fatal:false,reason:"no audio/video samples found"})}};e.prototype.remuxVideo=function(e,t,r,i,a){var n=8;var s;var o;var l;var u;var f;var d;var c;var h=e.timescale;var p=e.samples;var g=[];var v=p.length;var m=this._PTSNormalize;var y=this._initPTS;var E=this.nextAvcDts;var _=this.isSafari;if(v===0){return}if(_){r|=p.length&&E&&(a&&Math.abs(t-E/h)<.1||Math.abs(p[0].pts-E-y)<h/5)}if(!r){E=t*h}p.forEach(function(e){e.pts=m(e.pts-y,E);e.dts=m(e.dts-y,E)});p.sort(function(e,t){var r=e.dts-t.dts;var i=e.pts-t.pts;return r||(i||e.id-t.id)});var T=p.reduce(function(e,t){return Math.max(Math.min(e,t.pts-t.dts),-18e3)},0);if(T<0){J.logger.warn("PTS < DTS detected in video samples, shifting DTS by "+Math.round(T/90)+" ms to overcome this issue");for(var S=0;S<p.length;S++){p[S].dts+=T}}var b=p[0];f=Math.max(b.dts,0);u=Math.max(b.pts,0);var A=Math.round((f-E)/90);if(r){if(A){if(A>1){J.logger.log("AVC:"+A+" ms hole between fragments detected,filling it")}else if(A<-1){J.logger.log("AVC:"+-A+" ms overlapping between fragments detected")}f=E;p[0].dts=f;u=Math.max(u-A,E);p[0].pts=u;J.logger.log("Video/PTS/DTS adjusted: "+Math.round(u/90)+"/"+Math.round(f/90)+",delta:"+A+" ms")}}b=p[p.length-1];c=Math.max(b.dts,0);d=Math.max(b.pts,0,c);if(_){s=Math.round((c-f)/(p.length-1))}var R=0,D=0;for(var S=0;S<v;S++){var L=p[S],w=L.units,O=w.length,k=0;for(var I=0;I<O;I++){k+=w[I].data.length}D+=k;R+=O;L.length=k;if(_){L.dts=f+S*s}else{L.dts=Math.max(L.dts,f)}L.pts=Math.max(L.pts,L.dts)}var P=D+4*R+8;try{o=new Uint8Array(P)}catch(e){this.observer.trigger(Q.default.ERROR,{type:$.ErrorTypes.MUX_ERROR,details:$.ErrorDetails.REMUX_ALLOC_ERROR,fatal:false,bytes:P,reason:"fail allocating video mdat "+P});return}var C=new DataView(o.buffer);C.setUint32(0,P);o.set(z.default.types.mdat,4);for(var S=0;S<v;S++){var x=p[S],F=x.units,M=0,N=void 0;for(var I=0,O=F.length;I<O;I++){var j=F[I],U=j.data,B=j.data.byteLength;C.setUint32(n,B);n+=4;o.set(U,n);n+=B;M+=4+B}if(!_){if(S<v-1){s=p[S+1].dts-x.dts}else{var G=this.config,K=x.dts-p[S>0?S-1:S].dts;if(G.stretchShortVideoTrack){var H=G.maxBufferHole,V=Math.floor(H*h),W=(i?u+i*h:this.nextAudioPts)-x.pts;if(W>V){s=W-K;if(s<0){s=K}J.logger.log("It is approximately "+W/90+" ms to the next segment; using duration "+s/90+" ms for the last video frame.")}else{s=K}}else{s=K}}N=Math.round(x.pts-x.dts)}else{N=Math.max(0,s*Math.round((x.pts-x.dts)/s))}g.push({size:M,duration:s,cts:N,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:x.key?2:1,isNonSync:x.key?0:1}})}this.nextAvcDts=c+s;var Y=e.dropped;e.len=0;e.nbNalu=0;e.dropped=0;if(g.length&&navigator.userAgent.toLowerCase().indexOf("chrome")>-1){var q=g[0].flags;q.dependsOn=2;q.isNonSync=0}e.samples=g;l=z.default.moof(e.sequenceNumber++,f,e);e.samples=[];var X={data1:l,data2:o,startPTS:u/h,endPTS:(d+s)/h,startDTS:f/h,endDTS:this.nextAvcDts/h,type:"video",hasAudio:false,hasVideo:true,nb:g.length,dropped:Y};this.observer.trigger(Q.default.FRAG_PARSING_DATA,X);return X};e.prototype.remuxAudio=function(e,t,r,i){var a=e.inputTimeScale;var n=e.timescale;var s=a/n;var o=e.isAAC?1024:1152;var l=o*s;var u=this._PTSNormalize;var f=this._initPTS;var d=!e.isAAC&&this.typeSupported.mpeg;var c,h,p,g,v,m,y,E=e.samples,_=[],T=this.nextAudioPts;r|=E.length&&T&&(i&&Math.abs(t-T/a)<.1||Math.abs(E[0].pts-T-f)<20*l);E.forEach(function(e){e.pts=e.dts=u(e.pts-f,t*a)});E=E.filter(function(e){return e.pts>=0});if(E.length===0){return}if(!r){if(!i){T=E[0].pts}else{T=t*a}}if(e.isAAC){var S=this.config.maxAudioFramesDrift;for(var b=0,A=T;b<E.length;){var R=E[b],D;var L=R.pts;D=L-A;var w=Math.abs(1e3*D/a);if(D<=-S*l){J.logger.warn("Dropping 1 audio frame @ "+(A/a).toFixed(3)+"s due to "+Math.round(w)+" ms overlap.");E.splice(b,1);e.len-=R.unit.length}else if(D>=S*l&&w<Y&&A){var O=Math.round(D/l);J.logger.warn("Injecting "+O+" audio frame @ "+(A/a).toFixed(3)+"s due to "+Math.round(1e3*D/a)+" ms gap.");for(var k=0;k<O;k++){var I=Math.max(A,0);p=W.default.getSilentFrame(e.manifestCodec||e.codec,e.channelCount);if(!p){J.logger.log("Unable to get silent frame for given audio codec; duplicating last frame instead.");p=R.unit.subarray()}E.splice(b,0,{unit:p,pts:I,dts:I});e.len+=p.length;A+=l;b++}R.pts=R.dts=A;A+=l;b++}else{if(Math.abs(D)>.1*l){}R.pts=R.dts=A;A+=l;b++}}}for(var k=0,P=E.length;k<P;k++){var C=E[k];var x=C.unit;var L=C.pts;if(y!==undefined){h.duration=Math.round((L-y)/s)}else{var F=Math.round(1e3*(L-T)/a),M=0;if(r&&e.isAAC){if(F){if(F>0&&F<Y){M=Math.round((L-T)/l);J.logger.log(F+" ms hole between AAC samples detected,filling it");if(M>0){p=W.default.getSilentFrame(e.manifestCodec||e.codec,e.channelCount);if(!p){p=x.subarray()}e.len+=M*p.length}}else if(F<-12){J.logger.log("drop overlapping AAC sample, expected/parsed/delta:"+(T/a).toFixed(3)+"s/"+(L/a).toFixed(3)+"s/"+-F+"ms");e.len-=x.byteLength;continue}L=T}}m=L;if(e.len>0){var N=d?e.len:e.len+8;c=d?0:8;try{g=new Uint8Array(N)}catch(e){this.observer.trigger(Q.default.ERROR,{type:$.ErrorTypes.MUX_ERROR,details:$.ErrorDetails.REMUX_ALLOC_ERROR,fatal:false,bytes:N,reason:"fail allocating audio mdat "+N});return}if(!d){var j=new DataView(g.buffer);j.setUint32(0,N);g.set(z.default.types.mdat,4)}}else{return}for(var b=0;b<M;b++){p=W.default.getSilentFrame(e.manifestCodec||e.codec,e.channelCount);if(!p){J.logger.log("Unable to get silent frame for given audio codec; duplicating this frame instead.");p=x.subarray()}g.set(p,c);c+=p.byteLength;h={size:p.byteLength,cts:0,duration:1024,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:1}};_.push(h)}}g.set(x,c);var U=x.byteLength;c+=U;h={size:U,cts:0,duration:0,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:1}};_.push(h);y=L}var B=0;var G=_.length;if(G>=2){B=_[G-2].duration;h.duration=B}if(G){this.nextAudioPts=T=y+s*B;e.len=0;e.samples=_;if(d){v=new Uint8Array}else{v=z.default.moof(e.sequenceNumber++,m/s,e)}e.samples=[];var K=m/a;var H=T/a;var V={data1:v,data2:g,startPTS:K,endPTS:H,startDTS:K,endDTS:H,type:"audio",hasAudio:true,hasVideo:false,nb:G};this.observer.trigger(Q.default.FRAG_PARSING_DATA,V);return V}return null};e.prototype.remuxEmptyAudio=function(e,t,r,i){var a=e.inputTimeScale,n=e.samplerate?e.samplerate:a,s=a/n,o=this.nextAudioPts,l=(o!==undefined?o:i.startDTS*a)+this._initDTS,u=i.endDTS*a+this._initDTS,f=1024,d=s*f,c=Math.ceil((u-l)/d),h=W.default.getSilentFrame(e.manifestCodec||e.codec,e.channelCount);J.logger.warn("remux empty Audio");if(!h){J.logger.trace("Unable to remuxEmptyAudio since we were unable to get a silent frame for given audio codec!");return}var p=[];for(var g=0;g<c;g++){var v=l+g*d;p.push({unit:h,pts:v,dts:v});e.len+=h.length}e.samples=p;this.remuxAudio(e,t,r)};e.prototype.remuxID3=function(e){var t=e.samples.length,r;var i=e.inputTimeScale;var a=this._initPTS;var n=this._initDTS;if(t){for(var s=0;s<t;s++){r=e.samples[s];r.pts=(r.pts-a)/i;r.dts=(r.dts-n)/i}this.observer.trigger(Q.default.FRAG_PARSING_METADATA,{samples:e.samples})}e.samples=[]};e.prototype.remuxText=function(e){e.samples.sort(function(e,t){return e.pts-t.pts});var t=e.samples.length,r;var i=e.inputTimeScale;var a=this._initPTS;if(t){for(var n=0;n<t;n++){r=e.samples[n];r.pts=(r.pts-a)/i}this.observer.trigger(Q.default.FRAG_PARSING_USERDATA,{samples:e.samples})}e.samples=[]};e.prototype._PTSNormalize=function(e,t){var r;if(t===undefined){return e}if(t<e){r=-8589934592}else{r=8589934592}while(Math.abs(e-t)>4294967296){e+=r}return e};return e}();t.default=i},"./src/remux/passthrough-remuxer.js":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});var f=r("./src/events.js");var i=function(){function e(e){this.observer=e}e.prototype.destroy=function(){};e.prototype.resetTimeStamp=function(){};e.prototype.resetInitSegment=function(){};e.prototype.remux=function(e,t,r,i,a,n,s,o){var l=this.observer;var u="";if(e){u+="audio"}if(t){u+="video"}l.trigger(f.default.FRAG_PARSING_DATA,{data1:o,startPTS:a,startDTS:a,type:u,hasAudio:!!e,hasVideo:!!t,nb:1,dropped:0});l.trigger(f.default.FRAG_PARSED)};return e}();t.default=i},"./src/task-loop.js":function(e,t,r){"use strict";var i=this&&this.__extends||function(){var i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r]};return function(e,t){i(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:true});var a=r("./src/event-handler.js");var n=function(a){i(e,a);function e(e){var t=[];for(var r=1;r<arguments.length;r++){t[r-1]=arguments[r]}var i=a.apply(this,[e].concat(t))||this;i._tickInterval=null;i._tickTimer=null;i._tickCallCount=0;i._boundTick=i.tick.bind(i);return i}e.prototype.onHandlerDestroying=function(){this.clearNextTick();this.clearInterval()};e.prototype.hasInterval=function(){return!!this._tickInterval};e.prototype.hasNextTick=function(){return!!this._tickTimer};e.prototype.setInterval=function(e){if(!this._tickInterval){this._tickInterval=setInterval(this._boundTick,e);return true}return false};e.prototype.clearInterval=function(){if(this._tickInterval){clearInterval(this._tickInterval);this._tickInterval=null;return true}return false};e.prototype.clearNextTick=function(){if(this._tickTimer){clearTimeout(this._tickTimer);this._tickTimer=null;return true}return false};e.prototype.tick=function(){this._tickCallCount++;if(this._tickCallCount===1){this.doTick();if(this._tickCallCount>1){this.clearNextTick();this._tickTimer=setTimeout(this._boundTick,0)}this._tickCallCount=0}};e.prototype.doTick=function(){};return e}(a.default);t.default=n},"./src/utils/attr-list.js":function(e,t,r){"use strict";(function(i){Object.defineProperty(t,"__esModule",{value:true});var a=/^(\d+)x(\d+)$/;var n=/\s*(.+?)\s*=((?:\".*?\")|.*?)(?:,|$)/g;var e=function(){function r(e){if(typeof e==="string"){e=r.parseAttrList(e)}for(var t in e){if(e.hasOwnProperty(t)){this[t]=e[t]}}}r.prototype.decimalInteger=function(e){var t=parseInt(this[e],10);if(t>i.MAX_SAFE_INTEGER){return Infinity}return t};r.prototype.hexadecimalInteger=function(e){if(this[e]){var t=(this[e]||"0x").slice(2);t=(t.length&1?"0":"")+t;var r=new Uint8Array(t.length/2);for(var i=0;i<t.length/2;i++){r[i]=parseInt(t.slice(i*2,i*2+2),16)}return r}else{return null}};r.prototype.hexadecimalIntegerAsNumber=function(e){var t=parseInt(this[e],16);if(t>i.MAX_SAFE_INTEGER){return Infinity}return t};r.prototype.decimalFloatingPoint=function(e){return parseFloat(this[e])};r.prototype.enumeratedString=function(e){return this[e]};r.prototype.decimalResolution=function(e){var t=a.exec(this[e]);if(t===null){return undefined}return{width:parseInt(t[1],10),height:parseInt(t[2],10)}};r.parseAttrList=function(e){var t,r={};n.lastIndex=0;while((t=n.exec(e))!==null){var i=t[2],a='"';if(i.indexOf(a)===0&&i.lastIndexOf(a)===i.length-1){i=i.slice(1,-1)}r[t[1]]=i}return r};return r}();t.default=e}).call(this,r("./src/polyfills/number.js")["Number"])},"./src/utils/binary-search.js":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});var i={search:function(e,t){var r=0;var i=e.length-1;var a=null;var n=null;while(r<=i){a=(r+i)/2|0;n=e[a];var s=t(n);if(s>0){r=a+1}else if(s<0){i=a-1}else{return n}}return null}};t.default=i},"./src/utils/buffer-helper.js":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});var i=function(){function e(){}e.isBuffered=function(e,t){try{if(e){var r=e.buffered;for(var i=0;i<r.length;i++){if(t>=r.start(i)&&t<=r.end(i)){return true}}}}catch(e){}return false};e.bufferInfo=function(e,t,r){try{if(e){var i=e.buffered,a=[],n=void 0;for(n=0;n<i.length;n++){a.push({start:i.start(n),end:i.end(n)})}return this.bufferedInfo(a,t,r)}}catch(e){}return{len:0,start:t,end:t,nextStart:undefined}};e.bufferedInfo=function(e,t,r){var i=[],a,n,s,o,l;e.sort(function(e,t){var r=e.start-t.start;if(r){return r}else{return t.end-e.end}});for(l=0;l<e.length;l++){var u=i.length;if(u){var f=i[u-1].end;if(e[l].start-f<r){if(e[l].end>f){i[u-1].end=e[l].end}}else{i.push(e[l])}}else{i.push(e[l])}}for(l=0,a=0,n=s=t;l<i.length;l++){var d=i[l].start,c=i[l].end;if(t+r>=d&&t<c){n=d;s=c;a=s-t}else if(t+r<d){o=d;break}}return{len:a,start:n,end:s,nextStart:o}};return e}();t.BufferHelper=i},"./src/utils/cea-608-parser.js":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});var i={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499};var o=function(e){var t=e;if(i.hasOwnProperty(e)){t=i[e]}return String.fromCharCode(t)};var f=15,a=100;var l={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14};var u={17:2,18:4,21:6,22:8,23:10,19:13,20:15};var d={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14};var c={25:2,26:4,29:6,30:8,31:10,27:13,28:15};var h=["white","green","blue","cyan","red","yellow","magenta","black","transparent"];var p={verboseFilter:{DATA:3,DEBUG:3,INFO:2,WARNING:2,TEXT:1,ERROR:0},time:null,verboseLevel:0,setTime:function(e){this.time=e},log:function(e,t){var r=this.verboseFilter[e];if(this.verboseLevel>=r){}}};var g=function(e){var t=[];for(var r=0;r<e.length;r++){t.push(e[r].toString(16))}return t};var s=function(){function e(e,t,r,i,a){this.foreground=e||"white";this.underline=t||false;this.italics=r||false;this.background=i||"black";this.flash=a||false}e.prototype.reset=function(){this.foreground="white";this.underline=false;this.italics=false;this.background="black";this.flash=false};e.prototype.setStyles=function(e){var t=["foreground","underline","italics","background","flash"];for(var r=0;r<t.length;r++){var i=t[r];if(e.hasOwnProperty(i)){this[i]=e[i]}}};e.prototype.isDefault=function(){return this.foreground==="white"&&!this.underline&&!this.italics&&this.background==="black"&&!this.flash};e.prototype.equals=function(e){return this.foreground===e.foreground&&this.underline===e.underline&&this.italics===e.italics&&this.background===e.background&&this.flash===e.flash};e.prototype.copy=function(e){this.foreground=e.foreground;this.underline=e.underline;this.italics=e.italics;this.background=e.background;this.flash=e.flash};e.prototype.toString=function(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash};return e}();var n=function(){function e(e,t,r,i,a,n){this.uchar=e||" ";this.penState=new s(t,r,i,a,n)}e.prototype.reset=function(){this.uchar=" ";this.penState.reset()};e.prototype.setChar=function(e,t){this.uchar=e;this.penState.copy(t)};e.prototype.setPenState=function(e){this.penState.copy(e)};e.prototype.equals=function(e){return this.uchar===e.uchar&&this.penState.equals(e.penState)};e.prototype.copy=function(e){this.uchar=e.uchar;this.penState.copy(e.penState)};e.prototype.isEmpty=function(){return this.uchar===" "&&this.penState.isDefault()};return e}();var v=function(){function e(){this.chars=[];for(var e=0;e<a;e++){this.chars.push(new n)}this.pos=0;this.currPenState=new s}e.prototype.equals=function(e){var t=true;for(var r=0;r<a;r++){if(!this.chars[r].equals(e.chars[r])){t=false;break}}return t};e.prototype.copy=function(e){for(var t=0;t<a;t++){this.chars[t].copy(e.chars[t])}};e.prototype.isEmpty=function(){var e=true;for(var t=0;t<a;t++){if(!this.chars[t].isEmpty()){e=false;break}}return e};e.prototype.setCursor=function(e){if(this.pos!==e){this.pos=e}if(this.pos<0){p.log("ERROR","Negative cursor position "+this.pos);this.pos=0}else if(this.pos>a){p.log("ERROR","Too large cursor position "+this.pos);this.pos=a}};e.prototype.moveCursor=function(e){var t=this.pos+e;if(e>1){for(var r=this.pos+1;r<t+1;r++){this.chars[r].setPenState(this.currPenState)}}this.setCursor(t)};e.prototype.backSpace=function(){this.moveCursor(-1);this.chars[this.pos].setChar(" ",this.currPenState)};e.prototype.insertChar=function(e){if(e>=144){this.backSpace()}var t=o(e);if(this.pos>=a){p.log("ERROR","Cannot insert "+e.toString(16)+" ("+t+") at position "+this.pos+". Skipping it!");return}this.chars[this.pos].setChar(t,this.currPenState);this.moveCursor(1)};e.prototype.clearFromPos=function(e){var t;for(t=e;t<a;t++){this.chars[t].reset()}};e.prototype.clear=function(){this.clearFromPos(0);this.pos=0;this.currPenState.reset()};e.prototype.clearToEndOfRow=function(){this.clearFromPos(this.pos)};e.prototype.getTextString=function(){var e=[];var t=true;for(var r=0;r<a;r++){var i=this.chars[r].uchar;if(i!==" "){t=false}e.push(i)}if(t){return""}else{return e.join("")}};e.prototype.setPenStyles=function(e){this.currPenState.setStyles(e);var t=this.chars[this.pos];t.setPenState(this.currPenState)};return e}();var m=function(){function e(){this.rows=[];for(var e=0;e<f;e++){this.rows.push(new v)}this.currRow=f-1;this.nrRollUpRows=null;this.reset()}e.prototype.reset=function(){for(var e=0;e<f;e++){this.rows[e].clear()}this.currRow=f-1};e.prototype.equals=function(e){var t=true;for(var r=0;r<f;r++){if(!this.rows[r].equals(e.rows[r])){t=false;break}}return t};e.prototype.copy=function(e){for(var t=0;t<f;t++){this.rows[t].copy(e.rows[t])}};e.prototype.isEmpty=function(){var e=true;for(var t=0;t<f;t++){if(!this.rows[t].isEmpty()){e=false;break}}return e};e.prototype.backSpace=function(){var e=this.rows[this.currRow];e.backSpace()};e.prototype.clearToEndOfRow=function(){var e=this.rows[this.currRow];e.clearToEndOfRow()};e.prototype.insertChar=function(e){var t=this.rows[this.currRow];t.insertChar(e)};e.prototype.setPen=function(e){var t=this.rows[this.currRow];t.setPenStyles(e)};e.prototype.moveCursor=function(e){var t=this.rows[this.currRow];t.moveCursor(e)};e.prototype.setCursor=function(e){p.log("INFO","setCursor: "+e);var t=this.rows[this.currRow];t.setCursor(e)};e.prototype.setPAC=function(e){p.log("INFO","pacData = "+JSON.stringify(e));var t=e.row-1;if(this.nrRollUpRows&&t<this.nrRollUpRows-1){t=this.nrRollUpRows-1}if(this.nrRollUpRows&&this.currRow!==t){for(var r=0;r<f;r++){this.rows[r].clear()}var i=this.currRow+1-this.nrRollUpRows;var a=this.lastOutputScreen;if(a){var n=a.rows[i].cueStartTime;if(n&&n<p.time){for(var r=0;r<this.nrRollUpRows;r++){this.rows[t-this.nrRollUpRows+r+1].copy(a.rows[i+r])}}}}this.currRow=t;var s=this.rows[this.currRow];if(e.indent!==null){var o=e.indent;var l=Math.max(o-1,0);s.setCursor(e.indent);e.color=s.chars[l].penState.foreground}var u={foreground:e.color,underline:e.underline,italics:e.italics,background:"black",flash:false};this.setPen(u)};e.prototype.setBkgData=function(e){p.log("INFO","bkgData = "+JSON.stringify(e));this.backSpace();this.setPen(e);this.insertChar(32)};e.prototype.setRollUpRows=function(e){this.nrRollUpRows=e};e.prototype.rollUp=function(){if(this.nrRollUpRows===null){p.log("DEBUG","roll_up but nrRollUpRows not set yet");return}p.log("TEXT",this.getDisplayText());var e=this.currRow+1-this.nrRollUpRows;var t=this.rows.splice(e,1)[0];t.clear();this.rows.splice(this.currRow,0,t);p.log("INFO","Rolling up")};e.prototype.getDisplayText=function(e){e=e||false;var t=[];var r="";var i=-1;for(var a=0;a<f;a++){var n=this.rows[a].getTextString();if(n){i=a+1;if(e){t.push("Row "+i+": '"+n+"'")}else{t.push(n.trim())}}}if(t.length>0){if(e){r="["+t.join(" | ")+"]"}else{r=t.join("\n")}}return r};e.prototype.getTextAndFormat=function(){return this.rows};return e}();var y=function(){function e(e,t){this.chNr=e;this.outputFilter=t;this.mode=null;this.verbose=0;this.displayedMemory=new m;this.nonDisplayedMemory=new m;this.lastOutputScreen=new m;this.currRollUpRow=this.displayedMemory.rows[f-1];this.writeScreen=this.displayedMemory;this.mode=null;this.cueStartTime=null}e.prototype.reset=function(){this.mode=null;this.displayedMemory.reset();this.nonDisplayedMemory.reset();this.lastOutputScreen.reset();this.currRollUpRow=this.displayedMemory.rows[f-1];this.writeScreen=this.displayedMemory;this.mode=null;this.cueStartTime=null;this.lastCueEndTime=null};e.prototype.getHandler=function(){return this.outputFilter};e.prototype.setHandler=function(e){this.outputFilter=e};e.prototype.setPAC=function(e){this.writeScreen.setPAC(e)};e.prototype.setBkgData=function(e){this.writeScreen.setBkgData(e)};e.prototype.setMode=function(e){if(e===this.mode){return}this.mode=e;p.log("INFO","MODE="+e);if(this.mode==="MODE_POP-ON"){this.writeScreen=this.nonDisplayedMemory}else{this.writeScreen=this.displayedMemory;this.writeScreen.reset()}if(this.mode!=="MODE_ROLL-UP"){this.displayedMemory.nrRollUpRows=null;this.nonDisplayedMemory.nrRollUpRows=null}this.mode=e};e.prototype.insertChars=function(e){for(var t=0;t<e.length;t++){this.writeScreen.insertChar(e[t])}var r=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";p.log("INFO",r+": "+this.writeScreen.getDisplayText(true));if(this.mode==="MODE_PAINT-ON"||this.mode==="MODE_ROLL-UP"){p.log("TEXT","DISPLAYED: "+this.displayedMemory.getDisplayText(true));this.outputDataUpdate()}};e.prototype.ccRCL=function(){p.log("INFO","RCL - Resume Caption Loading");this.setMode("MODE_POP-ON")};e.prototype.ccBS=function(){p.log("INFO","BS - BackSpace");if(this.mode==="MODE_TEXT"){return}this.writeScreen.backSpace();if(this.writeScreen===this.displayedMemory){this.outputDataUpdate()}};e.prototype.ccAOF=function(){};e.prototype.ccAON=function(){};e.prototype.ccDER=function(){p.log("INFO","DER- Delete to End of Row");this.writeScreen.clearToEndOfRow();this.outputDataUpdate()};e.prototype.ccRU=function(e){p.log("INFO","RU("+e+") - Roll Up");this.writeScreen=this.displayedMemory;this.setMode("MODE_ROLL-UP");this.writeScreen.setRollUpRows(e)};e.prototype.ccFON=function(){p.log("INFO","FON - Flash On");this.writeScreen.setPen({flash:true})};e.prototype.ccRDC=function(){p.log("INFO","RDC - Resume Direct Captioning");this.setMode("MODE_PAINT-ON")};e.prototype.ccTR=function(){p.log("INFO","TR");this.setMode("MODE_TEXT")};e.prototype.ccRTD=function(){p.log("INFO","RTD");this.setMode("MODE_TEXT")};e.prototype.ccEDM=function(){p.log("INFO","EDM - Erase Displayed Memory");this.displayedMemory.reset();this.outputDataUpdate(true)};e.prototype.ccCR=function(){p.log("CR - Carriage Return");this.writeScreen.rollUp();this.outputDataUpdate(true)};e.prototype.ccENM=function(){p.log("INFO","ENM - Erase Non-displayed Memory");this.nonDisplayedMemory.reset()};e.prototype.ccEOC=function(){p.log("INFO","EOC - End Of Caption");if(this.mode==="MODE_POP-ON"){var e=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory;this.nonDisplayedMemory=e;this.writeScreen=this.nonDisplayedMemory;p.log("TEXT","DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate(true)};e.prototype.ccTO=function(e){p.log("INFO","TO("+e+") - Tab Offset");this.writeScreen.moveCursor(e)};e.prototype.ccMIDROW=function(e){var t={flash:false};t.underline=e%2===1;t.italics=e>=46;if(!t.italics){var r=Math.floor(e/2)-16;var i=["white","green","blue","cyan","red","yellow","magenta"];t.foreground=i[r]}else{t.foreground="white"}p.log("INFO","MIDROW: "+JSON.stringify(t));this.writeScreen.setPen(t)};e.prototype.outputDataUpdate=function(e){if(e===void 0){e=false}var t=p.time;if(t===null){return}if(this.outputFilter){if(this.cueStartTime===null&&!this.displayedMemory.isEmpty()){this.cueStartTime=t}else{if(!this.displayedMemory.equals(this.lastOutputScreen)){if(this.outputFilter.newCue){this.outputFilter.newCue(this.cueStartTime,t,this.lastOutputScreen);if(e===true&&this.outputFilter.dispatchCue){this.outputFilter.dispatchCue()}}this.cueStartTime=this.displayedMemory.isEmpty()?null:t}}this.lastOutputScreen.copy(this.displayedMemory)}};e.prototype.cueSplitAtTime=function(e){if(this.outputFilter){if(!this.displayedMemory.isEmpty()){if(this.outputFilter.newCue){this.outputFilter.newCue(this.cueStartTime,e,this.displayedMemory)}this.cueStartTime=e}}};return e}();var E=function(){function e(e,t,r){this.field=e||1;this.outputs=[t,r];this.channels=[new y(1,t),new y(2,r)];this.currChNr=-1;this.lastCmdA=null;this.lastCmdB=null;this.bufferedData=[];this.startTime=null;this.lastTime=null;this.dataCounters={padding:0,char:0,cmd:0,other:0}}e.prototype.getHandler=function(e){return this.channels[e].getHandler()};e.prototype.setHandler=function(e,t){this.channels[e].setHandler(t)};e.prototype.addData=function(e,t){var r,i,a,n=false;this.lastTime=e;p.setTime(e);for(var s=0;s<t.length;s+=2){i=t[s]&127;a=t[s+1]&127;if(i===0&&a===0){this.dataCounters.padding+=2;continue}else{p.log("DATA","["+g([t[s],t[s+1]])+"] -> ("+g([i,a])+")")}r=this.parseCmd(i,a);if(!r){r=this.parseMidrow(i,a)}if(!r){r=this.parsePAC(i,a)}if(!r){r=this.parseBackgroundAttributes(i,a)}if(!r){n=this.parseChars(i,a);if(n){if(this.currChNr&&this.currChNr>=0){var o=this.channels[this.currChNr-1];o.insertChars(n)}else{p.log("WARNING","No channel found yet. TEXT-MODE?")}}}if(r){this.dataCounters.cmd+=2}else if(n){this.dataCounters.char+=2}else{this.dataCounters.other+=2;p.log("WARNING","Couldn't parse cleaned data "+g([i,a])+" orig: "+g([t[s],t[s+1]]))}}};e.prototype.parseCmd=function(e,t){var r=null;var i=(e===20||e===28)&&(t>=32&&t<=47);var a=(e===23||e===31)&&(t>=33&&t<=35);if(!(i||a)){return false}if(e===this.lastCmdA&&t===this.lastCmdB){this.lastCmdA=null;this.lastCmdB=null;p.log("DEBUG","Repeated command ("+g([e,t])+") is dropped");return true}if(e===20||e===23){r=1}else{r=2}var n=this.channels[r-1];if(e===20||e===28){if(t===32){n.ccRCL()}else if(t===33){n.ccBS()}else if(t===34){n.ccAOF()}else if(t===35){n.ccAON()}else if(t===36){n.ccDER()}else if(t===37){n.ccRU(2)}else if(t===38){n.ccRU(3)}else if(t===39){n.ccRU(4)}else if(t===40){n.ccFON()}else if(t===41){n.ccRDC()}else if(t===42){n.ccTR()}else if(t===43){n.ccRTD()}else if(t===44){n.ccEDM()}else if(t===45){n.ccCR()}else if(t===46){n.ccENM()}else if(t===47){n.ccEOC()}}else{n.ccTO(t-32)}this.lastCmdA=e;this.lastCmdB=t;this.currChNr=r;return true};e.prototype.parseMidrow=function(e,t){var r=null;if((e===17||e===25)&&t>=32&&t<=47){if(e===17){r=1}else{r=2}if(r!==this.currChNr){p.log("ERROR","Mismatch channel in midrow parsing");return false}var i=this.channels[r-1];i.ccMIDROW(t);p.log("DEBUG","MIDROW ("+g([e,t])+")");return true}return false};e.prototype.parsePAC=function(e,t){var r=null;var i=null;var a=(e>=17&&e<=23||e>=25&&e<=31)&&(t>=64&&t<=127);var n=(e===16||e===24)&&(t>=64&&t<=95);if(!(a||n)){return false}if(e===this.lastCmdA&&t===this.lastCmdB){this.lastCmdA=null;this.lastCmdB=null;return true}r=e<=23?1:2;if(t>=64&&t<=95){i=r===1?l[e]:d[e]}else{i=r===1?u[e]:c[e]}var s=this.interpretPAC(i,t);var o=this.channels[r-1];o.setPAC(s);this.lastCmdA=e;this.lastCmdB=t;this.currChNr=r;return true};e.prototype.interpretPAC=function(e,t){var r=t;var i={color:null,italics:false,indent:null,underline:false,row:e};if(t>95){r=t-96}else{r=t-64}i.underline=(r&1)===1;if(r<=13){i.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(r/2)]}else if(r<=15){i.italics=true;i.color="white"}else{i.indent=Math.floor((r-16)/2)*4}return i};e.prototype.parseChars=function(e,t){var r=null,i=null,a=null;if(e>=25){r=2;a=e-8}else{r=1;a=e}if(a>=17&&a<=19){var n=t;if(a===17){n=t+80}else if(a===18){n=t+112}else{n=t+144}p.log("INFO","Special char '"+o(n)+"' in channel "+r);i=[n]}else if(e>=32&&e<=127){i=t===0?[e]:[e,t]}if(i){var s=g(i);p.log("DEBUG","Char codes =  "+s.join(","));this.lastCmdA=null;this.lastCmdB=null}return i};e.prototype.parseBackgroundAttributes=function(e,t){var r,i,a,n;var s=(e===16||e===24)&&(t>=32&&t<=47);var o=(e===23||e===31)&&(t>=45&&t<=47);if(!(s||o)){return false}r={};if(e===16||e===24){i=Math.floor((t-32)/2);r.background=h[i];if(t%2===1){r.background=r.background+"_semi"}}else if(t===45){r.background="transparent"}else{r.foreground="black";if(t===47){r.underline=true}}a=e<24?1:2;n=this.channels[a-1];n.setBkgData(r);this.lastCmdA=null;this.lastCmdB=null;return true};e.prototype.reset=function(){for(var e=0;e<this.channels.length;e++){if(this.channels[e]){this.channels[e].reset()}}this.lastCmdA=null;this.lastCmdB=null};e.prototype.cueSplitAtTime=function(e){for(var t=0;t<this.channels.length;t++){if(this.channels[t]){this.channels[t].cueSplitAtTime(e)}}};return e}();t.default=E},"./src/utils/codecs.js":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});var i={audio:{a3ds:true,"ac-3":true,"ac-4":true,alac:true,alaw:true,dra1:true,"dts+":true,"dts-":true,dtsc:true,dtse:true,dtsh:true,"ec-3":true,enca:true,g719:true,g726:true,m4ae:true,mha1:true,mha2:true,mhm1:true,mhm2:true,mlpa:true,mp4a:true,"raw ":true,Opus:true,samr:true,sawb:true,sawp:true,sevc:true,sqcp:true,ssmv:true,twos:true,ulaw:true},video:{avc1:true,avc2:true,avc3:true,avc4:true,avcp:true,drac:true,dvav:true,dvhe:true,encv:true,hev1:true,hvc1:true,mjp2:true,mp4v:true,mvc1:true,mvc2:true,mvc3:true,mvc4:true,resv:true,rv60:true,s263:true,svc1:true,svc2:true,"vc-1":true,vp08:true,vp09:true}};function a(e,t){var r=i[t];return!!r&&r[e.slice(0,4)]===true}t.isCodecType=a;function n(e,t){return window.MediaSource.isTypeSupported((t||"video")+'/mp4;codecs="'+e+'"')}t.isCodecSupportedInMp4=n},"./src/utils/cues.js":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});var c=r("./src/utils/vttparser.js");function i(e,t,r,i){var a;var n;var s;var o;var l;var u=window.VTTCue||window.TextTrackCue;for(var f=0;f<i.rows.length;f++){a=i.rows[f];s=true;o=0;l="";if(!a.isEmpty()){for(var d=0;d<a.chars.length;d++){if(a.chars[d].uchar.match(/\s/)&&s){o++}else{l+=a.chars[d].uchar;s=false}}a.cueStartTime=t;if(t===r){r+=1e-4}n=new u(t,r,c.fixLineBreaks(l.trim()));if(o>=16){o--}else{o++}if(navigator.userAgent.match(/Firefox\//)){n.line=f+1}else{n.line=f>7?f-2:f+1}n.align="left";n.position=Math.max(0,Math.min(100,100*(o/32)+(navigator.userAgent.match(/Firefox\//)?50:0)));e.addCue(n)}}}t.newCue=i},"./src/utils/discontinuities.js":function(e,d,c){"use strict";(function(n){Object.defineProperty(d,"__esModule",{value:true});var r=c("./src/utils/binary-search.js");var s=c("./src/utils/logger.js");function o(e,t){var r=null;for(var i=0;i<e.length;i+=1){var a=e[i];if(a&&a.cc===t){r=a;break}}return r}d.findFirstFragWithCC=o;function e(e,t){return r.default.search(e,function(e){if(e.cc<t){return 1}else if(e.cc>t){return-1}else{return 0}})}d.findFragWithCC=e;function a(e,t,r){var i=false;if(t&&t.details&&r){if(r.endCC>r.startCC||e&&e.cc<r.startCC){i=true}}return i}d.shouldAlignOnDiscontinuities=a;function l(e,t){var r=e.fragments;var i=t.fragments;if(!i.length||!r.length){s.logger.log("No fragments to align");return}var a=o(r,i[0].cc);if(!a||a&&!a.startPTS){s.logger.log("No frag in previous level to align on");return}return a}d.findDiscontinuousReferenceFrag=l;function u(r,e){e.fragments.forEach(function(e){if(e){var t=e.start+r;e.start=e.startPTS=t;e.endPTS=t+e.duration}});e.PTSKnown=true}d.adjustPts=u;function t(e,t,r){i(e,r,t);if(!r.PTSKnown&&t){f(r,t.details)}}d.alignStream=t;function i(e,t,r){if(a(e,r,t)){var i=l(r.details,t);if(i){s.logger.log("Adjusting PTS using last level due to CC increase within current level");u(i.start,t)}}}d.alignDiscontinuities=i;function f(e,t){if(t&&t.fragments.length){if(!e.hasProgramDateTime||!t.hasProgramDateTime){return}var r=t.fragments[0].programDateTime;var i=e.fragments[0].programDateTime;var a=(i-r)/1e3+t.fragments[0].start;if(n.isFinite(a)){s.logger.log("adjusting PTS using programDateTime delta, sliding:"+a.toFixed(3));u(a,e)}}}d.alignPDT=f}).call(this,c("./src/polyfills/number.js")["Number"])},"./src/utils/ewma-bandwidth-estimator.js":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});var a=r("./src/utils/ewma.js");var i=function(){function e(e,t,r,i){this.hls=e;this.defaultEstimate_=i;this.minWeight_=.001;this.minDelayMs_=50;this.slow_=new a.default(t);this.fast_=new a.default(r)}e.prototype.sample=function(e,t){e=Math.max(e,this.minDelayMs_);var r=8e3*t/e,i=e/1e3;this.fast_.sample(i,r);this.slow_.sample(i,r)};e.prototype.canEstimate=function(){var e=this.fast_;return e&&e.getTotalWeight()>=this.minWeight_};e.prototype.getEstimate=function(){if(this.canEstimate()){return Math.min(this.fast_.getEstimate(),this.slow_.getEstimate())}else{return this.defaultEstimate_}};e.prototype.destroy=function(){};return e}();t.default=i},"./src/utils/ewma.js":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});var i=function(){function e(e){this.alpha_=e?Math.exp(Math.log(.5)/e):0;this.estimate_=0;this.totalWeight_=0}e.prototype.sample=function(e,t){var r=Math.pow(this.alpha_,e);this.estimate_=t*(1-r)+r*this.estimate_;this.totalWeight_+=e};e.prototype.getTotalWeight=function(){return this.totalWeight_};e.prototype.getEstimate=function(){if(this.alpha_){var e=1-Math.pow(this.alpha_,this.totalWeight_);return this.estimate_/e}else{return this.estimate_}};return e}();t.default=i},"./src/utils/get-self-scope.js":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});function i(){if(typeof window==="undefined"){return self}else{return window}}t.getSelfScope=i},"./src/utils/logger.js":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});var i=r("./src/utils/get-self-scope.js");function a(){}var n={trace:a,debug:a,log:a,warn:a,info:a,error:a};var s=n;function o(e,t){t="["+e+"] > "+t;return t}var l=i.getSelfScope();function u(r){var i=l.console[r];if(i){return function(){var e=[];for(var t=0;t<arguments.length;t++){e[t]=arguments[t]}if(e[0]){e[0]=o(r,e[0])}i.apply(l.console,e)}}return a}function f(t){var e=[];for(var r=1;r<arguments.length;r++){e[r-1]=arguments[r]}e.forEach(function(e){s[e]=t[e]?t[e].bind(t):u(e)})}t.enableLogs=function(e){if(e===true||typeof e==="object"){f(e,"debug","log","info","warn","error");try{s.log()}catch(e){s=n}}else{s=n}};t.logger=s},"./src/utils/mediakeys-helper.js":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});var i=function(){if(typeof window!=="undefined"&&window.navigator&&window.navigator.requestMediaKeySystemAccess){return window.navigator.requestMediaKeySystemAccess.bind(window.navigator)}else{return null}}();t.requestMediaKeySystemAccess=i},"./src/utils/mediasource-helper.js":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});function i(){if(typeof window!=="undefined"){return window.MediaSource||window.WebKitMediaSource}}t.getMediaSource=i},"./src/utils/output-filter.js":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});var i=function(){function e(e,t){this.timelineController=e;this.trackName=t;this.startTime=null;this.endTime=null;this.screen=null}e.prototype.dispatchCue=function(){if(this.startTime===null){return}this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen);this.startTime=null};e.prototype.newCue=function(e,t,r){if(this.startTime===null||this.startTime>e){this.startTime=e}this.endTime=t;this.screen=r;this.timelineController.createCaptionsTrack(this.trackName)};return e}();t.default=i},"./src/utils/texttrack-utils.js":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});function i(e,t){var r=null;try{r=new window.Event("addtrack")}catch(e){r=document.createEvent("Event");r.initEvent("addtrack",false,false)}r.track=e;t.dispatchEvent(r)}t.sendAddTrackEvent=i;function a(e){if(e&&e.cues){while(e.cues.length>0){e.removeCue(e.cues[0])}}}t.clearCurrentCues=a},"./src/utils/time-ranges.js":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});var i={toString:function(e){var t="",r=e.length;for(var i=0;i<r;i++){t+="["+e.start(i).toFixed(3)+","+e.end(i).toFixed(3)+"]"}return t}};t.default=i},"./src/utils/vttcue.js":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.default=function(){if(typeof window!=="undefined"&&window.VTTCue){return window.VTTCue}var _="auto";var r={"":true,lr:true,rl:true};var i={start:true,middle:true,end:true,left:true,right:true};function T(e){if(typeof e!=="string"){return false}var t=r[e.toLowerCase()];return t?e.toLowerCase():false}function S(e){if(typeof e!=="string"){return false}var t=i[e.toLowerCase()];return t?e.toLowerCase():false}function b(e){var t=1;for(;t<arguments.length;t++){var r=arguments[t];for(var i in r){e[i]=r[i]}}return e}function e(e,t,r){var i=this;var a=function(){if(typeof navigator==="undefined"){return}return/MSIE\s8\.0/.test(navigator.userAgent)}();var n={};if(a){i=document.createElement("custom")}else{n.enumerable=true}i.hasBeenReset=false;var s="";var o=false;var l=e;var u=t;var f=r;var d=null;var c="";var h=true;var p="auto";var g="start";var v=50;var m="middle";var y=50;var E="middle";Object.defineProperty(i,"id",b({},n,{get:function(){return s},set:function(e){s=""+e}}));Object.defineProperty(i,"pauseOnExit",b({},n,{get:function(){return o},set:function(e){o=!!e}}));Object.defineProperty(i,"startTime",b({},n,{get:function(){return l},set:function(e){if(typeof e!=="number"){throw new TypeError("Start time must be set to a number.")}l=e;this.hasBeenReset=true}}));Object.defineProperty(i,"endTime",b({},n,{get:function(){return u},set:function(e){if(typeof e!=="number"){throw new TypeError("End time must be set to a number.")}u=e;this.hasBeenReset=true}}));Object.defineProperty(i,"text",b({},n,{get:function(){return f},set:function(e){f=""+e;this.hasBeenReset=true}}));Object.defineProperty(i,"region",b({},n,{get:function(){return d},set:function(e){d=e;this.hasBeenReset=true}}));Object.defineProperty(i,"vertical",b({},n,{get:function(){return c},set:function(e){var t=T(e);if(t===false){throw new SyntaxError("An invalid or illegal string was specified.")}c=t;this.hasBeenReset=true}}));Object.defineProperty(i,"snapToLines",b({},n,{get:function(){return h},set:function(e){h=!!e;this.hasBeenReset=true}}));Object.defineProperty(i,"line",b({},n,{get:function(){return p},set:function(e){if(typeof e!=="number"&&e!==_){throw new SyntaxError("An invalid number or illegal string was specified.")}p=e;this.hasBeenReset=true}}));Object.defineProperty(i,"lineAlign",b({},n,{get:function(){return g},set:function(e){var t=S(e);if(!t){throw new SyntaxError("An invalid or illegal string was specified.")}g=t;this.hasBeenReset=true}}));Object.defineProperty(i,"position",b({},n,{get:function(){return v},set:function(e){if(e<0||e>100){throw new Error("Position must be between 0 and 100.")}v=e;this.hasBeenReset=true}}));Object.defineProperty(i,"positionAlign",b({},n,{get:function(){return m},set:function(e){var t=S(e);if(!t){throw new SyntaxError("An invalid or illegal string was specified.")}m=t;this.hasBeenReset=true}}));Object.defineProperty(i,"size",b({},n,{get:function(){return y},set:function(e){if(e<0||e>100){throw new Error("Size must be between 0 and 100.")}y=e;this.hasBeenReset=true}}));Object.defineProperty(i,"align",b({},n,{get:function(){return E},set:function(e){var t=S(e);if(!t){throw new SyntaxError("An invalid or illegal string was specified.")}E=t;this.hasBeenReset=true}}));i.displayState=undefined;if(a){return i}}e.prototype.getCueAsHTML=function(){var e=window.WebVTT;return e.convertCueToDOMTree(window,this.text)};return e}()},"./src/utils/vttparser.js":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});var l=r("./src/utils/vttcue.js");var i=function e(){return{decode:function(e){if(!e){return""}if(typeof e!=="string"){throw new Error("Error - expected string data.")}return decodeURIComponent(encodeURIComponent(e))}}};function a(){this.window=window;this.state="INITIAL";this.buffer="";this.decoder=new i;this.regionList=[]}function o(e){function t(e,t,r,i){return(e|0)*3600+(t|0)*60+(r|0)+(i|0)/1e3}var r=e.match(/^(\d+):(\d{2})(:\d{2})?\.(\d{3})/);if(!r){return null}if(r[3]){return t(r[1],r[2],r[3].replace(":",""),r[4])}else if(r[1]>59){return t(r[1],r[2],0,r[4])}else{return t(0,r[1],r[2],r[4])}}function u(){this.values=Object.create(null)}u.prototype={set:function(e,t){if(!this.get(e)&&t!==""){this.values[e]=t}},get:function(e,t,r){if(r){return this.has(e)?this.values[e]:t[r]}return this.has(e)?this.values[e]:t},has:function(e){return e in this.values},alt:function(e,t,r){for(var i=0;i<r.length;++i){if(t===r[i]){this.set(e,t);break}}},integer:function(e,t){if(/^-?\d+$/.test(t)){this.set(e,parseInt(t,10))}},percent:function(e,t){var r;if(r=t.match(/^([\d]{1,3})(\.[\d]*)?%$/)){t=parseFloat(t);if(t>=0&&t<=100){this.set(e,t);return true}}return false}};function f(e,t,r,i){var a=i?e.split(i):[e];for(var n in a){if(typeof a[n]!=="string"){continue}var s=a[n].split(r);if(s.length!==2){continue}var o=s[0];var l=s[1];t(o,l)}}var d=new l.default(0,0,0);var c=d.align==="middle"?"middle":"center";function h(t,e,s){var r=t;function i(){var e=o(t);if(e===null){throw new Error("Malformed timestamp: "+r)}t=t.replace(/^[^\sa-zA-Z-]+/,"");return e}function a(e,t){var n=new u;f(e,function(e,t){switch(e){case"region":for(var r=s.length-1;r>=0;r--){if(s[r].id===t){n.set(e,s[r].region);break}}break;case"vertical":n.alt(e,t,["rl","lr"]);break;case"line":var i=t.split(","),a=i[0];n.integer(e,a);if(n.percent(e,a)){n.set("snapToLines",false)}n.alt(e,a,["auto"]);if(i.length===2){n.alt("lineAlign",i[1],["start",c,"end"])}break;case"position":i=t.split(",");n.percent(e,i[0]);if(i.length===2){n.alt("positionAlign",i[1],["start",c,"end","line-left","line-right","auto"])}break;case"size":n.percent(e,t);break;case"align":n.alt(e,t,["start",c,"end","left","right"]);break}},/:/,/\s/);t.region=n.get("region",null);t.vertical=n.get("vertical","");var r=n.get("line","auto");if(r==="auto"&&d.line===-1){r=-1}t.line=r;t.lineAlign=n.get("lineAlign","start");t.snapToLines=n.get("snapToLines",true);t.size=n.get("size",100);t.align=n.get("align",c);var i=n.get("position","auto");if(i==="auto"&&d.position===50){i=t.align==="start"||t.align==="left"?0:t.align==="end"||t.align==="right"?100:50}t.position=i}function n(){t=t.replace(/^\s+/,"")}n();e.startTime=i();n();if(t.substr(0,3)!=="--\x3e"){throw new Error("Malformed time stamp (time stamps must be separated by '--\x3e'): "+r)}t=t.substr(3);n();e.endTime=i();n();a(t,e)}function p(e){return e.replace(/<br(?: \/)?>/gi,"\n")}t.fixLineBreaks=p;a.prototype={parse:function(e){var i=this;if(e){i.buffer+=i.decoder.decode(e,{stream:true})}function t(){var e=i.buffer;var t=0;e=p(e);while(t<e.length&&e[t]!=="\r"&&e[t]!=="\n"){++t}var r=e.substr(0,t);if(e[t]==="\r"){++t}if(e[t]==="\n"){++t}i.buffer=e.substr(t);return r}function r(e){f(e,function(e,t){switch(e){case"Region":break}},/:/)}try{var a=void 0;if(i.state==="INITIAL"){if(!/\r\n|\n/.test(i.buffer)){return this}a=t();var n=a.match(/^()?WEBVTT([ \t].*)?$/);if(!n||!n[0]){throw new Error("Malformed WebVTT signature.")}i.state="HEADER"}var s=false;while(i.buffer){if(!/\r\n|\n/.test(i.buffer)){return this}if(!s){a=t()}else{s=false}switch(i.state){case"HEADER":if(/:/.test(a)){r(a)}else if(!a){i.state="ID"}continue;case"NOTE":if(!a){i.state="ID"}continue;case"ID":if(/^NOTE($|[ \t])/.test(a)){i.state="NOTE";break}if(!a){continue}i.cue=new l.default(0,0,"");i.state="CUE";if(a.indexOf("--\x3e")===-1){i.cue.id=a;continue}case"CUE":try{h(a,i.cue,i.regionList)}catch(e){i.cue=null;i.state="BADCUE";continue}i.state="CUETEXT";continue;case"CUETEXT":var o=a.indexOf("--\x3e")!==-1;if(!a||o&&(s=true)){if(i.oncue){i.oncue(i.cue)}i.cue=null;i.state="ID";continue}if(i.cue.text){i.cue.text+="\n"}i.cue.text+=a;continue;case"BADCUE":if(!a){i.state="ID"}continue}}}catch(e){if(i.state==="CUETEXT"&&i.cue&&i.oncue){i.oncue(i.cue)}i.cue=null;i.state=i.state==="INITIAL"?"BADWEBVTT":"BADCUE"}return this},flush:function(){var e=this;try{e.buffer+=e.decoder.decode();if(e.cue||e.state==="HEADER"){e.buffer+="\n\n";e.parse()}if(e.state==="INITIAL"){throw new Error("Malformed WebVTT signature.")}}catch(e){throw e}if(e.onflush){e.onflush()}return this}};t.default=a},"./src/utils/webvtt-parser.js":function(e,t,r){"use strict";(function(n){Object.defineProperty(t,"__esModule",{value:true});var v=r("./src/utils/vttparser.js");var m=r("./src/demux/id3.js");var y=function(e,t,r){return e.substr(r||0,t.length)===t};var E=function(e){var t=parseInt(e.substr(-3));var r=parseInt(e.substr(-6,2));var i=parseInt(e.substr(-9,2));var a=e.length>9?parseInt(e.substr(0,e.indexOf(":"))):0;if(!n.isFinite(t)||!n.isFinite(r)||!n.isFinite(i)||!n.isFinite(a)){return-1}t+=1e3*r;t+=60*1e3*i;t+=60*60*1e3*a;return t};var _=function(e){var t=5381;var r=e.length;while(r){t=t*33^e.charCodeAt(--r)}return(t>>>0).toString()};var T=function(e,t,r){var i=e[t];var a=e[i.prevCC];if(!a||!a.new&&i.new){e.ccOffset=e.presentationOffset=i.start;i.new=false;return}while(a&&a.new){e.ccOffset+=i.start-a.start;i.new=false;i=a;a=e[i.prevCC]}e.presentationOffset=r};var e={parse:function(e,r,i,a,t,n){var s=/\r\n|\n\r|\n|\r/g;var o=m.utf8ArrayToStr(new Uint8Array(e)).trim().replace(s,"\n").split("\n");var l="00:00.000";var u=0;var f=0;var d=0;var c=[];var h;var p=true;var g=new v.default;g.oncue=function(e){var t=i[a];var r=i.ccOffset;if(t&&t.new){if(f!==undefined){r=i.ccOffset=t.start}else{T(i,a,d)}}if(d){r=d-i.presentationOffset}e.startTime+=r-f;e.endTime+=r-f;e.id=_(e.startTime.toString())+_(e.endTime.toString())+_(e.text);e.text=decodeURIComponent(encodeURIComponent(e.text));if(e.endTime>0){c.push(e)}};g.onparsingerror=function(e){h=e};g.onflush=function(){if(h&&n){n(h);return}t(c)};o.forEach(function(t){if(p){if(y(t,"X-TIMESTAMP-MAP=")){p=false;t.substr(16).split(",").forEach(function(e){if(y(e,"LOCAL:")){l=e.substr(6)}else if(y(e,"MPEGTS:")){u=parseInt(e.substr(7))}});try{if(r+(i[a].start*9e4||0)<0){r+=8589934592}u-=r;f=E(l)/1e3;d=u/9e4;if(f===-1){h=new Error("Malformed X-TIMESTAMP-MAP: "+t)}}catch(e){h=new Error("Malformed X-TIMESTAMP-MAP: "+t)}return}else if(t===""){p=false}}g.parse(t+"\n")});g.flush()}};t.default=e}).call(this,r("./src/polyfills/number.js")["Number"])},"./src/utils/xhr-loader.js":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});var f=r("./src/utils/logger.js");var d=window.performance,a=window.XMLHttpRequest;var i=function(){function e(e){if(e&&e.xhrSetup){this.xhrSetup=e.xhrSetup}}e.prototype.destroy=function(){this.abort();this.loader=null};e.prototype.abort=function(){var e=this.loader;if(e&&e.readyState!==4){this.stats.aborted=true;e.abort()}window.clearTimeout(this.requestTimeout);this.requestTimeout=null;window.clearTimeout(this.retryTimeout);this.retryTimeout=null};e.prototype.load=function(e,t,r){this.context=e;this.config=t;this.callbacks=r;this.stats={trequest:d.now(),retry:0};this.retryDelay=t.retryDelay;this.loadInternal()};e.prototype.loadInternal=function(){var t,r=this.context;t=this.loader=new a;var e=this.stats;e.tfirst=0;e.loaded=0;var i=this.xhrSetup;try{if(i){try{i(t,r.url)}catch(e){t.open("GET",r.url,true);i(t,r.url)}}if(!t.readyState){t.open("GET",r.url,true)}}catch(e){this.callbacks.onError({code:t.status,text:e.message},r,t);return}if(r.rangeEnd){t.setRequestHeader("Range","bytes="+r.rangeStart+"-"+(r.rangeEnd-1))}t.onreadystatechange=this.readystatechange.bind(this);t.onprogress=this.loadprogress.bind(this);t.responseType=r.responseType;this.requestTimeout=window.setTimeout(this.loadtimeout.bind(this),this.config.timeout);t.send()};e.prototype.readystatechange=function(e){var t=e.currentTarget,r=t.readyState,i=this.stats,a=this.context,n=this.config;if(i.aborted){return}if(r>=2){window.clearTimeout(this.requestTimeout);if(i.tfirst===0){i.tfirst=Math.max(d.now(),i.trequest)}if(r===4){var s=t.status;if(s>=200&&s<300){i.tload=Math.max(i.tfirst,d.now());var o=void 0,l=void 0;if(a.responseType==="arraybuffer"){o=t.response;l=o.byteLength}else{o=t.responseText;l=o.length}i.loaded=i.total=l;var u={url:t.responseURL,data:o};this.callbacks.onSuccess(u,i,a,t)}else{if(i.retry>=n.maxRetry||s>=400&&s<499){f.logger.error(s+" while loading "+a.url);this.callbacks.onError({code:s,text:t.statusText},a,t)}else{f.logger.warn(s+" while loading "+a.url+", retrying in "+this.retryDelay+"...");this.destroy();this.retryTimeout=window.setTimeout(this.loadInternal.bind(this),this.retryDelay);this.retryDelay=Math.min(2*this.retryDelay,n.maxRetryDelay);i.retry++}}}else{this.requestTimeout=window.setTimeout(this.loadtimeout.bind(this),n.timeout)}}};e.prototype.loadtimeout=function(){f.logger.warn("timeout while loading "+this.context.url);this.callbacks.onTimeout(this.stats,this.context,null)};e.prototype.loadprogress=function(e){var t=e.currentTarget,r=this.stats;r.loaded=e.loaded;if(e.lengthComputable){r.total=e.total}var i=this.callbacks.onProgress;if(i){i(r,this.context,null,t)}};return e}();t.default=i}})["default"]})}}]);
//# sourceMappingURL=npm-async-24d874ad.87014c3c.js.map